
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://github.com/datacenter/ACI-Pre-Upgrade-Validation-Script/validations/">
      
      
        <link rel="prev" href="../usage/">
      
      
      
        
      
      
      <link rel="icon" href="../assets/logo.svg">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.7.1">
    
    
      
        <title>Validation Reference - ACI Pre-Upgrade Validation Script</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.484c7ddc.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.ab4e12ef.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../css/style.css">
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="blue" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#validation-reference" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="ACI Pre-Upgrade Validation Script" class="md-header__button md-logo" aria-label="ACI Pre-Upgrade Validation Script" data-md-component="logo">
      
  <img src="../assets/logo.svg" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            ACI Pre-Upgrade Validation Script
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Validation Reference
            
          </span>
        </div>
      </div>
    </div>
    
      
    
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/datacenter/ACI-Pre-Upgrade-Validation-Script" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="ACI Pre-Upgrade Validation Script" class="md-nav__button md-logo" aria-label="ACI Pre-Upgrade Validation Script" data-md-component="logo">
      
  <img src="../assets/logo.svg" alt="logo">

    </a>
    ACI Pre-Upgrade Validation Script
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/datacenter/ACI-Pre-Upgrade-Validation-Script" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Introduction
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../getting_started/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Getting Started
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../usage/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Usage
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    
  
    Validation Reference
  

    
  </span>
  
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    
  
    Validation Reference
  

    
  </span>
  
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#summary-list" class="md-nav__link">
    <span class="md-ellipsis">
      
        Summary List
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Summary List">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#general-checks" class="md-nav__link">
    <span class="md-ellipsis">
      
        General Checks
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fault-checks" class="md-nav__link">
    <span class="md-ellipsis">
      
        Fault Checks
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#configuration-checks" class="md-nav__link">
    <span class="md-ellipsis">
      
        Configuration Checks
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#defect-condition-checks" class="md-nav__link">
    <span class="md-ellipsis">
      
        Defect Condition Checks
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#general-check-details" class="md-nav__link">
    <span class="md-ellipsis">
      
        General Check Details
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="General Check Details">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#compatibility-target-aci-version" class="md-nav__link">
    <span class="md-ellipsis">
      
        Compatibility (Target ACI Version)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#compatibility-cimc-version" class="md-nav__link">
    <span class="md-ellipsis">
      
        Compatibility (CIMC Version)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#compatibility-switch-hardware" class="md-nav__link">
    <span class="md-ellipsis">
      
        Compatibility (Switch Hardware)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#compatibility-switch-hardware-gen1" class="md-nav__link">
    <span class="md-ellipsis">
      
        Compatibility (Switch Hardware - gen1)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#compatibility-remote-leaf-switch" class="md-nav__link">
    <span class="md-ellipsis">
      
        Compatibility (Remote Leaf Switch)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#apic-target-version-image-and-md5-hash" class="md-nav__link">
    <span class="md-ellipsis">
      
        APIC Target version image and MD5 hash
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#apic-cluster-status" class="md-nav__link">
    <span class="md-ellipsis">
      
        APIC Cluster Status
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#switch-fabric-membership-status" class="md-nav__link">
    <span class="md-ellipsis">
      
        Switch Fabric Membership Status
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ntp-status" class="md-nav__link">
    <span class="md-ellipsis">
      
        NTP Status
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#firmwaremaintenance-groups-when-crossing-40-release" class="md-nav__link">
    <span class="md-ellipsis">
      
        Firmware/Maintenance Groups when crossing 4.0 Release
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#features-that-need-to-be-disabled-prior-to-upgrade" class="md-nav__link">
    <span class="md-ellipsis">
      
        Features that need to be disabled prior to Upgrade
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#switch-upgrade-group-guidelines" class="md-nav__link">
    <span class="md-ellipsis">
      
        Switch Upgrade Group Guidelines
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#intersight-device-connector-upgrade-status" class="md-nav__link">
    <span class="md-ellipsis">
      
        Intersight Device Connector upgrade status
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mini-aci-upgrade-to-602-or-later" class="md-nav__link">
    <span class="md-ellipsis">
      
        Mini ACI Upgrade to 6.0(2) or later
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#post-upgrade-callback-integrity" class="md-nav__link">
    <span class="md-ellipsis">
      
        Post Upgrade CallBack Integrity
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#602-requires-32-and-64-bit-switch-images" class="md-nav__link">
    <span class="md-ellipsis">
      
        6.0(2)+ requires 32 and 64 bit switch images
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fabric-link-redundancy" class="md-nav__link">
    <span class="md-ellipsis">
      
        Fabric Link Redundancy
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#apic-database-size" class="md-nav__link">
    <span class="md-ellipsis">
      
        APIC Database Size
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#apic-downgrade-compatibility-when-crossing-62-release" class="md-nav__link">
    <span class="md-ellipsis">
      
        APIC downgrade compatibility when crossing 6.2 release
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fault-check-details" class="md-nav__link">
    <span class="md-ellipsis">
      
        Fault Check Details
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Fault Check Details">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#apic-disk-space-usage" class="md-nav__link">
    <span class="md-ellipsis">
      
        APIC Disk Space Usage
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#standby-apic-disk-space-usage" class="md-nav__link">
    <span class="md-ellipsis">
      
        Standby APIC Disk Space Usage
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#switch-node-bootflash-usage" class="md-nav__link">
    <span class="md-ellipsis">
      
        Switch Node /bootflash usage
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#apic-ssd-health" class="md-nav__link">
    <span class="md-ellipsis">
      
        APIC SSD Health
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#switch-ssd-health" class="md-nav__link">
    <span class="md-ellipsis">
      
        Switch SSD Health
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#config-on-apic-connected-port" class="md-nav__link">
    <span class="md-ellipsis">
      
        Config On APIC Connected Port
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#l2l3-port-config" class="md-nav__link">
    <span class="md-ellipsis">
      
        L2/L3 Port Config
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#access-untagged-port-config" class="md-nav__link">
    <span class="md-ellipsis">
      
        Access (Untagged) Port Config
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#encap-already-in-use" class="md-nav__link">
    <span class="md-ellipsis">
      
        Encap Already in Use
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#l3out-subnets" class="md-nav__link">
    <span class="md-ellipsis">
      
        L3Out Subnets
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bd-subnets" class="md-nav__link">
    <span class="md-ellipsis">
      
        BD Subnets
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vmm-domain-controller-status" class="md-nav__link">
    <span class="md-ellipsis">
      
        VMM Domain Controller Status
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vmm-domain-lldpcdp-adjacency-status" class="md-nav__link">
    <span class="md-ellipsis">
      
        VMM Domain LLDP/CDP Adjacency Status
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#different-infra-vlan-via-lldp" class="md-nav__link">
    <span class="md-ellipsis">
      
        Different infra VLAN via LLDP
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hw-programming-failure" class="md-nav__link">
    <span class="md-ellipsis">
      
        HW Programming Failure
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scalability-faults-related-to-capacity-dashboard" class="md-nav__link">
    <span class="md-ellipsis">
      
        Scalability (faults related to Capacity Dashboard)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fabric-port-status" class="md-nav__link">
    <span class="md-ellipsis">
      
        Fabric Port Status
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#equipment-disk-limits" class="md-nav__link">
    <span class="md-ellipsis">
      
        Equipment Disk Limits
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vmm-inventory-partially-synced" class="md-nav__link">
    <span class="md-ellipsis">
      
        VMM Inventory Partially Synced
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#configuration-check-details" class="md-nav__link">
    <span class="md-ellipsis">
      
        Configuration Check Details
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Configuration Check Details">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#vpc-paired-leaf-switches" class="md-nav__link">
    <span class="md-ellipsis">
      
        VPC-paired Leaf switches
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#overlapping-vlan-pool" class="md-nav__link">
    <span class="md-ellipsis">
      
        Overlapping VLAN Pool
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vnid-mismatch" class="md-nav__link">
    <span class="md-ellipsis">
      
        VNID Mismatch
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#l3out-mtu" class="md-nav__link">
    <span class="md-ellipsis">
      
        L3Out MTU
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bgp-peer-profile-at-node-level-without-loopback" class="md-nav__link">
    <span class="md-ellipsis">
      
        BGP Peer Profile at node level without Loopback
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#l3out-route-map-importexport-direction" class="md-nav__link">
    <span class="md-ellipsis">
      
        L3Out Route Map import/export direction
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#l3out-route-map-match-rule-with-missing-target" class="md-nav__link">
    <span class="md-ellipsis">
      
        L3Out Route Map Match Rule with missing-target
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#l3out-loopback-ip-overlap-with-l3out-interfaces" class="md-nav__link">
    <span class="md-ellipsis">
      
        L3Out Loopback IP Overlap with L3Out Interfaces
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#isis-redistribution-metric-for-mpodmsite" class="md-nav__link">
    <span class="md-ellipsis">
      
        ISIS Redistribution Metric for MPod/Msite
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bgp-route-target-type-for-golf-over-l2evpn" class="md-nav__link">
    <span class="md-ellipsis">
      
        BGP Route-target Type for GOLF over L2EVPN
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#apic-container-bridge-ip-overlap-with-apic-tep" class="md-nav__link">
    <span class="md-ellipsis">
      
        APIC Container Bridge IP Overlap with APIC TEP
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fabric-uplink-scale-cannot-exceed-56-uplinks-per-leaf" class="md-nav__link">
    <span class="md-ellipsis">
      
        Fabric Uplink Scale cannot exceed 56 uplinks per leaf
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#oob-mgmt-security" class="md-nav__link">
    <span class="md-ellipsis">
      
        OoB Mgmt Security
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#eecdh-ssl-cipher" class="md-nav__link">
    <span class="md-ellipsis">
      
        EECDH SSL Cipher
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bd-and-epg-subnet-scope-consistency" class="md-nav__link">
    <span class="md-ellipsis">
      
        BD and EPG Subnet Scope Consistency
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#unsupported-fec-configuration-for-n9k-c93180yc-ex" class="md-nav__link">
    <span class="md-ellipsis">
      
        Unsupported FEC Configuration for N9K-C93180YC-EX
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cloudsec-encryption-deprecated" class="md-nav__link">
    <span class="md-ellipsis">
      
        CloudSec Encryption Deprecated
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#out-of-service-ports" class="md-nav__link">
    <span class="md-ellipsis">
      
        Out-of-Service Ports
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tep-to-tep-atomic-counters-scalability" class="md-nav__link">
    <span class="md-ellipsis">
      
        TEP-to-TEP atomic counters Scalability
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#https-request-throttle-rate" class="md-nav__link">
    <span class="md-ellipsis">
      
        HTTPS Request Throttle Rate
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#global-aes-encryption" class="md-nav__link">
    <span class="md-ellipsis">
      
        Global AES Encryption
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#service-graph-bd-forceful-routing" class="md-nav__link">
    <span class="md-ellipsis">
      
        Service Graph BD Forceful Routing
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ave-end-of-life" class="md-nav__link">
    <span class="md-ellipsis">
      
        AVE End-of-life
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#shared-service-with-vzany-consumer" class="md-nav__link">
    <span class="md-ellipsis">
      
        Shared Service with vzAny Consumer
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#defect-check-details" class="md-nav__link">
    <span class="md-ellipsis">
      
        Defect Check Details
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Defect Check Details">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ep-announce-compatibility" class="md-nav__link">
    <span class="md-ellipsis">
      
        EP Announce Compatibility
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#eventmgr-db-size-defect-susceptibility" class="md-nav__link">
    <span class="md-ellipsis">
      
        Eventmgr DB size defect susceptibility
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#contract-port-22-defect" class="md-nav__link">
    <span class="md-ellipsis">
      
        Contract Port 22 Defect
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#telemetrystatsserverp-object" class="md-nav__link">
    <span class="md-ellipsis">
      
        telemetryStatsServerP Object
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#link-level-flow-control" class="md-nav__link">
    <span class="md-ellipsis">
      
        Link Level Flow Control
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#internal-vlan-pool" class="md-nav__link">
    <span class="md-ellipsis">
      
        Internal VLAN Pool
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#apic-ca-cert-validation" class="md-nav__link">
    <span class="md-ellipsis">
      
        APIC CA Cert Validation
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fabricdomain-name" class="md-nav__link">
    <span class="md-ellipsis">
      
        FabricDomain Name
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#spine-sup-hw-revision" class="md-nav__link">
    <span class="md-ellipsis">
      
        Spine SUP HW Revision
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cos-3-with-dynamic-packet-prioritization" class="md-nav__link">
    <span class="md-ellipsis">
      
        CoS 3 with Dynamic Packet Prioritization
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sup-aa-high-memory-usage" class="md-nav__link">
    <span class="md-ellipsis">
      
        SUP-A/A+ High Memory Usage
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vmm-uplink-container-with-empty-actives" class="md-nav__link">
    <span class="md-ellipsis">
      
        VMM Uplink Container with empty Actives
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#n9k-c93108tc-fx3pfx3h-interface-down" class="md-nav__link">
    <span class="md-ellipsis">
      
        N9K-C93108TC-FX3P/FX3H Interface Down
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#invalid-fabricpathep-targets" class="md-nav__link">
    <span class="md-ellipsis">
      
        Invalid fabricPathEp Targets
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#lldp-custom-interface-description" class="md-nav__link">
    <span class="md-ellipsis">
      
        LLDP Custom Interface Description
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#route-map-community-match" class="md-nav__link">
    <span class="md-ellipsis">
      
        Route-map Community Match
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#l3out-32-overlap-with-bd-subnet" class="md-nav__link">
    <span class="md-ellipsis">
      
        L3out /32 overlap with BD Subnet
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vzany-to-vzany-service-graph-when-crossing-50-release" class="md-nav__link">
    <span class="md-ellipsis">
      
        vzAny-to-vzAny Service Graph when crossing 5.0 release
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fcfcoe-support-for-ex-switches" class="md-nav__link">
    <span class="md-ellipsis">
      
        FC/FCOE support for -EX switches
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#nexus-950x-fm-or-lc-might-fail-to-boot-after-reload" class="md-nav__link">
    <span class="md-ellipsis">
      
        Nexus 950X FM or LC Might Fail to boot after reload
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#stale-decommissioned-spine" class="md-nav__link">
    <span class="md-ellipsis">
      
        Stale Decommissioned Spine
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#n9k-c9408-platform-model" class="md-nav__link">
    <span class="md-ellipsis">
      
        N9K-C9408 Platform Model
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pbr-high-scale" class="md-nav__link">
    <span class="md-ellipsis">
      
        PBR High Scale
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#standby-sup-image-sync" class="md-nav__link">
    <span class="md-ellipsis">
      
        Standby Sup Image Sync
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#observer-database-size" class="md-nav__link">
    <span class="md-ellipsis">
      
        Observer Database Size
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#stale-pconsra-object" class="md-nav__link">
    <span class="md-ellipsis">
      
        Stale pconsRA Object
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#isis-dteps-byte-size" class="md-nav__link">
    <span class="md-ellipsis">
      
        ISIS DTEPs Byte Size
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#policydist-configpushshardcont-crash" class="md-nav__link">
    <span class="md-ellipsis">
      
        Policydist configpushShardCont crash
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#summary-list" class="md-nav__link">
    <span class="md-ellipsis">
      
        Summary List
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Summary List">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#general-checks" class="md-nav__link">
    <span class="md-ellipsis">
      
        General Checks
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fault-checks" class="md-nav__link">
    <span class="md-ellipsis">
      
        Fault Checks
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#configuration-checks" class="md-nav__link">
    <span class="md-ellipsis">
      
        Configuration Checks
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#defect-condition-checks" class="md-nav__link">
    <span class="md-ellipsis">
      
        Defect Condition Checks
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#general-check-details" class="md-nav__link">
    <span class="md-ellipsis">
      
        General Check Details
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="General Check Details">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#compatibility-target-aci-version" class="md-nav__link">
    <span class="md-ellipsis">
      
        Compatibility (Target ACI Version)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#compatibility-cimc-version" class="md-nav__link">
    <span class="md-ellipsis">
      
        Compatibility (CIMC Version)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#compatibility-switch-hardware" class="md-nav__link">
    <span class="md-ellipsis">
      
        Compatibility (Switch Hardware)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#compatibility-switch-hardware-gen1" class="md-nav__link">
    <span class="md-ellipsis">
      
        Compatibility (Switch Hardware - gen1)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#compatibility-remote-leaf-switch" class="md-nav__link">
    <span class="md-ellipsis">
      
        Compatibility (Remote Leaf Switch)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#apic-target-version-image-and-md5-hash" class="md-nav__link">
    <span class="md-ellipsis">
      
        APIC Target version image and MD5 hash
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#apic-cluster-status" class="md-nav__link">
    <span class="md-ellipsis">
      
        APIC Cluster Status
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#switch-fabric-membership-status" class="md-nav__link">
    <span class="md-ellipsis">
      
        Switch Fabric Membership Status
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ntp-status" class="md-nav__link">
    <span class="md-ellipsis">
      
        NTP Status
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#firmwaremaintenance-groups-when-crossing-40-release" class="md-nav__link">
    <span class="md-ellipsis">
      
        Firmware/Maintenance Groups when crossing 4.0 Release
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#features-that-need-to-be-disabled-prior-to-upgrade" class="md-nav__link">
    <span class="md-ellipsis">
      
        Features that need to be disabled prior to Upgrade
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#switch-upgrade-group-guidelines" class="md-nav__link">
    <span class="md-ellipsis">
      
        Switch Upgrade Group Guidelines
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#intersight-device-connector-upgrade-status" class="md-nav__link">
    <span class="md-ellipsis">
      
        Intersight Device Connector upgrade status
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mini-aci-upgrade-to-602-or-later" class="md-nav__link">
    <span class="md-ellipsis">
      
        Mini ACI Upgrade to 6.0(2) or later
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#post-upgrade-callback-integrity" class="md-nav__link">
    <span class="md-ellipsis">
      
        Post Upgrade CallBack Integrity
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#602-requires-32-and-64-bit-switch-images" class="md-nav__link">
    <span class="md-ellipsis">
      
        6.0(2)+ requires 32 and 64 bit switch images
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fabric-link-redundancy" class="md-nav__link">
    <span class="md-ellipsis">
      
        Fabric Link Redundancy
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#apic-database-size" class="md-nav__link">
    <span class="md-ellipsis">
      
        APIC Database Size
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#apic-downgrade-compatibility-when-crossing-62-release" class="md-nav__link">
    <span class="md-ellipsis">
      
        APIC downgrade compatibility when crossing 6.2 release
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fault-check-details" class="md-nav__link">
    <span class="md-ellipsis">
      
        Fault Check Details
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Fault Check Details">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#apic-disk-space-usage" class="md-nav__link">
    <span class="md-ellipsis">
      
        APIC Disk Space Usage
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#standby-apic-disk-space-usage" class="md-nav__link">
    <span class="md-ellipsis">
      
        Standby APIC Disk Space Usage
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#switch-node-bootflash-usage" class="md-nav__link">
    <span class="md-ellipsis">
      
        Switch Node /bootflash usage
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#apic-ssd-health" class="md-nav__link">
    <span class="md-ellipsis">
      
        APIC SSD Health
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#switch-ssd-health" class="md-nav__link">
    <span class="md-ellipsis">
      
        Switch SSD Health
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#config-on-apic-connected-port" class="md-nav__link">
    <span class="md-ellipsis">
      
        Config On APIC Connected Port
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#l2l3-port-config" class="md-nav__link">
    <span class="md-ellipsis">
      
        L2/L3 Port Config
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#access-untagged-port-config" class="md-nav__link">
    <span class="md-ellipsis">
      
        Access (Untagged) Port Config
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#encap-already-in-use" class="md-nav__link">
    <span class="md-ellipsis">
      
        Encap Already in Use
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#l3out-subnets" class="md-nav__link">
    <span class="md-ellipsis">
      
        L3Out Subnets
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bd-subnets" class="md-nav__link">
    <span class="md-ellipsis">
      
        BD Subnets
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vmm-domain-controller-status" class="md-nav__link">
    <span class="md-ellipsis">
      
        VMM Domain Controller Status
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vmm-domain-lldpcdp-adjacency-status" class="md-nav__link">
    <span class="md-ellipsis">
      
        VMM Domain LLDP/CDP Adjacency Status
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#different-infra-vlan-via-lldp" class="md-nav__link">
    <span class="md-ellipsis">
      
        Different infra VLAN via LLDP
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hw-programming-failure" class="md-nav__link">
    <span class="md-ellipsis">
      
        HW Programming Failure
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scalability-faults-related-to-capacity-dashboard" class="md-nav__link">
    <span class="md-ellipsis">
      
        Scalability (faults related to Capacity Dashboard)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fabric-port-status" class="md-nav__link">
    <span class="md-ellipsis">
      
        Fabric Port Status
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#equipment-disk-limits" class="md-nav__link">
    <span class="md-ellipsis">
      
        Equipment Disk Limits
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vmm-inventory-partially-synced" class="md-nav__link">
    <span class="md-ellipsis">
      
        VMM Inventory Partially Synced
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#configuration-check-details" class="md-nav__link">
    <span class="md-ellipsis">
      
        Configuration Check Details
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Configuration Check Details">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#vpc-paired-leaf-switches" class="md-nav__link">
    <span class="md-ellipsis">
      
        VPC-paired Leaf switches
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#overlapping-vlan-pool" class="md-nav__link">
    <span class="md-ellipsis">
      
        Overlapping VLAN Pool
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vnid-mismatch" class="md-nav__link">
    <span class="md-ellipsis">
      
        VNID Mismatch
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#l3out-mtu" class="md-nav__link">
    <span class="md-ellipsis">
      
        L3Out MTU
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bgp-peer-profile-at-node-level-without-loopback" class="md-nav__link">
    <span class="md-ellipsis">
      
        BGP Peer Profile at node level without Loopback
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#l3out-route-map-importexport-direction" class="md-nav__link">
    <span class="md-ellipsis">
      
        L3Out Route Map import/export direction
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#l3out-route-map-match-rule-with-missing-target" class="md-nav__link">
    <span class="md-ellipsis">
      
        L3Out Route Map Match Rule with missing-target
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#l3out-loopback-ip-overlap-with-l3out-interfaces" class="md-nav__link">
    <span class="md-ellipsis">
      
        L3Out Loopback IP Overlap with L3Out Interfaces
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#isis-redistribution-metric-for-mpodmsite" class="md-nav__link">
    <span class="md-ellipsis">
      
        ISIS Redistribution Metric for MPod/Msite
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bgp-route-target-type-for-golf-over-l2evpn" class="md-nav__link">
    <span class="md-ellipsis">
      
        BGP Route-target Type for GOLF over L2EVPN
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#apic-container-bridge-ip-overlap-with-apic-tep" class="md-nav__link">
    <span class="md-ellipsis">
      
        APIC Container Bridge IP Overlap with APIC TEP
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fabric-uplink-scale-cannot-exceed-56-uplinks-per-leaf" class="md-nav__link">
    <span class="md-ellipsis">
      
        Fabric Uplink Scale cannot exceed 56 uplinks per leaf
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#oob-mgmt-security" class="md-nav__link">
    <span class="md-ellipsis">
      
        OoB Mgmt Security
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#eecdh-ssl-cipher" class="md-nav__link">
    <span class="md-ellipsis">
      
        EECDH SSL Cipher
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bd-and-epg-subnet-scope-consistency" class="md-nav__link">
    <span class="md-ellipsis">
      
        BD and EPG Subnet Scope Consistency
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#unsupported-fec-configuration-for-n9k-c93180yc-ex" class="md-nav__link">
    <span class="md-ellipsis">
      
        Unsupported FEC Configuration for N9K-C93180YC-EX
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cloudsec-encryption-deprecated" class="md-nav__link">
    <span class="md-ellipsis">
      
        CloudSec Encryption Deprecated
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#out-of-service-ports" class="md-nav__link">
    <span class="md-ellipsis">
      
        Out-of-Service Ports
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tep-to-tep-atomic-counters-scalability" class="md-nav__link">
    <span class="md-ellipsis">
      
        TEP-to-TEP atomic counters Scalability
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#https-request-throttle-rate" class="md-nav__link">
    <span class="md-ellipsis">
      
        HTTPS Request Throttle Rate
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#global-aes-encryption" class="md-nav__link">
    <span class="md-ellipsis">
      
        Global AES Encryption
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#service-graph-bd-forceful-routing" class="md-nav__link">
    <span class="md-ellipsis">
      
        Service Graph BD Forceful Routing
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ave-end-of-life" class="md-nav__link">
    <span class="md-ellipsis">
      
        AVE End-of-life
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#shared-service-with-vzany-consumer" class="md-nav__link">
    <span class="md-ellipsis">
      
        Shared Service with vzAny Consumer
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#defect-check-details" class="md-nav__link">
    <span class="md-ellipsis">
      
        Defect Check Details
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Defect Check Details">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ep-announce-compatibility" class="md-nav__link">
    <span class="md-ellipsis">
      
        EP Announce Compatibility
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#eventmgr-db-size-defect-susceptibility" class="md-nav__link">
    <span class="md-ellipsis">
      
        Eventmgr DB size defect susceptibility
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#contract-port-22-defect" class="md-nav__link">
    <span class="md-ellipsis">
      
        Contract Port 22 Defect
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#telemetrystatsserverp-object" class="md-nav__link">
    <span class="md-ellipsis">
      
        telemetryStatsServerP Object
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#link-level-flow-control" class="md-nav__link">
    <span class="md-ellipsis">
      
        Link Level Flow Control
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#internal-vlan-pool" class="md-nav__link">
    <span class="md-ellipsis">
      
        Internal VLAN Pool
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#apic-ca-cert-validation" class="md-nav__link">
    <span class="md-ellipsis">
      
        APIC CA Cert Validation
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fabricdomain-name" class="md-nav__link">
    <span class="md-ellipsis">
      
        FabricDomain Name
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#spine-sup-hw-revision" class="md-nav__link">
    <span class="md-ellipsis">
      
        Spine SUP HW Revision
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cos-3-with-dynamic-packet-prioritization" class="md-nav__link">
    <span class="md-ellipsis">
      
        CoS 3 with Dynamic Packet Prioritization
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sup-aa-high-memory-usage" class="md-nav__link">
    <span class="md-ellipsis">
      
        SUP-A/A+ High Memory Usage
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vmm-uplink-container-with-empty-actives" class="md-nav__link">
    <span class="md-ellipsis">
      
        VMM Uplink Container with empty Actives
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#n9k-c93108tc-fx3pfx3h-interface-down" class="md-nav__link">
    <span class="md-ellipsis">
      
        N9K-C93108TC-FX3P/FX3H Interface Down
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#invalid-fabricpathep-targets" class="md-nav__link">
    <span class="md-ellipsis">
      
        Invalid fabricPathEp Targets
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#lldp-custom-interface-description" class="md-nav__link">
    <span class="md-ellipsis">
      
        LLDP Custom Interface Description
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#route-map-community-match" class="md-nav__link">
    <span class="md-ellipsis">
      
        Route-map Community Match
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#l3out-32-overlap-with-bd-subnet" class="md-nav__link">
    <span class="md-ellipsis">
      
        L3out /32 overlap with BD Subnet
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vzany-to-vzany-service-graph-when-crossing-50-release" class="md-nav__link">
    <span class="md-ellipsis">
      
        vzAny-to-vzAny Service Graph when crossing 5.0 release
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fcfcoe-support-for-ex-switches" class="md-nav__link">
    <span class="md-ellipsis">
      
        FC/FCOE support for -EX switches
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#nexus-950x-fm-or-lc-might-fail-to-boot-after-reload" class="md-nav__link">
    <span class="md-ellipsis">
      
        Nexus 950X FM or LC Might Fail to boot after reload
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#stale-decommissioned-spine" class="md-nav__link">
    <span class="md-ellipsis">
      
        Stale Decommissioned Spine
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#n9k-c9408-platform-model" class="md-nav__link">
    <span class="md-ellipsis">
      
        N9K-C9408 Platform Model
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pbr-high-scale" class="md-nav__link">
    <span class="md-ellipsis">
      
        PBR High Scale
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#standby-sup-image-sync" class="md-nav__link">
    <span class="md-ellipsis">
      
        Standby Sup Image Sync
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#observer-database-size" class="md-nav__link">
    <span class="md-ellipsis">
      
        Observer Database Size
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#stale-pconsra-object" class="md-nav__link">
    <span class="md-ellipsis">
      
        Stale pconsRA Object
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#isis-dteps-byte-size" class="md-nav__link">
    <span class="md-ellipsis">
      
        ISIS DTEPs Byte Size
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#policydist-configpushshardcont-crash" class="md-nav__link">
    <span class="md-ellipsis">
      
        Policydist configpushShardCont crash
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              
              <article class="md-content__inner md-typeset">
                
                  


  
  


<h1 id="validation-reference">Validation Reference</h1>
<p>Tables in this page list the validations supported by the script and compare them with other pre-upgrade validation tools for Cisco ACI.</p>
<ul>
<li><strong>This Script</strong>: The python script provided in <a href="https://github.com/datacenter/ACI-Pre-Upgrade-Validation-Script">GitHub</a></li>
<li><strong>APIC built-in</strong>: A validator embedded in the Cisco APIC Upgrade Workflow. This is automatically performed when performing an upgrade or downgrade for the Cisco APIC or switches.</li>
<li><del><strong>Pre-Upgrade Validator (App)</strong></del>: The APIC App infra, including the Pre-Upgrade Validation app, was deprecated in ACI version <a href="https://www.cisco.com/c/en/us/td/docs/dcn/aci/apic/all/cisco-aci-releases-changes-in-behavior.html#ACIrelease612">6.1(2)</a>.</li>
</ul>
<div class="admonition info">
<p class="admonition-title">Info</p>
<p>The tables in this page assume the <strong>latest version</strong> of the script.</p>
<p>If you copied the script to your APIC in the past, make sure that is still the latest version.</p>
</div>
<h2 id="summary-list">Summary List</h2>
<h3 id="general-checks">General Checks</h3>
<table>
<thead>
<tr>
<th>Items</th>
<th>This Script</th>
<th>APIC built-in</th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="#compatibility-target-aci-version">Compatibility (Target ACI Version)</a></td>
<td><img alt="" class="gemoji" src="https://cdnjs.cloudflare.com/ajax/libs/emojione/2.2.7/assets/svg/2705.svg" title=":white_check_mark:" /></td>
<td><img alt="" class="gemoji" src="https://cdnjs.cloudflare.com/ajax/libs/emojione/2.2.7/assets/svg/2705.svg" title=":white_check_mark:" /> 4.2(4)</td>
</tr>
<tr>
<td><a href="#compatibility-cimc-version">Compatibility (CIMC Version)</a></td>
<td><img alt="" class="gemoji" src="https://cdnjs.cloudflare.com/ajax/libs/emojione/2.2.7/assets/svg/2705.svg" title=":white_check_mark:" /></td>
<td><img alt="" class="gemoji" src="https://cdnjs.cloudflare.com/ajax/libs/emojione/2.2.7/assets/svg/2705.svg" title=":white_check_mark:" /> 4.2(4)</td>
</tr>
<tr>
<td><a href="#compatibility-switch-hardware">Compatibility (Switch Hardware)</a></td>
<td><img alt="" class="gemoji" src="https://cdnjs.cloudflare.com/ajax/libs/emojione/2.2.7/assets/svg/1f6ab.svg" title=":no_entry_sign:" /></td>
<td><img alt="" class="gemoji" src="https://cdnjs.cloudflare.com/ajax/libs/emojione/2.2.7/assets/svg/2705.svg" title=":white_check_mark:" /></td>
</tr>
<tr>
<td><a href="#compatibility-switch-hardware-gen1">Compatibility (Switch Hardware Gen1)</a></td>
<td><img alt="" class="gemoji" src="https://cdnjs.cloudflare.com/ajax/libs/emojione/2.2.7/assets/svg/2705.svg" title=":white_check_mark:" /></td>
<td><img alt="" class="gemoji" src="https://cdnjs.cloudflare.com/ajax/libs/emojione/2.2.7/assets/svg/2705.svg" title=":white_check_mark:" /> 4.2(4)</td>
</tr>
<tr>
<td><a href="#compatibility-remote-leaf-switch">Compatibility (Remote Leaf Switch)</a></td>
<td><img alt="" class="gemoji" src="https://cdnjs.cloudflare.com/ajax/libs/emojione/2.2.7/assets/svg/2705.svg" title=":white_check_mark:" /></td>
<td><img alt="" class="gemoji" src="https://cdnjs.cloudflare.com/ajax/libs/emojione/2.2.7/assets/svg/2755.svg" title=":grey_exclamation:" /> Except CSCvs16767</td>
</tr>
<tr>
<td><a href="#apic-target-version-image-and-md5-hash">APIC Target version image and MD5 hash</a></td>
<td><img alt="" class="gemoji" src="https://cdnjs.cloudflare.com/ajax/libs/emojione/2.2.7/assets/svg/2705.svg" title=":white_check_mark:" /></td>
<td><img alt="" class="gemoji" src="https://cdnjs.cloudflare.com/ajax/libs/emojione/2.2.7/assets/svg/2705.svg" title=":white_check_mark:" /> 5.2(3e)</td>
</tr>
<tr>
<td><a href="#apic-cluster-status">APIC Cluster Status</a></td>
<td><img alt="" class="gemoji" src="https://cdnjs.cloudflare.com/ajax/libs/emojione/2.2.7/assets/svg/2705.svg" title=":white_check_mark:" /></td>
<td><img alt="" class="gemoji" src="https://cdnjs.cloudflare.com/ajax/libs/emojione/2.2.7/assets/svg/2705.svg" title=":white_check_mark:" /> 4.2(6)</td>
</tr>
<tr>
<td><a href="#switch-fabric-membership-status">Switch Fabric Membership Status</a></td>
<td><img alt="" class="gemoji" src="https://cdnjs.cloudflare.com/ajax/libs/emojione/2.2.7/assets/svg/2705.svg" title=":white_check_mark:" /></td>
<td><img alt="" class="gemoji" src="https://cdnjs.cloudflare.com/ajax/libs/emojione/2.2.7/assets/svg/1f6ab.svg" title=":no_entry_sign:" /></td>
</tr>
<tr>
<td><a href="#ntp-status">NTP Status</a></td>
<td><img alt="" class="gemoji" src="https://cdnjs.cloudflare.com/ajax/libs/emojione/2.2.7/assets/svg/2705.svg" title=":white_check_mark:" /></td>
<td><img alt="" class="gemoji" src="https://cdnjs.cloudflare.com/ajax/libs/emojione/2.2.7/assets/svg/2705.svg" title=":white_check_mark:" /> 4.2(5)</td>
</tr>
<tr>
<td><a href="#firmwaremaintenance-groups-when-crossing-40-release">Firmware/Maintenance Groups when crossing 4.0 Release</a></td>
<td><img alt="" class="gemoji" src="https://cdnjs.cloudflare.com/ajax/libs/emojione/2.2.7/assets/svg/2705.svg" title=":white_check_mark:" /></td>
<td><img alt="" class="gemoji" src="https://cdnjs.cloudflare.com/ajax/libs/emojione/2.2.7/assets/svg/1f6ab.svg" title=":no_entry_sign:" /></td>
</tr>
<tr>
<td><a href="#features-that-need-to-be-disabled-prior-to-upgrade">Features that need to be disabled prior to Upgrade</a></td>
<td><img alt="" class="gemoji" src="https://cdnjs.cloudflare.com/ajax/libs/emojione/2.2.7/assets/svg/2705.svg" title=":white_check_mark:" /></td>
<td><img alt="" class="gemoji" src="https://cdnjs.cloudflare.com/ajax/libs/emojione/2.2.7/assets/svg/2755.svg" title=":grey_exclamation:" /> 5.2(c)<br>Only AppCenter Apps</td>
</tr>
<tr>
<td><a href="#switch-upgrade-group-guidelines">Switch Upgrade Group Guidelines</a></td>
<td><img alt="" class="gemoji" src="https://cdnjs.cloudflare.com/ajax/libs/emojione/2.2.7/assets/svg/2705.svg" title=":white_check_mark:" /></td>
<td><img alt="" class="gemoji" src="https://cdnjs.cloudflare.com/ajax/libs/emojione/2.2.7/assets/svg/2755.svg" title=":grey_exclamation:" /> 4.2(4)<br>Only RR spines (IPN connectivity not checked)</td>
</tr>
<tr>
<td><a href="#intersight-device-connector-upgrade-status">Intersight Device Connector upgrade status</a></td>
<td><img alt="" class="gemoji" src="https://cdnjs.cloudflare.com/ajax/libs/emojione/2.2.7/assets/svg/2705.svg" title=":white_check_mark:" /></td>
<td><img alt="" class="gemoji" src="https://cdnjs.cloudflare.com/ajax/libs/emojione/2.2.7/assets/svg/2705.svg" title=":white_check_mark:" /> 4.2(5)</td>
</tr>
<tr>
<td><a href="#mini-aci-upgrade-to-602-or-later">Mini ACI Upgrade to 6.0(2)+</a></td>
<td><img alt="" class="gemoji" src="https://cdnjs.cloudflare.com/ajax/libs/emojione/2.2.7/assets/svg/2705.svg" title=":white_check_mark:" /></td>
<td><img alt="" class="gemoji" src="https://cdnjs.cloudflare.com/ajax/libs/emojione/2.2.7/assets/svg/1f6ab.svg" title=":no_entry_sign:" /></td>
</tr>
<tr>
<td><a href="#post-upgrade-callback-integrity">Post Upgrade CallBack Integrity</a></td>
<td><img alt="" class="gemoji" src="https://cdnjs.cloudflare.com/ajax/libs/emojione/2.2.7/assets/svg/2705.svg" title=":white_check_mark:" /></td>
<td><img alt="" class="gemoji" src="https://cdnjs.cloudflare.com/ajax/libs/emojione/2.2.7/assets/svg/1f6ab.svg" title=":no_entry_sign:" /></td>
</tr>
<tr>
<td><a href="#602-requires-32-and-64-bit-switch-images">6.0(2)+ requires 32 and 64 bit switch images</a></td>
<td><img alt="" class="gemoji" src="https://cdnjs.cloudflare.com/ajax/libs/emojione/2.2.7/assets/svg/2705.svg" title=":white_check_mark:" /></td>
<td><img alt="" class="gemoji" src="https://cdnjs.cloudflare.com/ajax/libs/emojione/2.2.7/assets/svg/1f6ab.svg" title=":no_entry_sign:" /></td>
</tr>
<tr>
<td><a href="#fabric-link-redundancy">Fabric Link Redundancy</a></td>
<td><img alt="" class="gemoji" src="https://cdnjs.cloudflare.com/ajax/libs/emojione/2.2.7/assets/svg/2705.svg" title=":white_check_mark:" /></td>
<td><img alt="" class="gemoji" src="https://cdnjs.cloudflare.com/ajax/libs/emojione/2.2.7/assets/svg/1f6ab.svg" title=":no_entry_sign:" /></td>
</tr>
<tr>
<td><a href="#apic-database-size">APIC Database Size</a></td>
<td><img alt="" class="gemoji" src="https://cdnjs.cloudflare.com/ajax/libs/emojione/2.2.7/assets/svg/2705.svg" title=":white_check_mark:" /></td>
<td><img alt="" class="gemoji" src="https://cdnjs.cloudflare.com/ajax/libs/emojione/2.2.7/assets/svg/1f6ab.svg" title=":no_entry_sign:" /></td>
</tr>
<tr>
<td><a href="#apic-downgrade-compatibility-when-crossing-62-release">APIC downgrade compatibility when crossing 6.2 release</a></td>
<td><img alt="" class="gemoji" src="https://cdnjs.cloudflare.com/ajax/libs/emojione/2.2.7/assets/svg/2705.svg" title=":white_check_mark:" /></td>
<td><img alt="" class="gemoji" src="https://cdnjs.cloudflare.com/ajax/libs/emojione/2.2.7/assets/svg/1f6ab.svg" title=":no_entry_sign:" /></td>
</tr>
</tbody>
</table>
<h3 id="fault-checks">Fault Checks</h3>
<table>
<thead>
<tr>
<th>Items</th>
<th>Faults</th>
<th>This Script</th>
<th>APIC built-in</th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="#apic-disk-space-usage">APIC Disk Space Usage</a></td>
<td>F1527: 80% - 85%<br>F1528: 85% - 90%<br>F1529: 90% or more</td>
<td><img alt="" class="gemoji" src="https://cdnjs.cloudflare.com/ajax/libs/emojione/2.2.7/assets/svg/2705.svg" title=":white_check_mark:" /></td>
<td><img alt="" class="gemoji" src="https://cdnjs.cloudflare.com/ajax/libs/emojione/2.2.7/assets/svg/2705.svg" title=":white_check_mark:" /> 4.2(1)</td>
</tr>
<tr>
<td><a href="#standby-apic-disk-space-usage">Standby APIC Disk Space Usage</a></td>
<td></td>
<td><img alt="" class="gemoji" src="https://cdnjs.cloudflare.com/ajax/libs/emojione/2.2.7/assets/svg/2705.svg" title=":white_check_mark:" /></td>
<td><img alt="" class="gemoji" src="https://cdnjs.cloudflare.com/ajax/libs/emojione/2.2.7/assets/svg/2705.svg" title=":white_check_mark:" /> 5.2(3)</td>
</tr>
<tr>
<td><a href="#switch-node-bootflash-usage">Switch Node <code>/bootflash</code> usage</a></td>
<td>F1821: 90% or more</td>
<td><img alt="" class="gemoji" src="https://cdnjs.cloudflare.com/ajax/libs/emojione/2.2.7/assets/svg/2705.svg" title=":white_check_mark:" /></td>
<td><img alt="" class="gemoji" src="https://cdnjs.cloudflare.com/ajax/libs/emojione/2.2.7/assets/svg/2705.svg" title=":white_check_mark:" /> 4.2(4)</td>
</tr>
<tr>
<td><a href="#apic-ssd-health">APIC SSD Health</a></td>
<td>F2730: less than 10% remaining<br>F2731: less than 5% remaining<br>F2732: less than 1% remaining</td>
<td><img alt="" class="gemoji" src="https://cdnjs.cloudflare.com/ajax/libs/emojione/2.2.7/assets/svg/2705.svg" title=":white_check_mark:" /></td>
<td><img alt="" class="gemoji" src="https://cdnjs.cloudflare.com/ajax/libs/emojione/2.2.7/assets/svg/2705.svg" title=":white_check_mark:" /> 4.2(1)</td>
</tr>
<tr>
<td><a href="#switch-ssd-health">Switch SSD Health</a></td>
<td>F3074: reached 80% lifetime<br>F3073: reached 90% lifetime<br></td>
<td><img alt="" class="gemoji" src="https://cdnjs.cloudflare.com/ajax/libs/emojione/2.2.7/assets/svg/2705.svg" title=":white_check_mark:" /></td>
<td><img alt="" class="gemoji" src="https://cdnjs.cloudflare.com/ajax/libs/emojione/2.2.7/assets/svg/2705.svg" title=":white_check_mark:" /> 4.2(1)</td>
</tr>
<tr>
<td><a href="#config-on-apic-connected-port">Config On APIC Connected Port</a></td>
<td>F0467: port-configured-for-apic</td>
<td><img alt="" class="gemoji" src="https://cdnjs.cloudflare.com/ajax/libs/emojione/2.2.7/assets/svg/2705.svg" title=":white_check_mark:" /></td>
<td><img alt="" class="gemoji" src="https://cdnjs.cloudflare.com/ajax/libs/emojione/2.2.7/assets/svg/2705.svg" title=":white_check_mark:" /> 6.0(1g)</td>
</tr>
<tr>
<td><a href="#l2l3-port-config">L3 Port Config</a></td>
<td>F0467: port-configured-as-l2</td>
<td><img alt="" class="gemoji" src="https://cdnjs.cloudflare.com/ajax/libs/emojione/2.2.7/assets/svg/2705.svg" title=":white_check_mark:" /></td>
<td><img alt="" class="gemoji" src="https://cdnjs.cloudflare.com/ajax/libs/emojione/2.2.7/assets/svg/2705.svg" title=":white_check_mark:" /> 5.2(4d)</td>
</tr>
<tr>
<td><a href="#l2l3-port-config">L2 Port Config</a></td>
<td>F0467: port-configured-as-l3</td>
<td><img alt="" class="gemoji" src="https://cdnjs.cloudflare.com/ajax/libs/emojione/2.2.7/assets/svg/2705.svg" title=":white_check_mark:" /></td>
<td><img alt="" class="gemoji" src="https://cdnjs.cloudflare.com/ajax/libs/emojione/2.2.7/assets/svg/2705.svg" title=":white_check_mark:" /> 5.2(4d)</td>
</tr>
<tr>
<td><a href="#access-untagged-port-config">Access (Untagged) Port Config</a></td>
<td>F0467: native-or-untagged-encap-failure</td>
<td><img alt="" class="gemoji" src="https://cdnjs.cloudflare.com/ajax/libs/emojione/2.2.7/assets/svg/2705.svg" title=":white_check_mark:" /></td>
<td><img alt="" class="gemoji" src="https://cdnjs.cloudflare.com/ajax/libs/emojione/2.2.7/assets/svg/1f6ab.svg" title=":no_entry_sign:" /></td>
</tr>
<tr>
<td><a href="#encap-already-in-use">Encap Already in Use</a></td>
<td>F0467: encap-already-in-use</td>
<td><img alt="" class="gemoji" src="https://cdnjs.cloudflare.com/ajax/libs/emojione/2.2.7/assets/svg/2705.svg" title=":white_check_mark:" /></td>
<td><img alt="" class="gemoji" src="https://cdnjs.cloudflare.com/ajax/libs/emojione/2.2.7/assets/svg/1f6ab.svg" title=":no_entry_sign:" /></td>
</tr>
<tr>
<td><a href="#l3out-subnets">L3Out Subnets</a></td>
<td>F0467: prefix-entry-already-in-use</td>
<td><img alt="" class="gemoji" src="https://cdnjs.cloudflare.com/ajax/libs/emojione/2.2.7/assets/svg/2705.svg" title=":white_check_mark:" /></td>
<td><img alt="" class="gemoji" src="https://cdnjs.cloudflare.com/ajax/libs/emojione/2.2.7/assets/svg/2705.svg" title=":white_check_mark:" /> 6.0(1g)</td>
</tr>
<tr>
<td><a href="#bd-subnets">BD Subnets</a></td>
<td>F0469: duplicate-subnets-within-ctx</td>
<td><img alt="" class="gemoji" src="https://cdnjs.cloudflare.com/ajax/libs/emojione/2.2.7/assets/svg/2705.svg" title=":white_check_mark:" /></td>
<td><img alt="" class="gemoji" src="https://cdnjs.cloudflare.com/ajax/libs/emojione/2.2.7/assets/svg/2705.svg" title=":white_check_mark:" /> 5.2(4d)</td>
</tr>
<tr>
<td><a href="#bd-subnets">BD Subnets</a></td>
<td>F1425: subnet-overlap</td>
<td><img alt="" class="gemoji" src="https://cdnjs.cloudflare.com/ajax/libs/emojione/2.2.7/assets/svg/2705.svg" title=":white_check_mark:" /></td>
<td><img alt="" class="gemoji" src="https://cdnjs.cloudflare.com/ajax/libs/emojione/2.2.7/assets/svg/2705.svg" title=":white_check_mark:" /> 5.2(4d)</td>
</tr>
<tr>
<td><a href="#vmm-domain-controller-status">VMM Domain Controller Status</a></td>
<td>F0130</td>
<td><img alt="" class="gemoji" src="https://cdnjs.cloudflare.com/ajax/libs/emojione/2.2.7/assets/svg/2705.svg" title=":white_check_mark:" /></td>
<td><img alt="" class="gemoji" src="https://cdnjs.cloudflare.com/ajax/libs/emojione/2.2.7/assets/svg/2705.svg" title=":white_check_mark:" /> 4.2(1)</td>
</tr>
<tr>
<td><a href="#vmm-domain-lldpcdp-adjacency-status">VMM Domain LLDP/CDP Adjacency Status</a></td>
<td>F606391</td>
<td><img alt="" class="gemoji" src="https://cdnjs.cloudflare.com/ajax/libs/emojione/2.2.7/assets/svg/2705.svg" title=":white_check_mark:" /></td>
<td><img alt="" class="gemoji" src="https://cdnjs.cloudflare.com/ajax/libs/emojione/2.2.7/assets/svg/2705.svg" title=":white_check_mark:" /> 4.2(1)</td>
</tr>
<tr>
<td><a href="#different-infra-vlan-via-lldp">Different infra VLAN via LLDP</a></td>
<td>F0454: infra-vlan-mismatch</td>
<td><img alt="" class="gemoji" src="https://cdnjs.cloudflare.com/ajax/libs/emojione/2.2.7/assets/svg/2705.svg" title=":white_check_mark:" /></td>
<td><img alt="" class="gemoji" src="https://cdnjs.cloudflare.com/ajax/libs/emojione/2.2.7/assets/svg/2705.svg" title=":white_check_mark:" /> 4.2(4)</td>
</tr>
<tr>
<td><a href="#hw-programming-failure">HW Programming Failure</a></td>
<td>F3544: L3Out Prefixes<br>F3545: Contracts</td>
<td><img alt="" class="gemoji" src="https://cdnjs.cloudflare.com/ajax/libs/emojione/2.2.7/assets/svg/2705.svg" title=":white_check_mark:" /></td>
<td><img alt="" class="gemoji" src="https://cdnjs.cloudflare.com/ajax/libs/emojione/2.2.7/assets/svg/2705.svg" title=":white_check_mark:" /> 5.1(1)</td>
</tr>
<tr>
<td><a href="#scalability-faults-related-to-capacity-dashboard">Scalability (faults related to Capacity Dashboard)</a></td>
<td>TCA faults for eqptcapacityEntity</td>
<td><img alt="" class="gemoji" src="https://cdnjs.cloudflare.com/ajax/libs/emojione/2.2.7/assets/svg/2705.svg" title=":white_check_mark:" /></td>
<td><img alt="" class="gemoji" src="https://cdnjs.cloudflare.com/ajax/libs/emojione/2.2.7/assets/svg/1f6ab.svg" title=":no_entry_sign:" /></td>
</tr>
<tr>
<td><a href="#fabric-port-status">Fabric Port Status</a></td>
<td>F1394: ethpm-if-port-down-fabric</td>
<td><img alt="" class="gemoji" src="https://cdnjs.cloudflare.com/ajax/libs/emojione/2.2.7/assets/svg/2705.svg" title=":white_check_mark:" /></td>
<td><img alt="" class="gemoji" src="https://cdnjs.cloudflare.com/ajax/libs/emojione/2.2.7/assets/svg/1f6ab.svg" title=":no_entry_sign:" /></td>
</tr>
<tr>
<td><a href="#equipment-disk-limits">Equipment Disk Limits</a></td>
<td>F1820: 80% -minor<br>F1821: -major<br>F1822: -critical</td>
<td><img alt="" class="gemoji" src="https://cdnjs.cloudflare.com/ajax/libs/emojione/2.2.7/assets/svg/2705.svg" title=":white_check_mark:" /></td>
<td><img alt="" class="gemoji" src="https://cdnjs.cloudflare.com/ajax/libs/emojione/2.2.7/assets/svg/1f6ab.svg" title=":no_entry_sign:" /></td>
</tr>
<tr>
<td><a href="#vmm-inventory-partially-synced">VMM Inventory Partially Synced</a></td>
<td>F0132: comp-ctrlr-operational-issues</td>
<td><img alt="" class="gemoji" src="https://cdnjs.cloudflare.com/ajax/libs/emojione/2.2.7/assets/svg/2705.svg" title=":white_check_mark:" /></td>
<td><img alt="" class="gemoji" src="https://cdnjs.cloudflare.com/ajax/libs/emojione/2.2.7/assets/svg/1f6ab.svg" title=":no_entry_sign:" /></td>
</tr>
</tbody>
</table>
<h3 id="configuration-checks">Configuration Checks</h3>
<table>
<thead>
<tr>
<th>Items</th>
<th>This Script</th>
<th>APIC built-in</th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="#vpc-paired-leaf-switches">VPC-paired Leaf switches</a></td>
<td><img alt="" class="gemoji" src="https://cdnjs.cloudflare.com/ajax/libs/emojione/2.2.7/assets/svg/2705.svg" title=":white_check_mark:" /></td>
<td><img alt="" class="gemoji" src="https://cdnjs.cloudflare.com/ajax/libs/emojione/2.2.7/assets/svg/2705.svg" title=":white_check_mark:" /> 4.2(4)</td>
</tr>
<tr>
<td><a href="#overlapping-vlan-pool">Overlapping VLAN Pool</a></td>
<td><img alt="" class="gemoji" src="https://cdnjs.cloudflare.com/ajax/libs/emojione/2.2.7/assets/svg/2705.svg" title=":white_check_mark:" /></td>
<td><img alt="" class="gemoji" src="https://cdnjs.cloudflare.com/ajax/libs/emojione/2.2.7/assets/svg/1f6ab.svg" title=":no_entry_sign:" /></td>
</tr>
<tr>
<td><a href="#vnid-mismatch">VNID Mismatch</a></td>
<td><img alt="" class="gemoji" src="https://cdnjs.cloudflare.com/ajax/libs/emojione/2.2.7/assets/svg/26a0.svg" title="Deprecated" /></td>
<td><img alt="" class="gemoji" src="https://cdnjs.cloudflare.com/ajax/libs/emojione/2.2.7/assets/svg/1f6ab.svg" title=":no_entry_sign:" /></td>
</tr>
<tr>
<td><a href="#l3out-mtu">L3Out MTU</a></td>
<td><img alt="" class="gemoji" src="https://cdnjs.cloudflare.com/ajax/libs/emojione/2.2.7/assets/svg/2705.svg" title=":white_check_mark:" /></td>
<td><img alt="" class="gemoji" src="https://cdnjs.cloudflare.com/ajax/libs/emojione/2.2.7/assets/svg/1f6ab.svg" title=":no_entry_sign:" /></td>
</tr>
<tr>
<td><a href="#bgp-peer-profile-at-node-level-without-loopback">BGP Peer Profile at node level without Loopback</a></td>
<td><img alt="" class="gemoji" src="https://cdnjs.cloudflare.com/ajax/libs/emojione/2.2.7/assets/svg/2705.svg" title=":white_check_mark:" /></td>
<td><img alt="" class="gemoji" src="https://cdnjs.cloudflare.com/ajax/libs/emojione/2.2.7/assets/svg/1f6ab.svg" title=":no_entry_sign:" /></td>
</tr>
<tr>
<td><a href="#l3out-route-map-importexport-direction">L3Out Route Map import/export direction</a></td>
<td><img alt="" class="gemoji" src="https://cdnjs.cloudflare.com/ajax/libs/emojione/2.2.7/assets/svg/2705.svg" title=":white_check_mark:" /></td>
<td><img alt="" class="gemoji" src="https://cdnjs.cloudflare.com/ajax/libs/emojione/2.2.7/assets/svg/1f6ab.svg" title=":no_entry_sign:" /></td>
</tr>
<tr>
<td><a href="#l3out-route-map-match-rule-with-missing-target">L3Out Route Map Match Rule with missing-target</a></td>
<td><img alt="" class="gemoji" src="https://cdnjs.cloudflare.com/ajax/libs/emojione/2.2.7/assets/svg/2705.svg" title=":white_check_mark:" /></td>
<td><img alt="" class="gemoji" src="https://cdnjs.cloudflare.com/ajax/libs/emojione/2.2.7/assets/svg/1f6ab.svg" title=":no_entry_sign:" /></td>
</tr>
<tr>
<td><a href="#l3out-loopback-ip-overlap-with-l3out-interfaces">L3Out Loopback IP Overlap with L3Out Interfaces</a></td>
<td><img alt="" class="gemoji" src="https://cdnjs.cloudflare.com/ajax/libs/emojione/2.2.7/assets/svg/2705.svg" title=":white_check_mark:" /></td>
<td><img alt="" class="gemoji" src="https://cdnjs.cloudflare.com/ajax/libs/emojione/2.2.7/assets/svg/1f6ab.svg" title=":no_entry_sign:" /></td>
</tr>
<tr>
<td><a href="#isis-redistribution-metric-for-mpodmsite">ISIS Redistribution Metric for MPod/Msite</a></td>
<td><img alt="" class="gemoji" src="https://cdnjs.cloudflare.com/ajax/libs/emojione/2.2.7/assets/svg/2705.svg" title=":white_check_mark:" /></td>
<td><img alt="" class="gemoji" src="https://cdnjs.cloudflare.com/ajax/libs/emojione/2.2.7/assets/svg/1f6ab.svg" title=":no_entry_sign:" /></td>
</tr>
<tr>
<td><a href="#bgp-route-target-type-for-golf-over-l2evpn">BGP Route-target Type for GOLF over L2EVPN</a></td>
<td><img alt="" class="gemoji" src="https://cdnjs.cloudflare.com/ajax/libs/emojione/2.2.7/assets/svg/2705.svg" title=":white_check_mark:" /></td>
<td><img alt="" class="gemoji" src="https://cdnjs.cloudflare.com/ajax/libs/emojione/2.2.7/assets/svg/1f6ab.svg" title=":no_entry_sign:" /></td>
</tr>
<tr>
<td><a href="#apic-container-bridge-ip-overlap-with-apic-tep">APIC Container Bridge IP Overlap with APIC TEP</a></td>
<td><img alt="" class="gemoji" src="https://cdnjs.cloudflare.com/ajax/libs/emojione/2.2.7/assets/svg/2705.svg" title=":white_check_mark:" /></td>
<td><img alt="" class="gemoji" src="https://cdnjs.cloudflare.com/ajax/libs/emojione/2.2.7/assets/svg/1f6ab.svg" title=":no_entry_sign:" /></td>
</tr>
<tr>
<td><a href="#fabric-uplink-scale-cannot-exceed-56-uplinks-per-leaf">Per-Leaf Fabric Uplink Scale Validation</a></td>
<td><img alt="" class="gemoji" src="https://cdnjs.cloudflare.com/ajax/libs/emojione/2.2.7/assets/svg/2705.svg" title=":white_check_mark:" /></td>
<td><img alt="" class="gemoji" src="https://cdnjs.cloudflare.com/ajax/libs/emojione/2.2.7/assets/svg/1f6ab.svg" title=":no_entry_sign:" /></td>
</tr>
<tr>
<td><a href="#oob-mgmt-security">OoB Mgmt Security</a></td>
<td><img alt="" class="gemoji" src="https://cdnjs.cloudflare.com/ajax/libs/emojione/2.2.7/assets/svg/2705.svg" title=":white_check_mark:" /></td>
<td><img alt="" class="gemoji" src="https://cdnjs.cloudflare.com/ajax/libs/emojione/2.2.7/assets/svg/1f6ab.svg" title=":no_entry_sign:" /></td>
</tr>
<tr>
<td><a href="#eecdh-ssl-cipher">EECDH SSL Cipher Disabled</a></td>
<td><img alt="" class="gemoji" src="https://cdnjs.cloudflare.com/ajax/libs/emojione/2.2.7/assets/svg/2705.svg" title=":white_check_mark:" /></td>
<td><img alt="" class="gemoji" src="https://cdnjs.cloudflare.com/ajax/libs/emojione/2.2.7/assets/svg/1f6ab.svg" title=":no_entry_sign:" /></td>
</tr>
<tr>
<td><a href="#bd-and-epg-subnet-scope-consistency">BD and EPG Subnet Scope Consistency</a></td>
<td><img alt="" class="gemoji" src="https://cdnjs.cloudflare.com/ajax/libs/emojione/2.2.7/assets/svg/2705.svg" title=":white_check_mark:" /></td>
<td><img alt="" class="gemoji" src="https://cdnjs.cloudflare.com/ajax/libs/emojione/2.2.7/assets/svg/1f6ab.svg" title=":no_entry_sign:" /></td>
</tr>
<tr>
<td><a href="#unsupported-fec-configuration-for-n9k-c93180yc-ex">Unsupported FEC Configuration for N9K-C93180YC-EX</a></td>
<td><img alt="" class="gemoji" src="https://cdnjs.cloudflare.com/ajax/libs/emojione/2.2.7/assets/svg/2705.svg" title=":white_check_mark:" /></td>
<td><img alt="" class="gemoji" src="https://cdnjs.cloudflare.com/ajax/libs/emojione/2.2.7/assets/svg/1f6ab.svg" title=":no_entry_sign:" /></td>
</tr>
<tr>
<td><a href="#cloudsec-encryption-deprecated">CloudSec Encryption Deprecated</a></td>
<td><img alt="" class="gemoji" src="https://cdnjs.cloudflare.com/ajax/libs/emojione/2.2.7/assets/svg/2705.svg" title=":white_check_mark:" /></td>
<td><img alt="" class="gemoji" src="https://cdnjs.cloudflare.com/ajax/libs/emojione/2.2.7/assets/svg/1f6ab.svg" title=":no_entry_sign:" /></td>
</tr>
<tr>
<td><a href="#out-of-service-ports">Out-of-Service Ports</a></td>
<td><img alt="" class="gemoji" src="https://cdnjs.cloudflare.com/ajax/libs/emojione/2.2.7/assets/svg/2705.svg" title=":white_check_mark:" /></td>
<td><img alt="" class="gemoji" src="https://cdnjs.cloudflare.com/ajax/libs/emojione/2.2.7/assets/svg/1f6ab.svg" title=":no_entry_sign:" /></td>
</tr>
<tr>
<td><a href="#tep-to-tep-atomic-counters-scalability">TEP-to-TEP atomic counters Scalability</a></td>
<td><img alt="" class="gemoji" src="https://cdnjs.cloudflare.com/ajax/libs/emojione/2.2.7/assets/svg/2705.svg" title=":white_check_mark:" /></td>
<td><img alt="" class="gemoji" src="https://cdnjs.cloudflare.com/ajax/libs/emojione/2.2.7/assets/svg/1f6ab.svg" title=":no_entry_sign:" /></td>
</tr>
<tr>
<td><a href="#https-request-throttle-rate">HTTPS Request Throttle Rate</a></td>
<td><img alt="" class="gemoji" src="https://cdnjs.cloudflare.com/ajax/libs/emojione/2.2.7/assets/svg/2705.svg" title=":white_check_mark:" /></td>
<td><img alt="" class="gemoji" src="https://cdnjs.cloudflare.com/ajax/libs/emojione/2.2.7/assets/svg/1f6ab.svg" title=":no_entry_sign:" /></td>
</tr>
<tr>
<td><a href="#global-aes-encryption">Global AES Encryption</a></td>
<td><img alt="" class="gemoji" src="https://cdnjs.cloudflare.com/ajax/libs/emojione/2.2.7/assets/svg/2705.svg" title=":white_check_mark:" /></td>
<td><img alt="" class="gemoji" src="https://cdnjs.cloudflare.com/ajax/libs/emojione/2.2.7/assets/svg/2705.svg" title=":white_check_mark:" /> 6.1(2)</td>
</tr>
<tr>
<td><a href="#service-graph-bd-forceful-routing">Service Graph BD Forceful Routing</a></td>
<td><img alt="" class="gemoji" src="https://cdnjs.cloudflare.com/ajax/libs/emojione/2.2.7/assets/svg/2705.svg" title=":white_check_mark:" /></td>
<td><img alt="" class="gemoji" src="https://cdnjs.cloudflare.com/ajax/libs/emojione/2.2.7/assets/svg/1f6ab.svg" title=":no_entry_sign:" /></td>
</tr>
<tr>
<td><a href="#ave-end-of-life">AVE End-of-life</a></td>
<td><img alt="" class="gemoji" src="https://cdnjs.cloudflare.com/ajax/libs/emojione/2.2.7/assets/svg/2705.svg" title=":white_check_mark:" /></td>
<td><img alt="" class="gemoji" src="https://cdnjs.cloudflare.com/ajax/libs/emojione/2.2.7/assets/svg/1f6ab.svg" title=":no_entry_sign:" /></td>
</tr>
<tr>
<td><a href="#shared-service-with-vzany-consumer">Shared Service with vzAny Consumer</a></td>
<td><img alt="" class="gemoji" src="https://cdnjs.cloudflare.com/ajax/libs/emojione/2.2.7/assets/svg/2705.svg" title=":white_check_mark:" /></td>
<td><img alt="" class="gemoji" src="https://cdnjs.cloudflare.com/ajax/libs/emojione/2.2.7/assets/svg/1f6ab.svg" title=":no_entry_sign:" /></td>
</tr>
</tbody>
</table>
<h3 id="defect-condition-checks">Defect Condition Checks</h3>
<table>
<thead>
<tr>
<th>Items</th>
<th>Defect</th>
<th>This Script</th>
<th>APIC built-in</th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="#ep-announce-compatibility">EP Announce Compatibility</a></td>
<td>CSCvi76161</td>
<td><img alt="" class="gemoji" src="https://cdnjs.cloudflare.com/ajax/libs/emojione/2.2.7/assets/svg/2705.svg" title=":white_check_mark:" /></td>
<td><img alt="" class="gemoji" src="https://cdnjs.cloudflare.com/ajax/libs/emojione/2.2.7/assets/svg/1f6ab.svg" title=":no_entry_sign:" /></td>
</tr>
<tr>
<td><a href="#eventmgr-db-size-defect-susceptibility">Eventmgr DB size defect susceptibility</a></td>
<td>CSCvn20175</td>
<td><img alt="" class="gemoji" src="https://cdnjs.cloudflare.com/ajax/libs/emojione/2.2.7/assets/svg/2705.svg" title=":white_check_mark:" /></td>
<td><img alt="" class="gemoji" src="https://cdnjs.cloudflare.com/ajax/libs/emojione/2.2.7/assets/svg/1f6ab.svg" title=":no_entry_sign:" /></td>
</tr>
<tr>
<td><a href="#contract-port-22-defect">Contract Port 22 Defect</a></td>
<td>CSCvz65560</td>
<td><img alt="" class="gemoji" src="https://cdnjs.cloudflare.com/ajax/libs/emojione/2.2.7/assets/svg/2705.svg" title=":white_check_mark:" /></td>
<td><img alt="" class="gemoji" src="https://cdnjs.cloudflare.com/ajax/libs/emojione/2.2.7/assets/svg/1f6ab.svg" title=":no_entry_sign:" /></td>
</tr>
<tr>
<td><a href="#telemetrystatsserverp-object">telemetryStatsServerP Object</a></td>
<td>CSCvt47850</td>
<td><img alt="" class="gemoji" src="https://cdnjs.cloudflare.com/ajax/libs/emojione/2.2.7/assets/svg/2705.svg" title=":white_check_mark:" /></td>
<td><img alt="" class="gemoji" src="https://cdnjs.cloudflare.com/ajax/libs/emojione/2.2.7/assets/svg/1f6ab.svg" title=":no_entry_sign:" /></td>
</tr>
<tr>
<td><a href="#link-level-flow-control">Link Level Flow Control</a></td>
<td>CSCvo27498</td>
<td><img alt="" class="gemoji" src="https://cdnjs.cloudflare.com/ajax/libs/emojione/2.2.7/assets/svg/2705.svg" title=":white_check_mark:" /></td>
<td><img alt="" class="gemoji" src="https://cdnjs.cloudflare.com/ajax/libs/emojione/2.2.7/assets/svg/1f6ab.svg" title=":no_entry_sign:" /></td>
</tr>
<tr>
<td><a href="#internal-vlan-pool">Internal VLAN Pool</a></td>
<td>CSCvw33061</td>
<td><img alt="" class="gemoji" src="https://cdnjs.cloudflare.com/ajax/libs/emojione/2.2.7/assets/svg/2705.svg" title=":white_check_mark:" /></td>
<td><img alt="" class="gemoji" src="https://cdnjs.cloudflare.com/ajax/libs/emojione/2.2.7/assets/svg/1f6ab.svg" title=":no_entry_sign:" /></td>
</tr>
<tr>
<td><a href="#apic-ca-cert-validation">APIC CA Cert Validation</a></td>
<td>CSCvy35257</td>
<td><img alt="" class="gemoji" src="https://cdnjs.cloudflare.com/ajax/libs/emojione/2.2.7/assets/svg/2705.svg" title=":white_check_mark:" /></td>
<td><img alt="" class="gemoji" src="https://cdnjs.cloudflare.com/ajax/libs/emojione/2.2.7/assets/svg/1f6ab.svg" title=":no_entry_sign:" /></td>
</tr>
<tr>
<td><a href="#fabricdomain-name">FabricDomain Name</a></td>
<td>CSCwf80352</td>
<td><img alt="" class="gemoji" src="https://cdnjs.cloudflare.com/ajax/libs/emojione/2.2.7/assets/svg/2705.svg" title=":white_check_mark:" /></td>
<td><img alt="" class="gemoji" src="https://cdnjs.cloudflare.com/ajax/libs/emojione/2.2.7/assets/svg/1f6ab.svg" title=":no_entry_sign:" /></td>
</tr>
<tr>
<td><a href="#spine-sup-hw-revision">Spine SUP HW Revision</a></td>
<td>CSCwb86706</td>
<td><img alt="" class="gemoji" src="https://cdnjs.cloudflare.com/ajax/libs/emojione/2.2.7/assets/svg/2705.svg" title=":white_check_mark:" /></td>
<td><img alt="" class="gemoji" src="https://cdnjs.cloudflare.com/ajax/libs/emojione/2.2.7/assets/svg/1f6ab.svg" title=":no_entry_sign:" /></td>
</tr>
<tr>
<td><a href="#sup-aa-high-memory-usage">SUP-A/A+ High Memory Usage</a></td>
<td>CSCwh39489</td>
<td><img alt="" class="gemoji" src="https://cdnjs.cloudflare.com/ajax/libs/emojione/2.2.7/assets/svg/2705.svg" title=":white_check_mark:" /></td>
<td><img alt="" class="gemoji" src="https://cdnjs.cloudflare.com/ajax/libs/emojione/2.2.7/assets/svg/1f6ab.svg" title=":no_entry_sign:" /></td>
</tr>
<tr>
<td><a href="#vmm-uplink-container-with-empty-actives">VMM Uplink Container with empty Actives</a></td>
<td>CSCvr96408</td>
<td><img alt="" class="gemoji" src="https://cdnjs.cloudflare.com/ajax/libs/emojione/2.2.7/assets/svg/2705.svg" title=":white_check_mark:" /></td>
<td><img alt="" class="gemoji" src="https://cdnjs.cloudflare.com/ajax/libs/emojione/2.2.7/assets/svg/1f6ab.svg" title=":no_entry_sign:" /></td>
</tr>
<tr>
<td><a href="#cos-3-with-dynamic-packet-prioritization">CoS 3 with Dynamic Packet Prioritization</a></td>
<td>CSCwf05073</td>
<td><img alt="" class="gemoji" src="https://cdnjs.cloudflare.com/ajax/libs/emojione/2.2.7/assets/svg/2705.svg" title=":white_check_mark:" /></td>
<td><img alt="" class="gemoji" src="https://cdnjs.cloudflare.com/ajax/libs/emojione/2.2.7/assets/svg/1f6ab.svg" title=":no_entry_sign:" /></td>
</tr>
<tr>
<td><a href="#n9k-c93108tc-fx3pfx3h-interface-down">N9K-C93108TC-FX3P/FX3H Interface Down</a></td>
<td>CSCwh81430</td>
<td><img alt="" class="gemoji" src="https://cdnjs.cloudflare.com/ajax/libs/emojione/2.2.7/assets/svg/2705.svg" title=":white_check_mark:" /></td>
<td><img alt="" class="gemoji" src="https://cdnjs.cloudflare.com/ajax/libs/emojione/2.2.7/assets/svg/1f6ab.svg" title=":no_entry_sign:" /></td>
</tr>
<tr>
<td><a href="#invalid-fabricpathep-targets">Invalid fabricPathEp Targets</a></td>
<td>CSCwh68103</td>
<td><img alt="" class="gemoji" src="https://cdnjs.cloudflare.com/ajax/libs/emojione/2.2.7/assets/svg/2705.svg" title=":white_check_mark:" /></td>
<td><img alt="" class="gemoji" src="https://cdnjs.cloudflare.com/ajax/libs/emojione/2.2.7/assets/svg/1f6ab.svg" title=":no_entry_sign:" /></td>
</tr>
<tr>
<td><a href="#lldp-custom-interface-description">LLDP Custom Interface Description</a></td>
<td>CSCwf00416</td>
<td><img alt="" class="gemoji" src="https://cdnjs.cloudflare.com/ajax/libs/emojione/2.2.7/assets/svg/2705.svg" title=":white_check_mark:" /></td>
<td><img alt="" class="gemoji" src="https://cdnjs.cloudflare.com/ajax/libs/emojione/2.2.7/assets/svg/1f6ab.svg" title=":no_entry_sign:" /></td>
</tr>
<tr>
<td><a href="#route-map-community-match">Route-map Community Match</a></td>
<td>CSCwb08081</td>
<td><img alt="" class="gemoji" src="https://cdnjs.cloudflare.com/ajax/libs/emojione/2.2.7/assets/svg/2705.svg" title=":white_check_mark:" /></td>
<td><img alt="" class="gemoji" src="https://cdnjs.cloudflare.com/ajax/libs/emojione/2.2.7/assets/svg/1f6ab.svg" title=":no_entry_sign:" /></td>
</tr>
<tr>
<td><a href="#l3out-32-overlap-with-bd-subnet">L3out /32 overlap with BD Subnet</a></td>
<td>CSCwb91766</td>
<td><img alt="" class="gemoji" src="https://cdnjs.cloudflare.com/ajax/libs/emojione/2.2.7/assets/svg/2705.svg" title=":white_check_mark:" /></td>
<td><img alt="" class="gemoji" src="https://cdnjs.cloudflare.com/ajax/libs/emojione/2.2.7/assets/svg/1f6ab.svg" title=":no_entry_sign:" /></td>
</tr>
<tr>
<td><a href="#vzany-to-vzany-service-graph-when-crossing-50-release">vzAny-to-vzAny Service Graph when crossing 5.0 release</a></td>
<td>CSCwh75475</td>
<td><img alt="" class="gemoji" src="https://cdnjs.cloudflare.com/ajax/libs/emojione/2.2.7/assets/svg/2705.svg" title=":white_check_mark:" /></td>
<td><img alt="" class="gemoji" src="https://cdnjs.cloudflare.com/ajax/libs/emojione/2.2.7/assets/svg/1f6ab.svg" title=":no_entry_sign:" /></td>
</tr>
<tr>
<td><a href="#fcfcoe-support-for-ex-switches">FC/FCOE support for EX switches</a></td>
<td>CSCwm92166</td>
<td><img alt="" class="gemoji" src="https://cdnjs.cloudflare.com/ajax/libs/emojione/2.2.7/assets/svg/2705.svg" title=":white_check_mark:" /></td>
<td><img alt="" class="gemoji" src="https://cdnjs.cloudflare.com/ajax/libs/emojione/2.2.7/assets/svg/1f6ab.svg" title=":no_entry_sign:" /></td>
</tr>
<tr>
<td><a href="#nexus-950x-fm-or-lc-might-fail-to-boot-after-reload">Nexus 950X FM or LC Might Fail to boot after reload</a></td>
<td>CSCvg26013</td>
<td><img alt="" class="gemoji" src="https://cdnjs.cloudflare.com/ajax/libs/emojione/2.2.7/assets/svg/2705.svg" title=":white_check_mark:" /></td>
<td><img alt="" class="gemoji" src="https://cdnjs.cloudflare.com/ajax/libs/emojione/2.2.7/assets/svg/1f6ab.svg" title=":no_entry_sign:" /></td>
</tr>
<tr>
<td><a href="#stale-decommissioned-spine">Stale Decommissioned Spine</a></td>
<td>CSCwf58763</td>
<td><img alt="" class="gemoji" src="https://cdnjs.cloudflare.com/ajax/libs/emojione/2.2.7/assets/svg/2705.svg" title=":white_check_mark:" /></td>
<td><img alt="" class="gemoji" src="https://cdnjs.cloudflare.com/ajax/libs/emojione/2.2.7/assets/svg/1f6ab.svg" title=":no_entry_sign:" /></td>
</tr>
<tr>
<td><a href="#n9k-c9408-platform-model">N9K-C9408 Platform Model</a></td>
<td>CSCwk77800</td>
<td><img alt="" class="gemoji" src="https://cdnjs.cloudflare.com/ajax/libs/emojione/2.2.7/assets/svg/2705.svg" title=":white_check_mark:" /></td>
<td><img alt="" class="gemoji" src="https://cdnjs.cloudflare.com/ajax/libs/emojione/2.2.7/assets/svg/1f6ab.svg" title=":no_entry_sign:" /></td>
</tr>
<tr>
<td><a href="#pbr-high-scale">PBR High Scale</a></td>
<td>CSCwi66348</td>
<td><img alt="" class="gemoji" src="https://cdnjs.cloudflare.com/ajax/libs/emojione/2.2.7/assets/svg/2705.svg" title=":white_check_mark:" /></td>
<td><img alt="" class="gemoji" src="https://cdnjs.cloudflare.com/ajax/libs/emojione/2.2.7/assets/svg/1f6ab.svg" title=":no_entry_sign:" /></td>
</tr>
<tr>
<td><a href="#standby-sup-image-sync">Standby Sup Image Sync</a></td>
<td>CSCwi66348</td>
<td><img alt="" class="gemoji" src="https://cdnjs.cloudflare.com/ajax/libs/emojione/2.2.7/assets/svg/2705.svg" title=":white_check_mark:" /></td>
<td><img alt="" class="gemoji" src="https://cdnjs.cloudflare.com/ajax/libs/emojione/2.2.7/assets/svg/1f6ab.svg" title=":no_entry_sign:" /></td>
</tr>
<tr>
<td><a href="#observer-database-size">Observer Database Size</a></td>
<td>CSCvw45531</td>
<td><img alt="" class="gemoji" src="https://cdnjs.cloudflare.com/ajax/libs/emojione/2.2.7/assets/svg/2705.svg" title=":white_check_mark:" /></td>
<td><img alt="" class="gemoji" src="https://cdnjs.cloudflare.com/ajax/libs/emojione/2.2.7/assets/svg/1f6ab.svg" title=":no_entry_sign:" /></td>
</tr>
<tr>
<td><a href="#stale-pconsra-object">Stale pconsRA Object</a></td>
<td>CSCwp22212</td>
<td><img alt="" class="gemoji" src="https://cdnjs.cloudflare.com/ajax/libs/emojione/2.2.7/assets/svg/26a0.svg" title="Deprecated" /></td>
<td><img alt="" class="gemoji" src="https://cdnjs.cloudflare.com/ajax/libs/emojione/2.2.7/assets/svg/1f6ab.svg" title=":no_entry_sign:" /></td>
</tr>
<tr>
<td><a href="#isis-dteps-byte-size">ISIS DTEPs Byte Size</a></td>
<td>CSCwp15375</td>
<td><img alt="" class="gemoji" src="https://cdnjs.cloudflare.com/ajax/libs/emojione/2.2.7/assets/svg/2705.svg" title=":white_check_mark:" /></td>
<td><img alt="" class="gemoji" src="https://cdnjs.cloudflare.com/ajax/libs/emojione/2.2.7/assets/svg/1f6ab.svg" title=":no_entry_sign:" /></td>
</tr>
<tr>
<td><a href="#policydist-configpushshardcont-crash">Policydist configpushShardCont Crash</a></td>
<td>CSCwp95515</td>
<td><img alt="" class="gemoji" src="https://cdnjs.cloudflare.com/ajax/libs/emojione/2.2.7/assets/svg/2705.svg" title=":white_check_mark:" /></td>
<td></td>
</tr>
</tbody>
</table>
<h2 id="general-check-details">General Check Details</h2>
<h3 id="compatibility-target-aci-version">Compatibility (Target ACI Version)</h3>
<p>The <a href="https://www.cisco.com/c/dam/en/us/td/docs/Website/datacenter/apicmatrix/index.html">APIC Upgrade/Downgrade Support Matrix</a> should be checked for the supported upgrade paths from your current version.</p>
<p>The script performs the equivalent check by querying objects <code>compatRsUpgRel</code>.</p>
<h3 id="compatibility-cimc-version">Compatibility (CIMC Version)</h3>
<p>The script checks the minimum recommended CIMC version for the given APIC model on the target version by querying <code>compatRsSuppHw</code> objects.</p>
<p>As the <code>compatRsSuppHw</code> object recommendation is strictly tied to the target software image, it is possible that the <a href="https://www.cisco.com/c/en/us/support/cloud-systems-management/application-policy-infrastructure-controller-apic/tsd-products-support-series-home.html">Release Note Documentation</a> for your model/target version has a different recommendation than what the software recommends. Always check the release note of your Target version and APIC model to ensure you are getting the latest recommendations.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Older versions of CIMC may required multi-step CIMC upgrades to get to the identified target version. Refer to the <a href="https://www.cisco.com/c/dam/en/us/td/docs/unified_computing/ucs/c/sw/CIMC-Upgrade-Downgrade-Matrix/index.html">Cisco UCS Rack Server Upgrade Matrix</a> for the latest documentation on which steps are required and support given your current and target CIMC versions.</p>
</div>
<h3 id="compatibility-switch-hardware">Compatibility (Switch Hardware)</h3>
<p>The <a href="https://www.cisco.com/c/en/us/support/switches/nexus-9000-series-switches/products-release-notes-list.html">Release Notes of ACI switches</a> should be checked for the target version to make sure your hardware is supported.</p>
<p>This is mainly for downgrades because all switches operating in one ACI version will be supported in newer ACI versions, except for <a href="#compatibility-switch-hardware-gen1">generation one switches</a>.</p>
<h3 id="compatibility-switch-hardware-gen1">Compatibility (Switch Hardware - gen1)</h3>
<p>The script checks the presence of generation one switches when the upgrade is crossing 5.0(1)/15.0(1).</p>
<p>Or you can check the <a href="https://www.cisco.com/c/en/us/td/docs/dcn/aci/apic/5x/release-notes/cisco-aci-nx-os-release-notes-1501.html#_Toc140580685">Release Note 15.0(1) of ACI switches</a> to see the list of generation one switches, typically the one without any suffix such as N9K-C9372PX, that are no longer supported from 15.0(1) release.</p>
<h3 id="compatibility-remote-leaf-switch">Compatibility (Remote Leaf Switch)</h3>
<p>The script checks the requirement to use remote leaf switches on the target version.</p>
<p>It is critical to enable <strong>Direct Traffic Forwarding</strong> for remote leaf switches prior to upgrading to Cisco APIC release 5.0(1) as the option becomes mandatory starting from this release.</p>
<p><strong>Direct Traffic Forwarding</strong> can be enabled starting from the Cisco APIC release 4.1(2). Note that additional configuration for TEP IP addresses such as Routable Subnets or External TEP might be required for this option to be enabled. This means that if you are running a version prior to 4.1(2) and you have a remote leaf switch configured, you cannot directly upgrade to release 5.0. In this case, we recommend that you upgrade to a 4.2 release, enable <strong>Direct Traffic Forwarding</strong>, and then upgrade to the desired 5.0 version.</p>
<p>See "Upgrade the Remote Leaf Switches and Enable Direct Traffic Forwarding" in the <a href="https://www.cisco.com/c/en/us/support/cloud-systems-management/application-policy-infrastructure-controller-apic/tsd-products-support-series-home.html">Cisco APIC Layer 3 Networking Configuration Guide</a> for more information.</p>
<p>A related issue (CSCvs16767) is also addressed in this validation. If you are upgrading to the release 14.2(2) release while <strong>Direct Traffic Forwarding</strong> is enabled for the remote leaf switches, you may hit a defect (CSCvs16767) that could cause remote leaf switches to crash due to the Multicast FIB Distribution Manager (MFDM) process. This issue happens only when spine switches are upgraded to release 14.2(2) first while remote leaf switches with <strong>Direct Traffic Forwarding</strong> are still on release 14.1(2). Note that <strong>Direct Traffic Forwarding</strong> was introduced in release 14.1(2).</p>
<p>To avoid this issue, it is critical that you upgrade to release 14.2(3) or a later release instead of release 14.2(2) when <strong>Direct Traffic Forwarding</strong> is enabled.</p>
<p>If you must upgrade to release 14.2(2) for any reason, you must upgrade the remote leaf nodes first to avoid this issue.</p>
<h3 id="apic-target-version-image-and-md5-hash">APIC Target version image and MD5 hash</h3>
<p>When performing an upgrade in an ACI fabric, there are multiple image transfers that must occur to prepare all nodes for upgrades. Most of these transfers perform a first level image validation. However, in the event of a failure, there is value in double-checking the image on each respective node.</p>
<p>Upgrade Image transfer touchpoints:</p>
<ol>
<li>
<p>Transfer the image onto your desktop/file server from cisco.com.</p>
<p>Manually run MD5 against this image. You can validate the expected MD5 of the image from cisco.com.</p>
</li>
<li>
<p>Upload the image from your desktop or FTP server onto one of the Cisco APICs.</p>
<p>See the <em>Downloading APIC and Switch Images on APICs</em> section in the ACI Upgrade Guide for instructions on performing this operation on the Cisco APICs:</p>
<ul>
<li>Upgrading or Downgrading with APIC Releases Prior to 4.x Using the GUI</li>
<li>Upgrading or Downgrading with APIC Releases 4.x or 5.0 Using the GUI</li>
<li>Upgrading or Downgrading with APIC Release 5.1 or Later Using the GUI</li>
</ul>
<p>The Cisco APIC will automatically perform an image validation and raise a fault F0058 if the image looks corrupt or incomplete once the transfer has completed.</p>
</li>
<li>
<p>Once the image is added into the firmware repository, the initially uploaded Cisco APIC will copy that image to the remaining Cisco APICs in the cluster.</p>
<p>You can manually check MD5 on each Cisco APIC's copy of the upgrade image by running the md5sum command against each Cisco APIC's copy of the image.</p>
<div class="admonition example">
<p class="admonition-title">Example</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a>APIC1# md5sum /firmware/fwrepos/fwrepo/aci-apic-dk9.5.2.1g.bin
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>f4c79ac1bb3070b4555e507c3d310826 /firmware/fwrepos/fwrepo/aci-apic-dk9.5.2.1g.bin
</span></code></pre></div>
</div>
</li>
<li>
<p>The switches will eventually each get a copy of the switch .bin image when they are preparing for upgrade.</p>
<p>You can run MD5 on the individual switch image within /bootflash.</p>
<div class="admonition example">
<p class="admonition-title">Example</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a>leaf1# md5sum /bootflash/aci-n9000-dk9.15.2.1g.bin
</span><span id="__span-1-2"><a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a>02e3b3fb45a51e36db28e7ff917a0c96 /bootflash/aci-n9000-dk9.15.2.1g.bin
</span></code></pre></div>
</div>
</li>
</ol>
<h3 id="apic-cluster-status">APIC Cluster Status</h3>
<p>The script checks whether or not the APIC cluster is in the <strong>Fully Fit</strong> state.</p>
<p>Or you can check the status in <code>System &gt; Dashboard &gt; Controller</code> to ensure that the cluster status on all your Cisco Application Policy Infrastructure Controllers (APICs) is in the <strong>Fully Fit</strong> state. If one or more of the APICs are in other state, such as <strong>Data Layer Partially Diverged</strong>, you must resolve the status of your APIC cluster first.</p>
<p>If your APICs are currently on release 4.2(1) or later, the command <code>acidiag cluster</code> on each APIC CLI will check the basic items related to APIC clustering for you. If not, follow Initial Fabric Setup in <a href="http://cs.co/9003ybZ1d">ACI Troubleshooting Guide 2nd Edition</a></p>
<h3 id="switch-fabric-membership-status">Switch Fabric Membership Status</h3>
<p>The script checks whether or not all ACI switches are in an <strong>Active</strong> state.</p>
<p>Check <code>Fabric &gt; Inventory &gt; Fabric Membership</code> in the APIC GUI to ensure that all your ACI switches are in an <strong>Active</strong> state. If one or more of the ACI switches are in other state, such as <strong>Inactive</strong>, <strong>Maintenance</strong>, etc., you must resolve those issues first.</p>
<p><strong>Inactive</strong>: This means that the switch has fabric discovery issues, such as IP reachability from APICs through the ACI infra network. If your switches are currently on release 14.2(1) or later, the command <code>show discoveryissues</code> on the switch CLI will check the basic items related to switch fabric discovery for you.</p>
<p><strong>Maintenance</strong>: This means that the switch is in <strong>Maintenance Mode</strong> through the GIR (Graceful Insertion and Removal) operation. This implies that the switch is isolated from the fabric and does not process most of the APIC communications, including the upgrade-related communications. You must bring the switch back to the <strong>Active</strong> state before you can perform an upgrade. If you want to gracefully upgrade the switch by isolating the switches from the network first, consider <strong>Graceful Upgrade</strong> instead. See the <a href="https://www.cisco.com/c/en/us/td/docs/dcn/aci/apic/all/apic-installation-aci-upgrade-downgrade/Cisco-APIC-Installation-ACI-Upgrade-Downgrade-Guide/m-aci-firmware-upgrade-overview.html#Cisco_Concept.dita_78b8949b-2c61-4186-bca1-23954c7b3971__section_pyw_dss_gqb">Graceful Upgrade or Downgrade of ACI Switches</a> section in the ACI Upgrade Guide for details.</p>
<h3 id="ntp-status">NTP Status</h3>
<p>The script checks all ACI nodes (APICs and switches) are synchronized to NTP.</p>
<p>Ensure that NTP is configured on both the APICs and the ACI switches along with the necessary IP reachability to the NTP servers through Out-of-band (OOB) or In-band (INB) from each individual node.</p>
<p>Check the following sections in <a href="http://cs.co/9003ybZ1d">ACI Troubleshooting Guide 2nd Edition</a></p>
<ul>
<li>In-band and out-of-band management</li>
<li>Pod Policies  BGP RR / Date&amp;Time / SNMP</li>
</ul>
<h3 id="firmwaremaintenance-groups-when-crossing-40-release">Firmware/Maintenance Groups when crossing 4.0 Release</h3>
<p>Beginning with Cisco APIC release 4.0(1), there is only one type of switch update group instead of the two that were used in previous releases (the firmware groups and maintenance groups). By consolidating two groups into one, the upgrade configurations are simplified. However, when upgrading Cisco APICs from a pre-4.0 release to release 4.0(1) or later, you must remove all firmware group and maintenance group policies prior to the upgrade.</p>
<ul>
<li>
<p>To remove a firmware group policy, navigate to <code>Admin &gt; Firmware &gt; Fabric Node Firmware &gt; Firmware Groups</code>, then right-click on the name of firmware group and choose <code>Delete the Firmware Group</code>.</p>
</li>
<li>
<p>To remove a maintenance group policy, navigate to <code>Admin &gt; Firmware &gt; Fabric Node Firmware &gt; Maintenance Groups</code>, then right-click on the name of maintenance group and choose <code>Delete the Maintenance Group</code>.</p>
</li>
</ul>
<p>Once the Cisco APICs are upgraded to 4.0(1) or later, you can create new switch update groups and perform the switch upgrade from pre-14.0 release to 14.0(1) or later.</p>
<p>This is applicable only when you are upgrading your Cisco APICs from pre-4.0 to 4.0(1) or later. Once your Cisco APICs are on 4.0(1) or later, you do not have to worry about this for any further upgrades.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Internally, Cisco APICs running the 4.0(1) or later release handle the switch update groups with the same objects as the old maintenance group policies (such as <strong>maintMaintP</strong>), but with additional attributes. If you are using an API to configure upgrade policies, you should only use maintenance group policies starting from Cisco APIC release 4.0(1) or later without manually creating any firmware group policies, unlike the old pre-4.0 releases.</p>
</div>
<h3 id="features-that-need-to-be-disabled-prior-to-upgrade">Features that need to be disabled prior to Upgrade</h3>
<p>The following features must be disabled prior to upgrades or downgrades:</p>
<ul>
<li>App Center apps</li>
<li>Maintenance Mode through Fabric &gt; Inventory &gt; Fabric Membership &gt; Maintenance (GIR)</li>
<li>Config Zone</li>
<li>Rogue Endpoint (only when the running version is 14.1(x) or when upgrading to 14.1(x))</li>
</ul>
<h3 id="switch-upgrade-group-guidelines">Switch Upgrade Group Guidelines</h3>
<p>The script checks if these <a href="https://www.cisco.com/c/en/us/td/docs/dcn/aci/apic/all/apic-installation-aci-upgrade-downgrade/Cisco-APIC-Installation-ACI-Upgrade-Downgrade-Guide/m-aci-firmware-upgrade-overview.html#Cisco_Concept.dita_78b8949b-2c61-4186-bca1-23954c7b3971">guidelines from the ACI Upgrade Guide</a> are followed.</p>
<ul>
<li>Rule 1  Divide your leaf and spine switches into at least two groups</li>
<li>Rule 2  Determine how spine switches should be grouped</li>
<li>Rule 3  Determine how leaf switches should be grouped</li>
</ul>
<h3 id="intersight-device-connector-upgrade-status">Intersight Device Connector upgrade status</h3>
<p>If you start an Cisco APIC upgrade while an intersight Device Connector (DC) upgrade is in progress, the DC upgrade may fail.</p>
<p>You can check the status of intersight DC from <code>System &gt; System Settings &gt; intersight</code>. If the upgrade of the DC is in progress, wait for a minute and retry the Cisco APIC upgrade. The upgrade of the Intersight Device Connector typically takes less than a minute.</p>
<h3 id="mini-aci-upgrade-to-602-or-later">Mini ACI Upgrade to 6.0(2) or later</h3>
<p>Starting with APIC Release 6.0(2), controllers use a new linux operating system which requires any virtual APIC to be redeployed on the target version.</p>
<p>When upgrading from ACI release 6.0(1) or earlier to release 6.0(2) or later, any virtual APICs must be removed from the APIC cluster prior to upgrade. You must follow the documented steps under the <a href="https://www.cisco.com/c/en/us/td/docs/switches/datacenter/aci/apic/sw/kb/cisco-mini-aci-fabric.html#Cisco_Task_in_List_GUI.dita_2d9ca023-714c-4341-9112-d96a7a598ee6">Mini ACI Upgrade Guide</a> for this specific upgrade path. A regular policy upgrade will fail and result in a diverged cluster.</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>You can check whether any APICs are virtual by querying <code>topSystem</code> and looking at the <code>nodeType</code> attribute. <code>unspecified</code> is used for any physical APIC appliance while <code>virtual</code> is used for any virtual APIC.
<div class="language-text highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a># top.System
</span><span id="__span-2-2"><a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a>address                  : 10.1.0.2
</span><span id="__span-2-3"><a id="__codelineno-2-3" name="__codelineno-2-3" href="#__codelineno-2-3"></a>--- omit ---
</span><span id="__span-2-4"><a id="__codelineno-2-4" name="__codelineno-2-4" href="#__codelineno-2-4"></a>dn                       : topology/pod-1/node-2/sys
</span><span id="__span-2-5"><a id="__codelineno-2-5" name="__codelineno-2-5" href="#__codelineno-2-5"></a>lastRebootTime           : 2024-04-21T11:35:24.844-04:00
</span><span id="__span-2-6"><a id="__codelineno-2-6" name="__codelineno-2-6" href="#__codelineno-2-6"></a>lastResetReason          : unknown
</span><span id="__span-2-7"><a id="__codelineno-2-7" name="__codelineno-2-7" href="#__codelineno-2-7"></a>lcOwn                    : local
</span><span id="__span-2-8"><a id="__codelineno-2-8" name="__codelineno-2-8" href="#__codelineno-2-8"></a>modTs                    : 2024-04-21T11:56:04.032-04:00
</span><span id="__span-2-9"><a id="__codelineno-2-9" name="__codelineno-2-9" href="#__codelineno-2-9"></a>mode                     : unspecified
</span><span id="__span-2-10"><a id="__codelineno-2-10" name="__codelineno-2-10" href="#__codelineno-2-10"></a>monPolDn                 : uni/fabric/monfab-default
</span><span id="__span-2-11"><a id="__codelineno-2-11" name="__codelineno-2-11" href="#__codelineno-2-11"></a>name                     : vapic2
</span><span id="__span-2-12"><a id="__codelineno-2-12" name="__codelineno-2-12" href="#__codelineno-2-12"></a>nameAlias                :
</span><span id="__span-2-13"><a id="__codelineno-2-13" name="__codelineno-2-13" href="#__codelineno-2-13"></a>nodeType                 : virtual
</span><span id="__span-2-14"><a id="__codelineno-2-14" name="__codelineno-2-14" href="#__codelineno-2-14"></a>--- omit ---
</span></code></pre></div></p>
</div>
<h3 id="post-upgrade-callback-integrity">Post Upgrade CallBack Integrity</h3>
<p>Post APIC cluster upgrade, APICs may invoke the post-upgrade callback against an existing object class, which will introduce an object of the new class corresponding to the existing class to extend/enhance/optimize an existing feature. This is also called data conversion.</p>
<p>Once successfully completed, the number of objects for the existing and newly created classes should be the same.</p>
<p>If the post-upgrade callback has failed or hasn't been able to fully complete for some reason, the data conversion will be incomplete.The impact of incomplete data conversion varies depending on the class that is missing as a result.</p>
<p>The post-upgrade callback may fail due to a software defect, or due to an inappropriate human intervention during APIC upgrades such as decommissioning an APIC, rebooting an APIC etc.</p>
<p>This validation checks whether the number of objects for the existing and newly created classes are the same.</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>This validation <strong>must</strong> be performed after an APIC upgrade but before a switch upgrade.</p>
<p>Regardless of this validation, it is a best practice to run this script twice, before an APIC upgrade AND before a switch upgrade, especially when the upgrade of the entire fabric cannot be completed within the same maintenance window. If you have been doing it, please keep doing it. If not, make sure to do that because this specific validation must be run after an APIC upgrade.
Because of this reason, this validation warns users to run the script again if the current APIC version and the target version are different when the script is run because it implies the script was run before an APIC upgrade.</p>
</div>
<div class="admonition example">
<p class="admonition-title">Example</p>
<p>If the old/new class result is <code>infraRsToEncapInstDef</code>/<code>infraAssocEncapInstDef</code> or <code>infraRsToInterfacePolProfile</code>/<code>infraRsToInterfacePolProfileOpt</code>, the impact of incomplete post-upgrade callback (i.e. incomplete data conversion) is that VLANs will not be deployed on leaf switches after the upgrade of the switch.</p>
<p>You can check the number of objects for each of these classes via moquery and the query option <code>rsp-subtree-include=count</code>:
<div class="language-text highlight"><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a>apic1# moquery -c infraRsToEncapInstDef -x rsp-subtree-include=count
</span><span id="__span-3-2"><a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a>Total Objects shown: 1
</span><span id="__span-3-3"><a id="__codelineno-3-3" name="__codelineno-3-3" href="#__codelineno-3-3"></a>
</span><span id="__span-3-4"><a id="__codelineno-3-4" name="__codelineno-3-4" href="#__codelineno-3-4"></a># mo.Count
</span><span id="__span-3-5"><a id="__codelineno-3-5" name="__codelineno-3-5" href="#__codelineno-3-5"></a>childAction  :
</span><span id="__span-3-6"><a id="__codelineno-3-6" name="__codelineno-3-6" href="#__codelineno-3-6"></a>count        : 11
</span><span id="__span-3-7"><a id="__codelineno-3-7" name="__codelineno-3-7" href="#__codelineno-3-7"></a>dn           : cnt
</span><span id="__span-3-8"><a id="__codelineno-3-8" name="__codelineno-3-8" href="#__codelineno-3-8"></a>lcOwn        : local
</span><span id="__span-3-9"><a id="__codelineno-3-9" name="__codelineno-3-9" href="#__codelineno-3-9"></a>modTs        : never
</span><span id="__span-3-10"><a id="__codelineno-3-10" name="__codelineno-3-10" href="#__codelineno-3-10"></a>rn           : cnt
</span><span id="__span-3-11"><a id="__codelineno-3-11" name="__codelineno-3-11" href="#__codelineno-3-11"></a>status       :
</span><span id="__span-3-12"><a id="__codelineno-3-12" name="__codelineno-3-12" href="#__codelineno-3-12"></a>
</span><span id="__span-3-13"><a id="__codelineno-3-13" name="__codelineno-3-13" href="#__codelineno-3-13"></a>
</span><span id="__span-3-14"><a id="__codelineno-3-14" name="__codelineno-3-14" href="#__codelineno-3-14"></a>apic1# moquery -c infraAssocEncapInstDef -x rsp-subtree-include=count
</span><span id="__span-3-15"><a id="__codelineno-3-15" name="__codelineno-3-15" href="#__codelineno-3-15"></a>Total Objects shown: 1
</span><span id="__span-3-16"><a id="__codelineno-3-16" name="__codelineno-3-16" href="#__codelineno-3-16"></a>
</span><span id="__span-3-17"><a id="__codelineno-3-17" name="__codelineno-3-17" href="#__codelineno-3-17"></a># mo.Count
</span><span id="__span-3-18"><a id="__codelineno-3-18" name="__codelineno-3-18" href="#__codelineno-3-18"></a>childAction  :
</span><span id="__span-3-19"><a id="__codelineno-3-19" name="__codelineno-3-19" href="#__codelineno-3-19"></a>count        : 11
</span><span id="__span-3-20"><a id="__codelineno-3-20" name="__codelineno-3-20" href="#__codelineno-3-20"></a>dn           : cnt
</span><span id="__span-3-21"><a id="__codelineno-3-21" name="__codelineno-3-21" href="#__codelineno-3-21"></a>lcOwn        : local
</span><span id="__span-3-22"><a id="__codelineno-3-22" name="__codelineno-3-22" href="#__codelineno-3-22"></a>modTs        : never
</span><span id="__span-3-23"><a id="__codelineno-3-23" name="__codelineno-3-23" href="#__codelineno-3-23"></a>rn           : cnt
</span><span id="__span-3-24"><a id="__codelineno-3-24" name="__codelineno-3-24" href="#__codelineno-3-24"></a>status       :
</span></code></pre></div></p>
<p>If the Mo count for both old/new classes are the same, it means that new class was created successfully after the APIC upgrade by the old class's post-upgrade callback.</p>
</div>
<h3 id="602-requires-32-and-64-bit-switch-images">6.0(2)+ requires 32 and 64 bit switch images</h3>
<p>When targeting any version that is 6.0(2) or greater, download both the 32-bit and 64-bit Cisco ACI-mode switch images to the Cisco APIC. Downloading only one of the images may result in errors during the upgrade process.</p>
<p>For additional information, see the <a href="https://www.cisco.com/c/en/us/td/docs/dcn/aci/apic/all/apic-installation-aci-upgrade-downgrade/Cisco-APIC-Installation-ACI-Upgrade-Downgrade-Guide/m-aci-upgrade-downgrade-architecture.html#Cisco_Reference.dita_22480abb-4138-416b-8dd5-ecde23f707b4">Guidelines and Limitations for Upgrading or Downgrading</a> section of the Cisco APIC Installation and ACI Upgrade and Downgrade Guide.</p>
<h3 id="fabric-link-redundancy">Fabric Link Redundancy</h3>
<p>When upgrading the switches, traffic traversing a Leaf Switch that is connected to only a single spine (or a tier-2 Leaf Switch that is connected to only a single tier-1 Leaf Switch) will exhibit a Data Path Outage during the spine (or tier-1 leaf) upgrade as there will be no alternate dataplane paths available.</p>
<p>To prevent this scenario, ensure that every leaf is connected to at least two Spine Switches (or tier-1 Leaf Switches). This check will alert if any Leaf Switches are found to only be connected to a single Spine Switch (or tier-1 Leaf Switch).</p>
<h3 id="apic-database-size">APIC Database Size</h3>
<p>APIC Database Shard sizing is generally expected to remain below 5G in steady-state conditions, even in the case of high scale setups. Database shard sizing directly influences the Upgrade Workflow timing, as the database conversion phase directly involves parsing through the entire DB contents. Large shards lead to longer upgrade timings, which in some cases have been seen to lead to upgrade failures. In most cases, a large shard size has been mapped to an underlying condition that needs to be addressed.</p>
<p>The script performs 2 different checks depending on the version you are running.</p>
<p>For current versions below 6.1(3):</p>
<ul>
<li>The script checks all APICs' class's object count for a subset of services (DMEs) via a file scan. </li>
<li>If the count is found to be above <code>150*1000*1000</code>, then that class will be flagged for further investigation.</li>
</ul>
<p>For current version is 6.1(3f):</p>
<ul>
<li>6.1(3f) introduces a new <code>acidiag dbsize</code> command which displays the top largest DB sizes. </li>
<li>The script will utilize the new command and flag any DB shard which have surpassed 5G.</li>
</ul>
<p>In either scenario, contact TAC to collect a database dump of the flagged DME(s) and shard(s) for further analysis.</p>
<h3 id="apic-downgrade-compatibility-when-crossing-62-release">APIC downgrade compatibility when crossing 6.2 release</h3>
<p>APIC 6.2(1) release introduces significant optimizations to the APIC upgrade process, including shorter upgrade time and an orchestrated workflow across the cluster with fewer failure points. This release includes an architecture change on APIC, so APIC running 6.2(1) or newer (e.g., 6.2(1a)) cannot be downgraded to any pre-6.2(1) version (e.g., 6.1(4h)).</p>
<p>Upgrading from pre-6.2(1) to 6.2(1)+ is supported; however, rollback (downgrade) after such an upgrade is not possible.</p>
<p>This check alerts you if you are crossing the 6.2 boundary, beyond which downgrade compatibility is lost. No additional user action is required.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Switch upgrade architecture hasn't been changed in 6.2(1)/16.2(1). The limitation of downgrade compatibility between pre-/post-6.2(1) versions is only for APIC.</p>
</div>
<div class="admonition example">
<p class="admonition-title">Example</p>
<p>These are examples for upgrade/downgrade paths to show which downgrade compatibility is lost.</p>
<p>Upgrade:</p>
<ul>
<li>6.1(4) -&gt; <strong>6.2(1)</strong>: Supported</li>
<li><strong>6.2(1)</strong> -&gt; 6.2(2): Supported</li>
</ul>
<p>Downgrade:</p>
<ul>
<li><strong>6.2(1)</strong> -&gt; 6.1(4): Not Supported !!! - The API request gets rejected on APIC.</li>
<li>6.2(2) -&gt; <strong>6.2(1)</strong>: Supported</li>
</ul>
<p>Note that this is just one example. See <a href="https://www.cisco.com/c/en/us/support/switches/nexus-9000-series-switches/products-release-notes-list.html">APIC Upgrade/Downgrade Matrix</a> for the full list of supported version combinations.</p>
</div>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>Make sure to collect the latest configuration backup before you upgrade your APICs from pre-6.2(1) to 6.2(1)+ so that Cisco TAC can perform the fabric recovery process in the case of emergency where you need to downgrade your APICs to the previous version (i.e. 6.2(1)+ -&gt; pre-6.2(1)).</p>
<p>If it's for a lab environment, you can initialize the fabric and perform a fresh ISO installation of pre-6.2(1) on APICs.</p>
</div>
<h2 id="fault-check-details">Fault Check Details</h2>
<h3 id="apic-disk-space-usage">APIC Disk Space Usage</h3>
<p>If a Cisco APIC is running low on disk space for any reason, the Cisco APIC upgrade can fail. The Cisco APIC will raise three different faults depending on the amount of disk space remaining. If any of these faults are raised on the system, the issue should be resolved prior to performing the upgrade.</p>
<ul>
<li>
<p><strong>F1527</strong>: A warning level fault for Cisco APIC disk space usage. This is raised when the utilization is between 80% and 85%.</p>
</li>
<li>
<p><strong>F1528</strong>: A major level fault for Cisco APIC disk space usage. This is raised when the utilization is between 85% and 90%.</p>
</li>
<li>
<p><strong>F1529</strong>: A critical level fault for Cisco APIC disk space usage. This is raised when the utilization is between 90% and above.</p>
</li>
</ul>
<p>You can run the following <code>moquery</code> on the CLI of any Cisco APIC to check if these faults exist on the system. The faults are visible within the GUI as well. In the example below, with the faults against <code>/firmware</code>, you can simply remove unnecessary firmware images under <code>Admin &gt; Firmware</code> in the Cisco APIC GUI. You should not perform the Linux command rm to remove an image directly from <code>/firmware</code>, as the firmware images are synchronized across Cisco APICs. If the fault is raised against a disk space that you are not aware of, contact Cisco TAC to resolve the issue prior to the upgrade.</p>
<div class="admonition example">
<p class="admonition-title">Fault Example (F1528: Major Fault for APIC disk space usage)</p>
<p>The following shows an example situation where the disk space in <code>/firmware</code> is running low on APIC 1 (node 1).
<div class="language-text highlight"><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a>admin@apic1:~&gt; moquery -c faultInst -f &#39;fault.Inst.code==&quot;F1528&quot;&#39;
</span><span id="__span-4-2"><a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a>Total Objects shown: 1
</span><span id="__span-4-3"><a id="__codelineno-4-3" name="__codelineno-4-3" href="#__codelineno-4-3"></a>
</span><span id="__span-4-4"><a id="__codelineno-4-4" name="__codelineno-4-4" href="#__codelineno-4-4"></a># fault.Inst
</span><span id="__span-4-5"><a id="__codelineno-4-5" name="__codelineno-4-5" href="#__codelineno-4-5"></a>code             : F1528
</span><span id="__span-4-6"><a id="__codelineno-4-6" name="__codelineno-4-6" href="#__codelineno-4-6"></a>ack              : no
</span><span id="__span-4-7"><a id="__codelineno-4-7" name="__codelineno-4-7" href="#__codelineno-4-7"></a>annotation       :
</span><span id="__span-4-8"><a id="__codelineno-4-8" name="__codelineno-4-8" href="#__codelineno-4-8"></a>cause            : equipment-full
</span><span id="__span-4-9"><a id="__codelineno-4-9" name="__codelineno-4-9" href="#__codelineno-4-9"></a>changeSet        : available (Old: 5646352, New: 6036744), capUtilized (Old: 86, New: 85), used (Old: 33393968, New: 33003576)
</span><span id="__span-4-10"><a id="__codelineno-4-10" name="__codelineno-4-10" href="#__codelineno-4-10"></a>childAction      :
</span><span id="__span-4-11"><a id="__codelineno-4-11" name="__codelineno-4-11" href="#__codelineno-4-11"></a>created          : 2021-05-27T11:58:19.061-04:00
</span><span id="__span-4-12"><a id="__codelineno-4-12" name="__codelineno-4-12" href="#__codelineno-4-12"></a>delegated        : no
</span><span id="__span-4-13"><a id="__codelineno-4-13" name="__codelineno-4-13" href="#__codelineno-4-13"></a>descr            : Storage unit /firmware on Node 1 with hostname apic1 mounted at /firmware is 85% full
</span><span id="__span-4-14"><a id="__codelineno-4-14" name="__codelineno-4-14" href="#__codelineno-4-14"></a>dn               : topology/pod-1/node-1/sys/ch/p-[/firmware]-f-[/dev/mapper/vg_ifc0-firmware]/fault-F1528
</span><span id="__span-4-15"><a id="__codelineno-4-15" name="__codelineno-4-15" href="#__codelineno-4-15"></a>domain           : infra
</span><span id="__span-4-16"><a id="__codelineno-4-16" name="__codelineno-4-16" href="#__codelineno-4-16"></a>extMngdBy        : undefined
</span><span id="__span-4-17"><a id="__codelineno-4-17" name="__codelineno-4-17" href="#__codelineno-4-17"></a>highestSeverity  : major
</span><span id="__span-4-18"><a id="__codelineno-4-18" name="__codelineno-4-18" href="#__codelineno-4-18"></a>lastTransition   : 2021-05-27T12:01:37.128-04:00
</span><span id="__span-4-19"><a id="__codelineno-4-19" name="__codelineno-4-19" href="#__codelineno-4-19"></a>lc               : raised
</span><span id="__span-4-20"><a id="__codelineno-4-20" name="__codelineno-4-20" href="#__codelineno-4-20"></a>modTs            : never
</span><span id="__span-4-21"><a id="__codelineno-4-21" name="__codelineno-4-21" href="#__codelineno-4-21"></a>occur            : 1
</span><span id="__span-4-22"><a id="__codelineno-4-22" name="__codelineno-4-22" href="#__codelineno-4-22"></a>origSeverity     : major
</span><span id="__span-4-23"><a id="__codelineno-4-23" name="__codelineno-4-23" href="#__codelineno-4-23"></a>prevSeverity     : major
</span><span id="__span-4-24"><a id="__codelineno-4-24" name="__codelineno-4-24" href="#__codelineno-4-24"></a>rn               : fault-F1528
</span><span id="__span-4-25"><a id="__codelineno-4-25" name="__codelineno-4-25" href="#__codelineno-4-25"></a>rule             : eqpt-storage-full-major
</span><span id="__span-4-26"><a id="__codelineno-4-26" name="__codelineno-4-26" href="#__codelineno-4-26"></a>severity         : major
</span><span id="__span-4-27"><a id="__codelineno-4-27" name="__codelineno-4-27" href="#__codelineno-4-27"></a>status           :
</span><span id="__span-4-28"><a id="__codelineno-4-28" name="__codelineno-4-28" href="#__codelineno-4-28"></a>subject          : equipment-full
</span><span id="__span-4-29"><a id="__codelineno-4-29" name="__codelineno-4-29" href="#__codelineno-4-29"></a>type             : operational
</span><span id="__span-4-30"><a id="__codelineno-4-30" name="__codelineno-4-30" href="#__codelineno-4-30"></a>uid              :
</span></code></pre></div></p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>All three faults look the same except for the utilization percentage and the faults severity.</p>
</div>
<h3 id="standby-apic-disk-space-usage">Standby APIC Disk Space Usage</h3>
<p>Because a standby Cisco APIC is a cold standby and is not part of the cluster, it is not actively monitored for fault conditions. As filesystem full checks falls under this category, this means that any standby Cisco APICs exhibiting these conditions will not flag a fault and instead must be manually verified.</p>
<p>The script performs SSH into each standby Cisco APIC as <code>rescue-user</code>, then run <code>df -h</code> to verify the filesystem usage. If any filesystem is found to be at 75% or above, the script will alert users to contact TAC to identify and clear out the condition.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This check is not using faults but positioned in Fault Check just to be viewed with other disk space usage checks using faults.</p>
</div>
<h3 id="switch-node-bootflash-usage">Switch Node <code>/bootflash</code> usage</h3>
<p>ACI switches mainly have two different faults about the filesystem usage of each partition:</p>
<ul>
<li>
<p><strong>F1820</strong>: A minor level fault for switch partition usage. This is raised when the utilization of the partition exceeds the minor threshold.</p>
</li>
<li>
<p><strong>F1821</strong>: A major level fault for switch partition usage. This is raised when the utilization of the partition exceeds the major threshold.</p>
</li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The threshold for minor and major depends on partitions. The critical one for upgrades is <code>/bootflash</code>. The threshold of bootflash is 80% for minor and 90% for major threshold.</p>
</div>
<p>On top of this, there is a built-in behavior added to every switch node where it will take action to ensure that the <code>/bootflash</code> directory maintains 50% capacity. This is specifically to ensure that switch upgrades are able to successfully transfer and extract the switch image over during an upgrade.</p>
<p>To do this, there is an internal script that is monitoring <code>/bootflash</code> usage and, if over 50% usage, it will start removing files to free up the filesystem. Given its aggressiveness, there are some corner case scenarios where this cleanup script could potentially trigger against the switch image it is intending to use, which can result in a switch upgrade booting a switch into the loader prompt given that the boot image was removed from <code>/bootflash</code>.</p>
<p>To prevent this, check the <code>/bootflash</code> prior to an upgrade and take the necessary steps to understand what is written there and why. Once understood, take the necessary steps to clear up unnecessary <code>/bootflash</code> files to ensure there is enough space to prevent the auto-cleanup corner case scenario.</p>
<p>The pre-upgrade validation built into Cisco APIC upgrade workflow monitors the fault F1821, which can capture the high utilization of any partition. When this fault is present, we recommend that you resolve it prior to the upgrade even if the fault is not for bootflash.</p>
<p>The ACI Pre-Upgrade Validation script (this script) focuses on the utilization of bootflash on each switch specifically to see if there are any issues with bootflash where the usage is more than 50%, which might trigger the internal cleanup script.</p>
<div class="admonition example">
<p class="admonition-title">Example of a query used by this script</p>
<p>The script is calculating the bootflash usage using <code>avail</code> and <code>used</code> in the object <code>eqptcapacityFSPartition</code> for each switch.
<div class="language-text highlight"><pre><span></span><code><span id="__span-5-1"><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a>f2-apic1# moquery -c eqptcapacityFSPartition -f &#39;eqptcapacity.FSPartition.path==&quot;/bootflash&quot;&#39;
</span><span id="__span-5-2"><a id="__codelineno-5-2" name="__codelineno-5-2" href="#__codelineno-5-2"></a>Total Objects shown: 6
</span><span id="__span-5-3"><a id="__codelineno-5-3" name="__codelineno-5-3" href="#__codelineno-5-3"></a>
</span><span id="__span-5-4"><a id="__codelineno-5-4" name="__codelineno-5-4" href="#__codelineno-5-4"></a># eqptcapacity.FSPartition
</span><span id="__span-5-5"><a id="__codelineno-5-5" name="__codelineno-5-5" href="#__codelineno-5-5"></a>name            : bootflash
</span><span id="__span-5-6"><a id="__codelineno-5-6" name="__codelineno-5-6" href="#__codelineno-5-6"></a>avail           : 7214920
</span><span id="__span-5-7"><a id="__codelineno-5-7" name="__codelineno-5-7" href="#__codelineno-5-7"></a>childAction     :
</span><span id="__span-5-8"><a id="__codelineno-5-8" name="__codelineno-5-8" href="#__codelineno-5-8"></a>dn              : topology/pod-1/node-101/sys/eqptcapacity/fspartition-bootflash
</span><span id="__span-5-9"><a id="__codelineno-5-9" name="__codelineno-5-9" href="#__codelineno-5-9"></a>memAlert        : normal
</span><span id="__span-5-10"><a id="__codelineno-5-10" name="__codelineno-5-10" href="#__codelineno-5-10"></a>modTs           : never
</span><span id="__span-5-11"><a id="__codelineno-5-11" name="__codelineno-5-11" href="#__codelineno-5-11"></a>monPolDn        : uni/fabric/monfab-default
</span><span id="__span-5-12"><a id="__codelineno-5-12" name="__codelineno-5-12" href="#__codelineno-5-12"></a>path            : /bootflash
</span><span id="__span-5-13"><a id="__codelineno-5-13" name="__codelineno-5-13" href="#__codelineno-5-13"></a>rn              : fspartition-bootflash
</span><span id="__span-5-14"><a id="__codelineno-5-14" name="__codelineno-5-14" href="#__codelineno-5-14"></a>status          :
</span><span id="__span-5-15"><a id="__codelineno-5-15" name="__codelineno-5-15" href="#__codelineno-5-15"></a>used            : 4320184
</span><span id="__span-5-16"><a id="__codelineno-5-16" name="__codelineno-5-16" href="#__codelineno-5-16"></a>--- omit ---
</span></code></pre></div></p>
</div>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>Alternatively you can log into a leaf switch CLI, and check <code>/bootflash</code> usage <code>df -h</code>
<div class="language-text highlight"><pre><span></span><code><span id="__span-6-1"><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a>leaf1# df -h
</span><span id="__span-6-2"><a id="__codelineno-6-2" name="__codelineno-6-2" href="#__codelineno-6-2"></a>Filesystem             Size    Used   Avail   Use%   Mounted on
</span><span id="__span-6-3"><a id="__codelineno-6-3" name="__codelineno-6-3" href="#__codelineno-6-3"></a>rootfs                 2.5G    935M   1.6G    38%    /bin
</span><span id="__span-6-4"><a id="__codelineno-6-4" name="__codelineno-6-4" href="#__codelineno-6-4"></a>/dev/sda4               12G    5.7G   4.9G    54%    /bootflash
</span><span id="__span-6-5"><a id="__codelineno-6-5" name="__codelineno-6-5" href="#__codelineno-6-5"></a>/dev/sda2              4.7G    9.6M   4.4G     1%    /recovery
</span><span id="__span-6-6"><a id="__codelineno-6-6" name="__codelineno-6-6" href="#__codelineno-6-6"></a>/dev/mapper/map-sda9    11G    5.7G   4.2G    58%    /isan/lib
</span><span id="__span-6-7"><a id="__codelineno-6-7" name="__codelineno-6-7" href="#__codelineno-6-7"></a>none                   3.0G    602M   2.5G    20%    /dev/shm
</span><span id="__span-6-8"><a id="__codelineno-6-8" name="__codelineno-6-8" href="#__codelineno-6-8"></a>none                    50M    3.4M    47M     7%    /etc
</span><span id="__span-6-9"><a id="__codelineno-6-9" name="__codelineno-6-9" href="#__codelineno-6-9"></a>/dev/sda6               56M    1.3M    50M     3%    /mnt/cfg/1
</span><span id="__span-6-10"><a id="__codelineno-6-10" name="__codelineno-6-10" href="#__codelineno-6-10"></a>/dev/sda5               56M    1.3M    50M     3%    /mnt/cfg/0
</span><span id="__span-6-11"><a id="__codelineno-6-11" name="__codelineno-6-11" href="#__codelineno-6-11"></a>/dev/sda8               15G    140M    15G     1%    /mnt/ifc/log
</span><span id="__span-6-12"><a id="__codelineno-6-12" name="__codelineno-6-12" href="#__codelineno-6-12"></a>/dev/sda3              115M     52M    54M    50%    /mnt/pss
</span><span id="__span-6-13"><a id="__codelineno-6-13" name="__codelineno-6-13" href="#__codelineno-6-13"></a>none                   1.5G    2.3M   1.5G     1%    /tmp
</span><span id="__span-6-14"><a id="__codelineno-6-14" name="__codelineno-6-14" href="#__codelineno-6-14"></a>none                    50M    240K    50M     1%    /var/log
</span><span id="__span-6-15"><a id="__codelineno-6-15" name="__codelineno-6-15" href="#__codelineno-6-15"></a>/dev/sda7               12G    1.4G   9.3G    13%    /logflash
</span><span id="__span-6-16"><a id="__codelineno-6-16" name="__codelineno-6-16" href="#__codelineno-6-16"></a>none                   350M     54M   297M    16%    /var/log/dme/log/dme_logs
</span><span id="__span-6-17"><a id="__codelineno-6-17" name="__codelineno-6-17" href="#__codelineno-6-17"></a>none                   512M     24M   489M     5%    /var/sysmgr/mem_logs
</span><span id="__span-6-18"><a id="__codelineno-6-18" name="__codelineno-6-18" href="#__codelineno-6-18"></a>none                    40M    4.0K    40M     1%    /var/sysmgr/startup-cfg
</span><span id="__span-6-19"><a id="__codelineno-6-19" name="__codelineno-6-19" href="#__codelineno-6-19"></a>none                   500M     0     500M     0%    /volatile
</span></code></pre></div></p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If you suspect that the auto cleanup removed some files within <code>/bootflash</code>, you can review a log to validate this:</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-7-1"><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a>leaf1# egrep &quot;higher|removed&quot; /mnt/pss/core_control.log
</span><span id="__span-7-2"><a id="__codelineno-7-2" name="__codelineno-7-2" href="#__codelineno-7-2"></a>[2020-07-22 16:52:08.928318] Bootflash Usage is higher than 50%!!
</span><span id="__span-7-3"><a id="__codelineno-7-3" name="__codelineno-7-3" href="#__codelineno-7-3"></a>[2020-07-22 16:52:08.931990] File: MemoryLog.65%_usage removed !!
</span><span id="__span-7-4"><a id="__codelineno-7-4" name="__codelineno-7-4" href="#__codelineno-7-4"></a>[2020-07-22 16:52:08.943914] File: mem_log.txt.old.gz removed !!
</span><span id="__span-7-5"><a id="__codelineno-7-5" name="__codelineno-7-5" href="#__codelineno-7-5"></a>[2020-07-22 16:52:08.955376] File: libmon.logs removed !!
</span><span id="__span-7-6"><a id="__codelineno-7-6" name="__codelineno-7-6" href="#__codelineno-7-6"></a>[2020-07-22 16:52:08.966686] File: urib_api_log.txt removed !!
</span><span id="__span-7-7"><a id="__codelineno-7-7" name="__codelineno-7-7" href="#__codelineno-7-7"></a>[2020-07-22 16:52:08.977832] File: disk_log.txt removed !!
</span><span id="__span-7-8"><a id="__codelineno-7-8" name="__codelineno-7-8" href="#__codelineno-7-8"></a>[2020-07-22 16:52:08.989102] File: mem_log.txt removed !!
</span><span id="__span-7-9"><a id="__codelineno-7-9" name="__codelineno-7-9" href="#__codelineno-7-9"></a>[2020-07-22 16:52:09.414572] File: aci-n9000-dk9.13.2.1m.bin removed !!
</span></code></pre></div>
</div>
<h3 id="apic-ssd-health">APIC SSD Health</h3>
<p>Starting from Cisco APIC release 2.3(1), faults occur when the SSD media wearout indicator (life remaining) is less than a certain percentage on Cisco APIC nodes. An SSD with little lifetime may cause any operations that require updates for the internal database, such as upgrade or downgrade operations, to fail. The Cisco APIC will raise three different faults, depending on the amount of SSD life remaining. If the most critical fault (F2732) is raised on the system, you must replace the SSD by contacting Cisco TAC prior to performing the upgrade.</p>
<ul>
<li>
<p><strong>F2730</strong>: A warning level fault for Cisco APIC SSD life remaining. This is raised when the life remaining is less than 10%.</p>
</li>
<li>
<p><strong>F2731</strong>: A major level fault for Cisco APIC SSD life remaining. This is raised when the life remaining is less than 5%.</p>
</li>
<li>
<p><strong>F2732</strong>: A critical level fault for Cisco APIC SSD life remaining. This is raised when the life remaining is less than 1%.</p>
</li>
</ul>
<p>Also, in very rare occasions, the SSD might have other operational issues than its lifetime. In such a case, look for the fault F0101.</p>
<p>However, if your Cisco APICs are still running on a release older than the 4.2(7f) or 5.2(1g), these fault may not report a correct value due to CSCvx28453. In such a case, look for <code>SSD Wearout Indicator is XX</code> in <code>/var/log/dme/log/svc_ifc_ae.bin.log</code> on your APICs, where XX is a number.</p>
<p>See the <a href="https://www.cisco.com/c/en/us/support/docs/cloud-systems-management/application-policy-infrastructure-controller-apic/215166-apic-ssd-replacement.html">APIC SSD Replacement technote</a> for more details.</p>
<div class="admonition example">
<p class="admonition-title">Fault Example (F2731: Major Fault for APIC SSD life remaining)</p>
<p>The following shows an example of APIC 3 (node 3) with an SSD life remaining of 1% (the major fault F2731). In this case, although the critical fault F2732 for the life remaining less than 1% is not raised, it is close enough to F2732s threshold and it is recommended to replace the SSD.
<div class="language-text highlight"><pre><span></span><code><span id="__span-8-1"><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a>APIC1# moquery -c faultInfo -f &#39;fault.Inst.code==&quot;F2731&quot;&#39;
</span><span id="__span-8-2"><a id="__codelineno-8-2" name="__codelineno-8-2" href="#__codelineno-8-2"></a>Total Objects shown: 1
</span><span id="__span-8-3"><a id="__codelineno-8-3" name="__codelineno-8-3" href="#__codelineno-8-3"></a>
</span><span id="__span-8-4"><a id="__codelineno-8-4" name="__codelineno-8-4" href="#__codelineno-8-4"></a># fault.Inst
</span><span id="__span-8-5"><a id="__codelineno-8-5" name="__codelineno-8-5" href="#__codelineno-8-5"></a>code             : F2731
</span><span id="__span-8-6"><a id="__codelineno-8-6" name="__codelineno-8-6" href="#__codelineno-8-6"></a>ack              : no
</span><span id="__span-8-7"><a id="__codelineno-8-7" name="__codelineno-8-7" href="#__codelineno-8-7"></a>annotation       :
</span><span id="__span-8-8"><a id="__codelineno-8-8" name="__codelineno-8-8" href="#__codelineno-8-8"></a>cause            : equipment-wearout
</span><span id="__span-8-9"><a id="__codelineno-8-9" name="__codelineno-8-9" href="#__codelineno-8-9"></a>changeSet        : mediaWearout (Old: 2, New: 1)
</span><span id="__span-8-10"><a id="__codelineno-8-10" name="__codelineno-8-10" href="#__codelineno-8-10"></a>childAction      :
</span><span id="__span-8-11"><a id="__codelineno-8-11" name="__codelineno-8-11" href="#__codelineno-8-11"></a>created          : 2019-10-22T11:47:40.791+01:00
</span><span id="__span-8-12"><a id="__codelineno-8-12" name="__codelineno-8-12" href="#__codelineno-8-12"></a>delegated        : no
</span><span id="__span-8-13"><a id="__codelineno-8-13" name="__codelineno-8-13" href="#__codelineno-8-13"></a>descr            : Storage unit /dev/sdb on Node 3 mounted at /dev/sdb has 1% life remaining
</span><span id="__span-8-14"><a id="__codelineno-8-14" name="__codelineno-8-14" href="#__codelineno-8-14"></a>dn               : topology/pod-2/node-3/sys/ch/p-[/dev/sdb]-f-[/dev/sdb]/fault-F2731
</span><span id="__span-8-15"><a id="__codelineno-8-15" name="__codelineno-8-15" href="#__codelineno-8-15"></a>domain           : infra
</span><span id="__span-8-16"><a id="__codelineno-8-16" name="__codelineno-8-16" href="#__codelineno-8-16"></a>extMngdBy        : undefined
</span><span id="__span-8-17"><a id="__codelineno-8-17" name="__codelineno-8-17" href="#__codelineno-8-17"></a>highestSeverity  : major
</span><span id="__span-8-18"><a id="__codelineno-8-18" name="__codelineno-8-18" href="#__codelineno-8-18"></a>lastTransition   : 2019-10-22T11:49:48.788+01:00
</span><span id="__span-8-19"><a id="__codelineno-8-19" name="__codelineno-8-19" href="#__codelineno-8-19"></a>lc               : raised
</span><span id="__span-8-20"><a id="__codelineno-8-20" name="__codelineno-8-20" href="#__codelineno-8-20"></a>modTs            : never
</span><span id="__span-8-21"><a id="__codelineno-8-21" name="__codelineno-8-21" href="#__codelineno-8-21"></a>occur            : 1
</span><span id="__span-8-22"><a id="__codelineno-8-22" name="__codelineno-8-22" href="#__codelineno-8-22"></a>origSeverity     : major
</span><span id="__span-8-23"><a id="__codelineno-8-23" name="__codelineno-8-23" href="#__codelineno-8-23"></a>prevSeverity     : major
</span><span id="__span-8-24"><a id="__codelineno-8-24" name="__codelineno-8-24" href="#__codelineno-8-24"></a>rn               : fault-F2731
</span><span id="__span-8-25"><a id="__codelineno-8-25" name="__codelineno-8-25" href="#__codelineno-8-25"></a>rule             : eqpt-storage-wearout-major
</span><span id="__span-8-26"><a id="__codelineno-8-26" name="__codelineno-8-26" href="#__codelineno-8-26"></a>severity         : major
</span><span id="__span-8-27"><a id="__codelineno-8-27" name="__codelineno-8-27" href="#__codelineno-8-27"></a>status           :
</span><span id="__span-8-28"><a id="__codelineno-8-28" name="__codelineno-8-28" href="#__codelineno-8-28"></a>subject          : equipment-wearout
</span><span id="__span-8-29"><a id="__codelineno-8-29" name="__codelineno-8-29" href="#__codelineno-8-29"></a>type             : operational
</span><span id="__span-8-30"><a id="__codelineno-8-30" name="__codelineno-8-30" href="#__codelineno-8-30"></a>uid              :
</span></code></pre></div></p>
</div>
<h3 id="switch-ssd-health">Switch SSD Health</h3>
<p>Starting from release 2.1(4), 2.2(4), 2.3(1o), and 3.1(2m), faults occur if the flash SSD lifetime usage has reached a certain endurance limit on the leaf or spine switches. A flash SSD with little lifetime may cause any operations that require updates for the internal database, such as Cisco APIC communication, to fail, or the switch may fail to boot up. The ACI switch will raise two different faults depending on the amount of SSD life its consumed. If the most critical fault (F3073) is raised on the system, you must replace the SSD by contacting Cisco TAC prior to performing the upgrade.</p>
<ul>
<li>
<p><strong>F3074</strong>: A warning level fault for switch SSD lifetime. This is raised when the lifetime reached 80% of its limit.</p>
</li>
<li>
<p><strong>F3073</strong>: A major level fault for switch SSD lifetime. This is raised when the lifetime reached 90% of its limit.</p>
</li>
</ul>
<p>You can run the moquery below on the CLI of any Cisco APIC to check if these faults exist on the system. The faults are visible within the GUI as well.</p>
<p>If your Cisco APICs are still running an older release, contact Cisco TAC to check the SSD life status.</p>
<p>See the <a href="https://www.cisco.com/c/en/us/support/docs/software/aci-data-center/215167-aci-switch-node-ssd-lifetime-explained.html">ACI Switch Node SSD Lifetime Explained technote</a> for more details.</p>
<div class="admonition example">
<p class="admonition-title">Fault Example (F3074: Warning Fault for switch SSD lifetime)</p>
<p>The following shows an example of node 101 that has reached 85% of its SSD lifetime.
<div class="language-text highlight"><pre><span></span><code><span id="__span-9-1"><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a>APIC1# moquery -c faultInst -f &#39;fault.Inst.code==&quot;F3074&quot;&#39;
</span><span id="__span-9-2"><a id="__codelineno-9-2" name="__codelineno-9-2" href="#__codelineno-9-2"></a>
</span><span id="__span-9-3"><a id="__codelineno-9-3" name="__codelineno-9-3" href="#__codelineno-9-3"></a>Total Objects shown: 4
</span><span id="__span-9-4"><a id="__codelineno-9-4" name="__codelineno-9-4" href="#__codelineno-9-4"></a>
</span><span id="__span-9-5"><a id="__codelineno-9-5" name="__codelineno-9-5" href="#__codelineno-9-5"></a># fault.Inst
</span><span id="__span-9-6"><a id="__codelineno-9-6" name="__codelineno-9-6" href="#__codelineno-9-6"></a>code             : F3074
</span><span id="__span-9-7"><a id="__codelineno-9-7" name="__codelineno-9-7" href="#__codelineno-9-7"></a>ack              : no
</span><span id="__span-9-8"><a id="__codelineno-9-8" name="__codelineno-9-8" href="#__codelineno-9-8"></a>annotation       : 
</span><span id="__span-9-9"><a id="__codelineno-9-9" name="__codelineno-9-9" href="#__codelineno-9-9"></a>cause            : equipment-flash-warning
</span><span id="__span-9-10"><a id="__codelineno-9-10" name="__codelineno-9-10" href="#__codelineno-9-10"></a>changeSet        : acc:read-write, cap:61057, deltape:23, descr:flash, gbb:0, id:1, lba:0, lifetime:85, majorAlarm:no, mfgTm:2020-09-22T02:21:45.675+00:00, minorAlarm:yes, model:Micron_M600_MTFDDAT064MBF, operSt:ok, peCycles:4290, readErr:0, rev:MC04, ser:MSA20400892, tbw:21.279228, type:flash, vendor:Micron, warning:yes, wlc:0
</span><span id="__span-9-11"><a id="__codelineno-9-11" name="__codelineno-9-11" href="#__codelineno-9-11"></a>childAction      : 
</span><span id="__span-9-12"><a id="__codelineno-9-12" name="__codelineno-9-12" href="#__codelineno-9-12"></a>created          : 2020-09-21T21:21:45.721-05:00
</span><span id="__span-9-13"><a id="__codelineno-9-13" name="__codelineno-9-13" href="#__codelineno-9-13"></a>delegated        : no
</span><span id="__span-9-14"><a id="__codelineno-9-14" name="__codelineno-9-14" href="#__codelineno-9-14"></a>descr            : SSD has reached 80% lifetime and is nearing its endurance limit. Please plan for Switch/Supervisor replacement soon
</span><span id="__span-9-15"><a id="__codelineno-9-15" name="__codelineno-9-15" href="#__codelineno-9-15"></a>dn               : topology/pod-1/node-101/sys/ch/supslot-1/sup/flash/fault-F3074
</span><span id="__span-9-16"><a id="__codelineno-9-16" name="__codelineno-9-16" href="#__codelineno-9-16"></a>domain           : infra
</span><span id="__span-9-17"><a id="__codelineno-9-17" name="__codelineno-9-17" href="#__codelineno-9-17"></a>extMngdBy        : undefined
</span><span id="__span-9-18"><a id="__codelineno-9-18" name="__codelineno-9-18" href="#__codelineno-9-18"></a>highestSeverity  : minor
</span><span id="__span-9-19"><a id="__codelineno-9-19" name="__codelineno-9-19" href="#__codelineno-9-19"></a>lastTransition   : 2020-09-21T21:24:03.132-05:00
</span><span id="__span-9-20"><a id="__codelineno-9-20" name="__codelineno-9-20" href="#__codelineno-9-20"></a>lc               : raised
</span><span id="__span-9-21"><a id="__codelineno-9-21" name="__codelineno-9-21" href="#__codelineno-9-21"></a>modTs            : never
</span><span id="__span-9-22"><a id="__codelineno-9-22" name="__codelineno-9-22" href="#__codelineno-9-22"></a>occur            : 1
</span><span id="__span-9-23"><a id="__codelineno-9-23" name="__codelineno-9-23" href="#__codelineno-9-23"></a>origSeverity     : minor
</span><span id="__span-9-24"><a id="__codelineno-9-24" name="__codelineno-9-24" href="#__codelineno-9-24"></a>prevSeverity     : minor
</span><span id="__span-9-25"><a id="__codelineno-9-25" name="__codelineno-9-25" href="#__codelineno-9-25"></a>rn               : fault-F3074
</span><span id="__span-9-26"><a id="__codelineno-9-26" name="__codelineno-9-26" href="#__codelineno-9-26"></a>rule             : eqpt-flash-flash-minor-alarm
</span><span id="__span-9-27"><a id="__codelineno-9-27" name="__codelineno-9-27" href="#__codelineno-9-27"></a>severity         : minor
</span><span id="__span-9-28"><a id="__codelineno-9-28" name="__codelineno-9-28" href="#__codelineno-9-28"></a>status           : 
</span><span id="__span-9-29"><a id="__codelineno-9-29" name="__codelineno-9-29" href="#__codelineno-9-29"></a>subject          : flash-minor-alarm
</span><span id="__span-9-30"><a id="__codelineno-9-30" name="__codelineno-9-30" href="#__codelineno-9-30"></a>type             : operational
</span><span id="__span-9-31"><a id="__codelineno-9-31" name="__codelineno-9-31" href="#__codelineno-9-31"></a>--- omit ---
</span></code></pre></div></p>
</div>
<h3 id="config-on-apic-connected-port">Config On APIC Connected Port</h3>
<p>In a healthy ACI deployment, there should be no EPG or policy deployment pushed to any interfaces where a Cisco APIC is connected. When a Cisco APIC is connected to a leaf switch, LLDP validation occurs between the Cisco APIC and the leaf switch to allow it into the fabric without any configuration by the user. When a policy is pushed to a leaf switch interface that is connected to a Cisco APIC, that configuration will be denied and a fault will be raised. However, if the link to the Cisco APIC flaps for any reason, primarily during an upgrade when the Cisco APIC reboots, the policy can then be deployed to that leaf switch interface. This results in the Cisco APIC being blocked from re-joining the fabric after it has reloaded.</p>
<p>It is critical that you resolve these issues before the upgrade to prevent any issues. You can run the moquery below on the CLI of any Cisco APIC to check if these faults exist on the system. The faults are visible within the GUI as well.</p>
<div class="admonition example">
<p class="admonition-title">Fault Example (F0467: port-configured-for-apic)</p>
<p>The following fault shows an example of node 101 eth1/1 that is connected to a Cisco APIC that has some EPG configurations on it.
<div class="language-text highlight"><pre><span></span><code><span id="__span-10-1"><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a>admin@apic1:~&gt; moquery -c faultInst -x &#39;query-target-filter=wcard(faultInst.descr,&quot;port-configured-for-apic&quot;)&#39;
</span><span id="__span-10-2"><a id="__codelineno-10-2" name="__codelineno-10-2" href="#__codelineno-10-2"></a>Total Objects shown: 1
</span><span id="__span-10-3"><a id="__codelineno-10-3" name="__codelineno-10-3" href="#__codelineno-10-3"></a>
</span><span id="__span-10-4"><a id="__codelineno-10-4" name="__codelineno-10-4" href="#__codelineno-10-4"></a># fault.Inst
</span><span id="__span-10-5"><a id="__codelineno-10-5" name="__codelineno-10-5" href="#__codelineno-10-5"></a>code             : F0467
</span><span id="__span-10-6"><a id="__codelineno-10-6" name="__codelineno-10-6" href="#__codelineno-10-6"></a>ack              : no
</span><span id="__span-10-7"><a id="__codelineno-10-7" name="__codelineno-10-7" href="#__codelineno-10-7"></a>annotation       : 
</span><span id="__span-10-8"><a id="__codelineno-10-8" name="__codelineno-10-8" href="#__codelineno-10-8"></a>cause            : configuration-failed
</span><span id="__span-10-9"><a id="__codelineno-10-9" name="__codelineno-10-9" href="#__codelineno-10-9"></a>changeSet        : configQual:port-configured-for-apic, configSt:failed-to-apply, debugMessage:port-configured-for-apic: Port is connected to the APIC;, temporaryError:no
</span><span id="__span-10-10"><a id="__codelineno-10-10" name="__codelineno-10-10" href="#__codelineno-10-10"></a>childAction      :
</span><span id="__span-10-11"><a id="__codelineno-10-11" name="__codelineno-10-11" href="#__codelineno-10-11"></a>created          : 2021-06-03T07:51:42.263-04:00
</span><span id="__span-10-12"><a id="__codelineno-10-12" name="__codelineno-10-12" href="#__codelineno-10-12"></a>delegated        : yes
</span><span id="__span-10-13"><a id="__codelineno-10-13" name="__codelineno-10-13" href="#__codelineno-10-13"></a>descr            : Configuration failed for uni/tn-jr/ap-ap1/epg-epg1 node 101 eth1/1 due to Port Connected to Controller, debug message: port-configured-for-apic: Port is connected to the APIC;
</span><span id="__span-10-14"><a id="__codelineno-10-14" name="__codelineno-10-14" href="#__codelineno-10-14"></a>dn               : topology/pod-1/node-101/local/svc-policyelem-id-0/uni/epp/fv-[uni/tn-jr/ap-ap1/epg-epg1]/node-101/stpathatt-[eth1/1]/nwissues/fault-F0467
</span><span id="__span-10-15"><a id="__codelineno-10-15" name="__codelineno-10-15" href="#__codelineno-10-15"></a>domain           : tenant
</span><span id="__span-10-16"><a id="__codelineno-10-16" name="__codelineno-10-16" href="#__codelineno-10-16"></a>extMngdBy        : undefined
</span><span id="__span-10-17"><a id="__codelineno-10-17" name="__codelineno-10-17" href="#__codelineno-10-17"></a>highestSeverity  : minor
</span><span id="__span-10-18"><a id="__codelineno-10-18" name="__codelineno-10-18" href="#__codelineno-10-18"></a>lastTransition   : 2021-06-03T07:53:52.021-04:00
</span><span id="__span-10-19"><a id="__codelineno-10-19" name="__codelineno-10-19" href="#__codelineno-10-19"></a>lc               : raised
</span><span id="__span-10-20"><a id="__codelineno-10-20" name="__codelineno-10-20" href="#__codelineno-10-20"></a>modTs            : never
</span><span id="__span-10-21"><a id="__codelineno-10-21" name="__codelineno-10-21" href="#__codelineno-10-21"></a>occur            : 1
</span><span id="__span-10-22"><a id="__codelineno-10-22" name="__codelineno-10-22" href="#__codelineno-10-22"></a>origSeverity     : minor
</span><span id="__span-10-23"><a id="__codelineno-10-23" name="__codelineno-10-23" href="#__codelineno-10-23"></a>prevSeverity     : minor
</span><span id="__span-10-24"><a id="__codelineno-10-24" name="__codelineno-10-24" href="#__codelineno-10-24"></a>rn               : fault-F0467
</span><span id="__span-10-25"><a id="__codelineno-10-25" name="__codelineno-10-25" href="#__codelineno-10-25"></a>rule             : fv-nw-issues-config-failed
</span><span id="__span-10-26"><a id="__codelineno-10-26" name="__codelineno-10-26" href="#__codelineno-10-26"></a>severity         : minor
</span><span id="__span-10-27"><a id="__codelineno-10-27" name="__codelineno-10-27" href="#__codelineno-10-27"></a>status           :
</span><span id="__span-10-28"><a id="__codelineno-10-28" name="__codelineno-10-28" href="#__codelineno-10-28"></a>subject          : management
</span><span id="__span-10-29"><a id="__codelineno-10-29" name="__codelineno-10-29" href="#__codelineno-10-29"></a>type             : config
</span><span id="__span-10-30"><a id="__codelineno-10-30" name="__codelineno-10-30" href="#__codelineno-10-30"></a>uid              :
</span></code></pre></div></p>
</div>
<h3 id="l2l3-port-config">L2/L3 Port Config</h3>
<p>This is another type of the F0467 fault code family that you should check before an upgrade. This fault alerts that an interface configured under a Layer3 Out (L3Out) has failed because the port that the policy is deployed for is operating in the opposite mode. For example, you might have configured a routed sub-interface under an L3Out, making the port an L3 port. However, there is already L2 policy on that port. A port in ACI can either be L2 or L3, but not both, just like a port on any layer 3 switches that can be either <strong>switchport</strong> (L2) or <strong>no switchport</strong> (L3), so this policy fails in this situation. The same rule applies if a port is already an L3 port, but you deploy L2 config onto it. After an upgrade, its possible that the previously working configuration will break if this faulty policy is deployed first after the switch reloads.</p>
<p>It is critical that you resolve these issues before the upgrade to prevent any issues. The interface that the fault is raised on should either be corrected or deleted in order to clear the fault. You can run the moquery below on the CLI of any Cisco APIC to check if these faults exist on the system. The faults are visible within the GUI as well.</p>
<div class="admonition example">
<p class="admonition-title">Fault Example (F0467: port-configured-as-l2)</p>
<p>The following fault shows an example of the configuration from L3Out <code>OSPF</code> under tenant <code>jr</code> has failed on node 101 eth1/7 because the same port is already configured as L2 by other components, such as EPGs or other L3Outs using the same port as SVI. It implies that, in this case, L3Out OSPF is trying to use node 101 eth1/7 as a routed port or routed sub-interface (L3) as opposed to SVI (L2).
<div class="language-text highlight"><pre><span></span><code><span id="__span-11-1"><a id="__codelineno-11-1" name="__codelineno-11-1" href="#__codelineno-11-1"></a>admin@apic1:~&gt; moquery -c faultDelegate -x &#39;query-target-filter=wcard(faultInst.changeSet,&quot;port-configured-as-l2&quot;)&#39;
</span><span id="__span-11-2"><a id="__codelineno-11-2" name="__codelineno-11-2" href="#__codelineno-11-2"></a>Total Objects shown: 1
</span><span id="__span-11-3"><a id="__codelineno-11-3" name="__codelineno-11-3" href="#__codelineno-11-3"></a>
</span><span id="__span-11-4"><a id="__codelineno-11-4" name="__codelineno-11-4" href="#__codelineno-11-4"></a># fault.Delegate
</span><span id="__span-11-5"><a id="__codelineno-11-5" name="__codelineno-11-5" href="#__codelineno-11-5"></a>affected         : resPolCont/rtdOutCont/rtdOutDef-[uni/tn-jr/out-OSPF]/node-101/stpathatt-[eth1/7]/nwissues
</span><span id="__span-11-6"><a id="__codelineno-11-6" name="__codelineno-11-6" href="#__codelineno-11-6"></a>code             : F0467
</span><span id="__span-11-7"><a id="__codelineno-11-7" name="__codelineno-11-7" href="#__codelineno-11-7"></a>ack              : no
</span><span id="__span-11-8"><a id="__codelineno-11-8" name="__codelineno-11-8" href="#__codelineno-11-8"></a>cause            : configuration-failed
</span><span id="__span-11-9"><a id="__codelineno-11-9" name="__codelineno-11-9" href="#__codelineno-11-9"></a>changeSet        : configQual:port-configured-as-l2, configSt:failed-to-apply, temporaryError:no
</span><span id="__span-11-10"><a id="__codelineno-11-10" name="__codelineno-11-10" href="#__codelineno-11-10"></a>childAction      :
</span><span id="__span-11-11"><a id="__codelineno-11-11" name="__codelineno-11-11" href="#__codelineno-11-11"></a>created          : 2021-06-23T12:17:54.775-04:00
</span><span id="__span-11-12"><a id="__codelineno-11-12" name="__codelineno-11-12" href="#__codelineno-11-12"></a>descr            : Fault delegate: Configuration failed for uni/tn-jr/out-OSPF node 101 eth1/7 due to Interface Configured as L2, debug message:
</span><span id="__span-11-13"><a id="__codelineno-11-13" name="__codelineno-11-13" href="#__codelineno-11-13"></a>dn               : uni/tn-jr/out-OSPF/fd-[resPolCont/rtdOutCont/rtdOutDef-[uni/tn-jr/out-OSPF]/node-101/stpathatt-[eth1/7]/nwissues]-fault-F0467
</span><span id="__span-11-14"><a id="__codelineno-11-14" name="__codelineno-11-14" href="#__codelineno-11-14"></a>domain           : tenant
</span><span id="__span-11-15"><a id="__codelineno-11-15" name="__codelineno-11-15" href="#__codelineno-11-15"></a>highestSeverity  : minor
</span><span id="__span-11-16"><a id="__codelineno-11-16" name="__codelineno-11-16" href="#__codelineno-11-16"></a>lastTransition   :2021-06-23T12:20:09.780-04:00
</span><span id="__span-11-17"><a id="__codelineno-11-17" name="__codelineno-11-17" href="#__codelineno-11-17"></a>lc               : raised
</span><span id="__span-11-18"><a id="__codelineno-11-18" name="__codelineno-11-18" href="#__codelineno-11-18"></a>modTs            : never
</span><span id="__span-11-19"><a id="__codelineno-11-19" name="__codelineno-11-19" href="#__codelineno-11-19"></a>occur            : 1
</span><span id="__span-11-20"><a id="__codelineno-11-20" name="__codelineno-11-20" href="#__codelineno-11-20"></a>origSeverity     : minor
</span><span id="__span-11-21"><a id="__codelineno-11-21" name="__codelineno-11-21" href="#__codelineno-11-21"></a>prevSeverity     : minor
</span><span id="__span-11-22"><a id="__codelineno-11-22" name="__codelineno-11-22" href="#__codelineno-11-22"></a>rn               : fd-[resPolCont/rtdOutCont/rtdOutDef-[uni/tn-jr/out-OSPF]/node-101/stpathatt-[eth1/7]/nwissues]-fault-F0467
</span><span id="__span-11-23"><a id="__codelineno-11-23" name="__codelineno-11-23" href="#__codelineno-11-23"></a>rule             : fv-nw-issues-config-failed
</span><span id="__span-11-24"><a id="__codelineno-11-24" name="__codelineno-11-24" href="#__codelineno-11-24"></a>severity         : minor
</span><span id="__span-11-25"><a id="__codelineno-11-25" name="__codelineno-11-25" href="#__codelineno-11-25"></a>status           :
</span><span id="__span-11-26"><a id="__codelineno-11-26" name="__codelineno-11-26" href="#__codelineno-11-26"></a>subject          : management
</span><span id="__span-11-27"><a id="__codelineno-11-27" name="__codelineno-11-27" href="#__codelineno-11-27"></a>type             : config
</span></code></pre></div></p>
</div>
<div class="admonition example">
<p class="admonition-title">Fault Example (F0467: port-configured-as-l3)</p>
<p>The following fault shows an example of the opposite of above situation. In this example, L3Out IPV6 tries to use node 101 eth1/7 as an L2 port and it failed because other L3Outs are already using the same port as an L3 port.
<div class="language-text highlight"><pre><span></span><code><span id="__span-12-1"><a id="__codelineno-12-1" name="__codelineno-12-1" href="#__codelineno-12-1"></a>admin@apic1:~&gt; moquery -c faultDelegate -x &#39;query-target-filter=wcard(faultInst.changeSet,&quot;port-configured-as-l3&quot;)&#39;
</span><span id="__span-12-2"><a id="__codelineno-12-2" name="__codelineno-12-2" href="#__codelineno-12-2"></a>Total Objects shown: 1
</span><span id="__span-12-3"><a id="__codelineno-12-3" name="__codelineno-12-3" href="#__codelineno-12-3"></a>
</span><span id="__span-12-4"><a id="__codelineno-12-4" name="__codelineno-12-4" href="#__codelineno-12-4"></a># fault.Delegate
</span><span id="__span-12-5"><a id="__codelineno-12-5" name="__codelineno-12-5" href="#__codelineno-12-5"></a>affected         : resPolCont/rtdOutCont/rtdOutDef-[uni/tn-jr/out-IPV6]/node-101/stpathatt-[eth1/7]/nwissues
</span><span id="__span-12-6"><a id="__codelineno-12-6" name="__codelineno-12-6" href="#__codelineno-12-6"></a>code             : F0467
</span><span id="__span-12-7"><a id="__codelineno-12-7" name="__codelineno-12-7" href="#__codelineno-12-7"></a>ack              : no
</span><span id="__span-12-8"><a id="__codelineno-12-8" name="__codelineno-12-8" href="#__codelineno-12-8"></a>cause            : configuration-failed
</span><span id="__span-12-9"><a id="__codelineno-12-9" name="__codelineno-12-9" href="#__codelineno-12-9"></a>changeSet        : configQual:port-configured-as-l3, configSt:failed-to-apply, debugMessage:port-configured-as-l3: Port has one or more layer3 sub-interfaces;, temporaryError:no
</span><span id="__span-12-10"><a id="__codelineno-12-10" name="__codelineno-12-10" href="#__codelineno-12-10"></a>childAction      :
</span><span id="__span-12-11"><a id="__codelineno-12-11" name="__codelineno-12-11" href="#__codelineno-12-11"></a>created          : 2021-06-23T12:31:41.949-04:00
</span><span id="__span-12-12"><a id="__codelineno-12-12" name="__codelineno-12-12" href="#__codelineno-12-12"></a>descr            : Fault delegate: Configuration failed for uni/tn-jr/out-IPV6 node 101 eth1/7 due to Interface Configured as L3, debug message: port-configured-as-l3: Port has one or more layer3 sub-interfaces;
</span><span id="__span-12-13"><a id="__codelineno-12-13" name="__codelineno-12-13" href="#__codelineno-12-13"></a>dn               : uni/tn-jr/out-IPV6/fd-[resPolCont/rtdOutCont/rtdOutDef-[uni/tn-jr/out-IPV6]/node-101/stpathatt-[eth1/7]/nwissues]-fault-F0467
</span><span id="__span-12-14"><a id="__codelineno-12-14" name="__codelineno-12-14" href="#__codelineno-12-14"></a>domain           : tenant
</span><span id="__span-12-15"><a id="__codelineno-12-15" name="__codelineno-12-15" href="#__codelineno-12-15"></a>highestSeverity  : minor
</span><span id="__span-12-16"><a id="__codelineno-12-16" name="__codelineno-12-16" href="#__codelineno-12-16"></a>lastTransition   : 2021-06-23T12:31:41.949-04:00
</span><span id="__span-12-17"><a id="__codelineno-12-17" name="__codelineno-12-17" href="#__codelineno-12-17"></a>lc               : soaking
</span><span id="__span-12-18"><a id="__codelineno-12-18" name="__codelineno-12-18" href="#__codelineno-12-18"></a>modTs            : never
</span><span id="__span-12-19"><a id="__codelineno-12-19" name="__codelineno-12-19" href="#__codelineno-12-19"></a>occur            : 1
</span><span id="__span-12-20"><a id="__codelineno-12-20" name="__codelineno-12-20" href="#__codelineno-12-20"></a>origSeverity     : minor
</span><span id="__span-12-21"><a id="__codelineno-12-21" name="__codelineno-12-21" href="#__codelineno-12-21"></a>prevSeverity     : minor
</span><span id="__span-12-22"><a id="__codelineno-12-22" name="__codelineno-12-22" href="#__codelineno-12-22"></a>rn               : fd-[resPolCont/rtdOutCont/rtdOutDef-[uni/tn-jr/out-IPV6]/node-101/stpathatt-[eth1/7]/nwissues]-fault-F0467
</span><span id="__span-12-23"><a id="__codelineno-12-23" name="__codelineno-12-23" href="#__codelineno-12-23"></a>rule             : fv-nw-issues-config-failed
</span><span id="__span-12-24"><a id="__codelineno-12-24" name="__codelineno-12-24" href="#__codelineno-12-24"></a>severity         : minor
</span><span id="__span-12-25"><a id="__codelineno-12-25" name="__codelineno-12-25" href="#__codelineno-12-25"></a>status           :
</span><span id="__span-12-26"><a id="__codelineno-12-26" name="__codelineno-12-26" href="#__codelineno-12-26"></a>subject          : management
</span><span id="__span-12-27"><a id="__codelineno-12-27" name="__codelineno-12-27" href="#__codelineno-12-27"></a>type             : config
</span></code></pre></div></p>
</div>
<h3 id="access-untagged-port-config">Access (Untagged) Port Config</h3>
<p>The APIC GUI or REST previously accepted two different access encapsulations on the same port, despite raising a fault with code F0467 and "native-or-untagged-encap-failure" in the changeSet. This configuration, likely resulting from user error, presents a significant risk of outage during switch upgrades or stateless reloads.</p>
<p>The script verifies these faults to ensure that a port is not configured as part of two access VLANs. You need to resolve the conflict causing this fault before any upgrades to prevent potential outages. Failure to do so may result in the deployment of a new VLAN/EPG on the port after the upgrade, leading to downtime in the environment.</p>
<div class="admonition example">
<p class="admonition-title">Fault Example (F0467: native-or-untagged-encap-failure)</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-13-1"><a id="__codelineno-13-1" name="__codelineno-13-1" href="#__codelineno-13-1"></a>apic1# moquery -c faultInst  -x &#39;query-target-filter=wcard(faultInst.changeSet,&quot;native-or-untagged-encap-failure&quot;)&#39;
</span><span id="__span-13-2"><a id="__codelineno-13-2" name="__codelineno-13-2" href="#__codelineno-13-2"></a>Total Objects shown: 1
</span><span id="__span-13-3"><a id="__codelineno-13-3" name="__codelineno-13-3" href="#__codelineno-13-3"></a>
</span><span id="__span-13-4"><a id="__codelineno-13-4" name="__codelineno-13-4" href="#__codelineno-13-4"></a># fault.Inst
</span><span id="__span-13-5"><a id="__codelineno-13-5" name="__codelineno-13-5" href="#__codelineno-13-5"></a>code             : F0467
</span><span id="__span-13-6"><a id="__codelineno-13-6" name="__codelineno-13-6" href="#__codelineno-13-6"></a>ack              : no
</span><span id="__span-13-7"><a id="__codelineno-13-7" name="__codelineno-13-7" href="#__codelineno-13-7"></a>alert            : no
</span><span id="__span-13-8"><a id="__codelineno-13-8" name="__codelineno-13-8" href="#__codelineno-13-8"></a>annotation       : 
</span><span id="__span-13-9"><a id="__codelineno-13-9" name="__codelineno-13-9" href="#__codelineno-13-9"></a>cause            : configuration-failed
</span><span id="__span-13-10"><a id="__codelineno-13-10" name="__codelineno-13-10" href="#__codelineno-13-10"></a>changeSet        : configQual:native-or-untagged-encap-failure, configSt:failed-to-apply, temporaryError:no
</span><span id="__span-13-11"><a id="__codelineno-13-11" name="__codelineno-13-11" href="#__codelineno-13-11"></a>childAction      : 
</span><span id="__span-13-12"><a id="__codelineno-13-12" name="__codelineno-13-12" href="#__codelineno-13-12"></a>created          : 2024-04-20T10:03:48.493+02:00
</span><span id="__span-13-13"><a id="__codelineno-13-13" name="__codelineno-13-13" href="#__codelineno-13-13"></a>delegated        : yes
</span><span id="__span-13-14"><a id="__codelineno-13-14" name="__codelineno-13-14" href="#__codelineno-13-14"></a>descr            : Configuration failed for uni/tn-EEA-1/ap-APP1/epg-EPG-2 node 101 eth1/28 due to Only One Native or Untagged Encap Allowed on Interface, debug message: 
</span><span id="__span-13-15"><a id="__codelineno-13-15" name="__codelineno-13-15" href="#__codelineno-13-15"></a>dn               : topology/pod-1/node-101/local/svc-policyelem-id-0/uni/epp/fv-[uni/tn-EEA-1/ap-APP1/epg-EPG-2]/node-101/stpathatt-[eth1/28]/nwissues/fault-F0467
</span><span id="__span-13-16"><a id="__codelineno-13-16" name="__codelineno-13-16" href="#__codelineno-13-16"></a>domain           : tenant
</span><span id="__span-13-17"><a id="__codelineno-13-17" name="__codelineno-13-17" href="#__codelineno-13-17"></a>extMngdBy        : undefined
</span><span id="__span-13-18"><a id="__codelineno-13-18" name="__codelineno-13-18" href="#__codelineno-13-18"></a>highestSeverity  : minor
</span><span id="__span-13-19"><a id="__codelineno-13-19" name="__codelineno-13-19" href="#__codelineno-13-19"></a>lastTransition   : 2024-04-20T10:03:53.045+02:00
</span><span id="__span-13-20"><a id="__codelineno-13-20" name="__codelineno-13-20" href="#__codelineno-13-20"></a>lc               : raised
</span><span id="__span-13-21"><a id="__codelineno-13-21" name="__codelineno-13-21" href="#__codelineno-13-21"></a>modTs            : never
</span><span id="__span-13-22"><a id="__codelineno-13-22" name="__codelineno-13-22" href="#__codelineno-13-22"></a>occur            : 1
</span><span id="__span-13-23"><a id="__codelineno-13-23" name="__codelineno-13-23" href="#__codelineno-13-23"></a>origSeverity     : minor
</span><span id="__span-13-24"><a id="__codelineno-13-24" name="__codelineno-13-24" href="#__codelineno-13-24"></a>prevSeverity     : minor
</span><span id="__span-13-25"><a id="__codelineno-13-25" name="__codelineno-13-25" href="#__codelineno-13-25"></a>rn               : fault-F0467
</span><span id="__span-13-26"><a id="__codelineno-13-26" name="__codelineno-13-26" href="#__codelineno-13-26"></a>rule             : fv-nw-issues-config-failed
</span><span id="__span-13-27"><a id="__codelineno-13-27" name="__codelineno-13-27" href="#__codelineno-13-27"></a>severity         : minor
</span><span id="__span-13-28"><a id="__codelineno-13-28" name="__codelineno-13-28" href="#__codelineno-13-28"></a>status           : 
</span><span id="__span-13-29"><a id="__codelineno-13-29" name="__codelineno-13-29" href="#__codelineno-13-29"></a>subject          : management
</span><span id="__span-13-30"><a id="__codelineno-13-30" name="__codelineno-13-30" href="#__codelineno-13-30"></a>title            : 
</span><span id="__span-13-31"><a id="__codelineno-13-31" name="__codelineno-13-31" href="#__codelineno-13-31"></a>type             : config
</span><span id="__span-13-32"><a id="__codelineno-13-32" name="__codelineno-13-32" href="#__codelineno-13-32"></a>uid              : 
</span><span id="__span-13-33"><a id="__codelineno-13-33" name="__codelineno-13-33" href="#__codelineno-13-33"></a>userdom          : all
</span></code></pre></div>
</div>
<p>Please note that this behavior has recently changed. With the new behavior, rejected through policy distributor validation, two different access encapsulations are no longer allowed on the same port by the APIC. This change has been documented in CSCwj69435.</p>
<h3 id="encap-already-in-use">Encap Already in Use</h3>
<p>This is another type of the F0467 fault code family that you should check before an upgrade. This fault alerts that an interface configuration under an EPG or an SVI configuration for an L3Out has failed because the VLAN encapsulation for the interface is already used by another interface on the same switch for a different purpose. After an upgrade, its possible that the previous working configuration will break if this faulty policy is deployed first after the switch reloads.</p>
<p>It is critical that you resolve these issues before the upgrade to prevent any unexpected outages when the switch(es) upgrade. The VLAN encapsulation on the interface that the fault is raised on should either be corrected or deleted in order to clear the fault. You can run the moquery in the example below on the CLI of any Cisco APIC to check if these faults exist on the system. The faults are visible within the GUI as well.</p>
<div class="admonition example">
<p class="admonition-title">Fault Example (F0467: encap-already-in-use)</p>
<p>The following shows three examples.</p>
<p>The first fault is for the interface configuration under the EPG <code>EPG1-2</code> in application profile <code>AP1</code> in tenant <code>TK</code> on node <code>101</code> interface <code>eth1/4</code> with VLAN <code>2011</code>. The fault description indicates that VLAN <code>2011</code> is already used by EPG <code>EPG1-1</code> in application profile <code>AP1</code> in tenant <code>TK</code>.</p>
<p>The second fault is for the SVI configuration under L3Out <code>BGP</code> in tenant <code>TK</code> on <code>node-103</code> interface <code>eth1/11</code> with VLAN <code>2013</code>. The fault description indicates that VLAN <code>2013</code> is already used by <code>EPG1-3</code> in application profile <code>AP1</code> in tenant <code>TK</code>.</p>
<p>The third fault is for the interface configuration under the EPG <code>EPG3-1</code> in application profile <code>AP1</code> in tenant <code>TK</code> on node <code>103</code> interface <code>eth1/1</code> with VLAN <code>2051</code>. The fault description indicates that VLAN <code>2051</code> is already used by L3Out <code>BGP</code> in tenant <code>TK</code>.</p>
<p>Note that the fault description may not include <code>(vlan-2011)</code> in <code>Encap (vlan-2011)</code> on older versions.
<div class="language-text highlight"><pre><span></span><code><span id="__span-14-1"><a id="__codelineno-14-1" name="__codelineno-14-1" href="#__codelineno-14-1"></a>admin@apic1:~&gt; moquery -c faultInst -x &#39;query-target-filter=wcard(faultInst.descr,&quot;encap-already-in-use&quot;)&#39;
</span><span id="__span-14-2"><a id="__codelineno-14-2" name="__codelineno-14-2" href="#__codelineno-14-2"></a>Total Objects shown: 3
</span><span id="__span-14-3"><a id="__codelineno-14-3" name="__codelineno-14-3" href="#__codelineno-14-3"></a>
</span><span id="__span-14-4"><a id="__codelineno-14-4" name="__codelineno-14-4" href="#__codelineno-14-4"></a># fault.Inst
</span><span id="__span-14-5"><a id="__codelineno-14-5" name="__codelineno-14-5" href="#__codelineno-14-5"></a>code             : F0467
</span><span id="__span-14-6"><a id="__codelineno-14-6" name="__codelineno-14-6" href="#__codelineno-14-6"></a>ack              : no
</span><span id="__span-14-7"><a id="__codelineno-14-7" name="__codelineno-14-7" href="#__codelineno-14-7"></a>alert            : no
</span><span id="__span-14-8"><a id="__codelineno-14-8" name="__codelineno-14-8" href="#__codelineno-14-8"></a>annotation       :
</span><span id="__span-14-9"><a id="__codelineno-14-9" name="__codelineno-14-9" href="#__codelineno-14-9"></a>cause            : configuration-failed
</span><span id="__span-14-10"><a id="__codelineno-14-10" name="__codelineno-14-10" href="#__codelineno-14-10"></a>changeSet        : configQual:encap-already-in-use, configSt:failed-to-apply, debugMessage:encap-already-in-use: Encap (vlan-2011) is already in use by TK:AP1:EPG1-1;, temporaryError:no
</span><span id="__span-14-11"><a id="__codelineno-14-11" name="__codelineno-14-11" href="#__codelineno-14-11"></a>childAction      :
</span><span id="__span-14-12"><a id="__codelineno-14-12" name="__codelineno-14-12" href="#__codelineno-14-12"></a>created          : 2024-04-19T21:02:20.878-07:00
</span><span id="__span-14-13"><a id="__codelineno-14-13" name="__codelineno-14-13" href="#__codelineno-14-13"></a>delegated        : yes
</span><span id="__span-14-14"><a id="__codelineno-14-14" name="__codelineno-14-14" href="#__codelineno-14-14"></a>descr            : Configuration failed for uni/tn-TK/ap-AP1/epg-EPG1-2 node 101 eth1/4 due to Encap Already Used in Another EPG, debug message: encap-already-in-use: Encap (vlan-2011) is already in use by TK:AP1:EPG1-1;
</span><span id="__span-14-15"><a id="__codelineno-14-15" name="__codelineno-14-15" href="#__codelineno-14-15"></a>dn               : topology/pod-1/node-101/local/svc-policyelem-id-0/uni/epp/fv-[uni/tn-TK/ap-AP1/epg-EPG1-2]/node-101/stpathatt-[eth1/4]/nwissues/fault-F0467
</span><span id="__span-14-16"><a id="__codelineno-14-16" name="__codelineno-14-16" href="#__codelineno-14-16"></a>domain           : tenant
</span><span id="__span-14-17"><a id="__codelineno-14-17" name="__codelineno-14-17" href="#__codelineno-14-17"></a>extMngdBy        : undefined
</span><span id="__span-14-18"><a id="__codelineno-14-18" name="__codelineno-14-18" href="#__codelineno-14-18"></a>highestSeverity  : minor
</span><span id="__span-14-19"><a id="__codelineno-14-19" name="__codelineno-14-19" href="#__codelineno-14-19"></a>lastTransition   : 2024-04-19T21:04:25.300-07:00
</span><span id="__span-14-20"><a id="__codelineno-14-20" name="__codelineno-14-20" href="#__codelineno-14-20"></a>lc               : raised
</span><span id="__span-14-21"><a id="__codelineno-14-21" name="__codelineno-14-21" href="#__codelineno-14-21"></a>modTs            : never
</span><span id="__span-14-22"><a id="__codelineno-14-22" name="__codelineno-14-22" href="#__codelineno-14-22"></a>occur            : 1
</span><span id="__span-14-23"><a id="__codelineno-14-23" name="__codelineno-14-23" href="#__codelineno-14-23"></a>origSeverity     : minor
</span><span id="__span-14-24"><a id="__codelineno-14-24" name="__codelineno-14-24" href="#__codelineno-14-24"></a>prevSeverity     : minor
</span><span id="__span-14-25"><a id="__codelineno-14-25" name="__codelineno-14-25" href="#__codelineno-14-25"></a>rn               : fault-F0467
</span><span id="__span-14-26"><a id="__codelineno-14-26" name="__codelineno-14-26" href="#__codelineno-14-26"></a>rule             : fv-nw-issues-config-failed
</span><span id="__span-14-27"><a id="__codelineno-14-27" name="__codelineno-14-27" href="#__codelineno-14-27"></a>severity         : minor
</span><span id="__span-14-28"><a id="__codelineno-14-28" name="__codelineno-14-28" href="#__codelineno-14-28"></a>status           :
</span><span id="__span-14-29"><a id="__codelineno-14-29" name="__codelineno-14-29" href="#__codelineno-14-29"></a>subject          : management
</span><span id="__span-14-30"><a id="__codelineno-14-30" name="__codelineno-14-30" href="#__codelineno-14-30"></a>title            :
</span><span id="__span-14-31"><a id="__codelineno-14-31" name="__codelineno-14-31" href="#__codelineno-14-31"></a>type             : config
</span><span id="__span-14-32"><a id="__codelineno-14-32" name="__codelineno-14-32" href="#__codelineno-14-32"></a>uid              :
</span><span id="__span-14-33"><a id="__codelineno-14-33" name="__codelineno-14-33" href="#__codelineno-14-33"></a>userdom          : all
</span><span id="__span-14-34"><a id="__codelineno-14-34" name="__codelineno-14-34" href="#__codelineno-14-34"></a>
</span><span id="__span-14-35"><a id="__codelineno-14-35" name="__codelineno-14-35" href="#__codelineno-14-35"></a># fault.Inst
</span><span id="__span-14-36"><a id="__codelineno-14-36" name="__codelineno-14-36" href="#__codelineno-14-36"></a>code             : F0467
</span><span id="__span-14-37"><a id="__codelineno-14-37" name="__codelineno-14-37" href="#__codelineno-14-37"></a>ack              : no
</span><span id="__span-14-38"><a id="__codelineno-14-38" name="__codelineno-14-38" href="#__codelineno-14-38"></a>alert            : no
</span><span id="__span-14-39"><a id="__codelineno-14-39" name="__codelineno-14-39" href="#__codelineno-14-39"></a>annotation       :
</span><span id="__span-14-40"><a id="__codelineno-14-40" name="__codelineno-14-40" href="#__codelineno-14-40"></a>cause            : configuration-failed
</span><span id="__span-14-41"><a id="__codelineno-14-41" name="__codelineno-14-41" href="#__codelineno-14-41"></a>changeSet        : configQual:encap-already-in-use, configSt:failed-to-apply, debugMessage:encap-already-in-use: Encap (vlan-2013) is already in use by TK:AP1:EPG1-3;, temporaryError:no
</span><span id="__span-14-42"><a id="__codelineno-14-42" name="__codelineno-14-42" href="#__codelineno-14-42"></a>childAction      :
</span><span id="__span-14-43"><a id="__codelineno-14-43" name="__codelineno-14-43" href="#__codelineno-14-43"></a>created          : 2024-04-19T21:59:31.948-07:00
</span><span id="__span-14-44"><a id="__codelineno-14-44" name="__codelineno-14-44" href="#__codelineno-14-44"></a>delegated        : yes
</span><span id="__span-14-45"><a id="__codelineno-14-45" name="__codelineno-14-45" href="#__codelineno-14-45"></a>descr            : Configuration failed for uni/tn-TK/out-BGP node 103 eth1/11 due to Encap Already Used in Another EPG, debug message: encap-already-in-use: Encap (vlan-2013) is already in use by TK:AP1:EPG1-3;
</span><span id="__span-14-46"><a id="__codelineno-14-46" name="__codelineno-14-46" href="#__codelineno-14-46"></a>dn               : topology/pod-2/node-103/local/svc-policyelem-id-0/resPolCont/rtdOutCont/rtdOutDef-[uni/tn-TK/out-BGP]/node-103/stpathatt-[eth1/11]/nwissues/fault-F0467
</span><span id="__span-14-47"><a id="__codelineno-14-47" name="__codelineno-14-47" href="#__codelineno-14-47"></a>domain           : tenant
</span><span id="__span-14-48"><a id="__codelineno-14-48" name="__codelineno-14-48" href="#__codelineno-14-48"></a>extMngdBy        : undefined
</span><span id="__span-14-49"><a id="__codelineno-14-49" name="__codelineno-14-49" href="#__codelineno-14-49"></a>highestSeverity  : minor
</span><span id="__span-14-50"><a id="__codelineno-14-50" name="__codelineno-14-50" href="#__codelineno-14-50"></a>lastTransition   : 2024-04-19T21:59:31.948-07:00
</span><span id="__span-14-51"><a id="__codelineno-14-51" name="__codelineno-14-51" href="#__codelineno-14-51"></a>lc               : soaking
</span><span id="__span-14-52"><a id="__codelineno-14-52" name="__codelineno-14-52" href="#__codelineno-14-52"></a>modTs            : never
</span><span id="__span-14-53"><a id="__codelineno-14-53" name="__codelineno-14-53" href="#__codelineno-14-53"></a>occur            : 1
</span><span id="__span-14-54"><a id="__codelineno-14-54" name="__codelineno-14-54" href="#__codelineno-14-54"></a>origSeverity     : minor
</span><span id="__span-14-55"><a id="__codelineno-14-55" name="__codelineno-14-55" href="#__codelineno-14-55"></a>prevSeverity     : minor
</span><span id="__span-14-56"><a id="__codelineno-14-56" name="__codelineno-14-56" href="#__codelineno-14-56"></a>rn               : fault-F0467
</span><span id="__span-14-57"><a id="__codelineno-14-57" name="__codelineno-14-57" href="#__codelineno-14-57"></a>rule             : fv-nw-issues-config-failed
</span><span id="__span-14-58"><a id="__codelineno-14-58" name="__codelineno-14-58" href="#__codelineno-14-58"></a>severity         : minor
</span><span id="__span-14-59"><a id="__codelineno-14-59" name="__codelineno-14-59" href="#__codelineno-14-59"></a>status           :
</span><span id="__span-14-60"><a id="__codelineno-14-60" name="__codelineno-14-60" href="#__codelineno-14-60"></a>subject          : management
</span><span id="__span-14-61"><a id="__codelineno-14-61" name="__codelineno-14-61" href="#__codelineno-14-61"></a>title            :
</span><span id="__span-14-62"><a id="__codelineno-14-62" name="__codelineno-14-62" href="#__codelineno-14-62"></a>type             : config
</span><span id="__span-14-63"><a id="__codelineno-14-63" name="__codelineno-14-63" href="#__codelineno-14-63"></a>uid              :
</span><span id="__span-14-64"><a id="__codelineno-14-64" name="__codelineno-14-64" href="#__codelineno-14-64"></a>userdom          : all
</span><span id="__span-14-65"><a id="__codelineno-14-65" name="__codelineno-14-65" href="#__codelineno-14-65"></a>
</span><span id="__span-14-66"><a id="__codelineno-14-66" name="__codelineno-14-66" href="#__codelineno-14-66"></a># fault.Inst
</span><span id="__span-14-67"><a id="__codelineno-14-67" name="__codelineno-14-67" href="#__codelineno-14-67"></a>code             : F0467
</span><span id="__span-14-68"><a id="__codelineno-14-68" name="__codelineno-14-68" href="#__codelineno-14-68"></a>ack              : no
</span><span id="__span-14-69"><a id="__codelineno-14-69" name="__codelineno-14-69" href="#__codelineno-14-69"></a>alert            : no
</span><span id="__span-14-70"><a id="__codelineno-14-70" name="__codelineno-14-70" href="#__codelineno-14-70"></a>annotation       :
</span><span id="__span-14-71"><a id="__codelineno-14-71" name="__codelineno-14-71" href="#__codelineno-14-71"></a>cause            : configuration-failed
</span><span id="__span-14-72"><a id="__codelineno-14-72" name="__codelineno-14-72" href="#__codelineno-14-72"></a>changeSet        : configQual:encap-already-in-use, configSt:failed-to-apply, debugMessage:encap-already-in-use: Encap (vlan-2051) is already in use by TK:VRFA:l3out-BGP:vlan-2051;, temporaryError:no
</span><span id="__span-14-73"><a id="__codelineno-14-73" name="__codelineno-14-73" href="#__codelineno-14-73"></a>childAction      :
</span><span id="__span-14-74"><a id="__codelineno-14-74" name="__codelineno-14-74" href="#__codelineno-14-74"></a>created          : 2024-04-19T21:58:02.758-07:00
</span><span id="__span-14-75"><a id="__codelineno-14-75" name="__codelineno-14-75" href="#__codelineno-14-75"></a>delegated        : yes
</span><span id="__span-14-76"><a id="__codelineno-14-76" name="__codelineno-14-76" href="#__codelineno-14-76"></a>descr            : Configuration failed for uni/tn-TK/ap-AP1/epg-EPG3-1 node 103 eth1/1 due to Encap Already Used in Another EPG, debug message: encap-already-in-use: Encap (vlan-2051) is already in use by TK:VRFA:l3out-BGP:vlan-2051;
</span><span id="__span-14-77"><a id="__codelineno-14-77" name="__codelineno-14-77" href="#__codelineno-14-77"></a>dn               : topology/pod-2/node-103/local/svc-policyelem-id-0/uni/epp/fv-[uni/tn-TK/ap-AP1/epg-EPG3-1]/node-103/stpathatt-[eth1/1]/nwissues/fault-F0467
</span><span id="__span-14-78"><a id="__codelineno-14-78" name="__codelineno-14-78" href="#__codelineno-14-78"></a>domain           : tenant
</span><span id="__span-14-79"><a id="__codelineno-14-79" name="__codelineno-14-79" href="#__codelineno-14-79"></a>extMngdBy        : undefined
</span><span id="__span-14-80"><a id="__codelineno-14-80" name="__codelineno-14-80" href="#__codelineno-14-80"></a>highestSeverity  : minor
</span><span id="__span-14-81"><a id="__codelineno-14-81" name="__codelineno-14-81" href="#__codelineno-14-81"></a>lastTransition   : 2024-04-19T21:58:02.758-07:00
</span><span id="__span-14-82"><a id="__codelineno-14-82" name="__codelineno-14-82" href="#__codelineno-14-82"></a>lc               : soaking
</span><span id="__span-14-83"><a id="__codelineno-14-83" name="__codelineno-14-83" href="#__codelineno-14-83"></a>modTs            : never
</span><span id="__span-14-84"><a id="__codelineno-14-84" name="__codelineno-14-84" href="#__codelineno-14-84"></a>occur            : 1
</span><span id="__span-14-85"><a id="__codelineno-14-85" name="__codelineno-14-85" href="#__codelineno-14-85"></a>origSeverity     : minor
</span><span id="__span-14-86"><a id="__codelineno-14-86" name="__codelineno-14-86" href="#__codelineno-14-86"></a>prevSeverity     : minor
</span><span id="__span-14-87"><a id="__codelineno-14-87" name="__codelineno-14-87" href="#__codelineno-14-87"></a>rn               : fault-F0467
</span><span id="__span-14-88"><a id="__codelineno-14-88" name="__codelineno-14-88" href="#__codelineno-14-88"></a>rule             : fv-nw-issues-config-failed
</span><span id="__span-14-89"><a id="__codelineno-14-89" name="__codelineno-14-89" href="#__codelineno-14-89"></a>severity         : minor
</span><span id="__span-14-90"><a id="__codelineno-14-90" name="__codelineno-14-90" href="#__codelineno-14-90"></a>status           :
</span><span id="__span-14-91"><a id="__codelineno-14-91" name="__codelineno-14-91" href="#__codelineno-14-91"></a>subject          : management
</span><span id="__span-14-92"><a id="__codelineno-14-92" name="__codelineno-14-92" href="#__codelineno-14-92"></a>title            :
</span><span id="__span-14-93"><a id="__codelineno-14-93" name="__codelineno-14-93" href="#__codelineno-14-93"></a>type             : config
</span><span id="__span-14-94"><a id="__codelineno-14-94" name="__codelineno-14-94" href="#__codelineno-14-94"></a>uid              :
</span><span id="__span-14-95"><a id="__codelineno-14-95" name="__codelineno-14-95" href="#__codelineno-14-95"></a>userdom          : all
</span></code></pre></div></p>
</div>
<h3 id="l3out-subnets">L3Out Subnets</h3>
<p>There is another type of the F0467 fault code family that you should check before an upgrade. This fault alerts that an external EPG defined under a Layer3 Out (L3Out) has a subnet with the <strong>External Subnet for the External EPG</strong> scope configured that overlaps with another L3Out external EPG in the same VRF. After an upgrade, its possible that the previous working configuration will break if this faulty policy is deployed first after the switch reloads.</p>
<p>It is critical that you resolve these issues before the upgrade to prevent any unexpected outages when the switch(es) upgrade. The subnet that the fault is raised on should either be corrected or deleted in order to clear the fault. You can run the moquery below on the CLI of any Cisco APIC to check if these faults exist on the system. The faults are visible within the GUI as well.</p>
<div class="admonition example">
<p class="admonition-title">Fault Example (F0467: prefix-entry-already-in-use)</p>
<p>The following shows an example of L3Out <code>OSPF</code> with an external EPG called <code>all</code>. In this external EPG, an L3Out subnet 112.112.112.112/32 is configured with <strong>External Subnet for the External EPG</strong> in the attempt to classify the source or destination IP address of packets to this external EPG for contracts application. However, it failed because the same subnet is already in use by another external EPG in the same VRF.
<div class="language-text highlight"><pre><span></span><code><span id="__span-15-1"><a id="__codelineno-15-1" name="__codelineno-15-1" href="#__codelineno-15-1"></a>admin@apic1:~&gt; moquery -c faultInst -x&#39;query-target-filter=wcard(faultInst.descr,&quot;prefix-entry-already-in-use&quot;)&#39;
</span><span id="__span-15-2"><a id="__codelineno-15-2" name="__codelineno-15-2" href="#__codelineno-15-2"></a>Total Objects shown: 1
</span><span id="__span-15-3"><a id="__codelineno-15-3" name="__codelineno-15-3" href="#__codelineno-15-3"></a>
</span><span id="__span-15-4"><a id="__codelineno-15-4" name="__codelineno-15-4" href="#__codelineno-15-4"></a># fault.Inst
</span><span id="__span-15-5"><a id="__codelineno-15-5" name="__codelineno-15-5" href="#__codelineno-15-5"></a>code             : F0467
</span><span id="__span-15-6"><a id="__codelineno-15-6" name="__codelineno-15-6" href="#__codelineno-15-6"></a>ack              : no
</span><span id="__span-15-7"><a id="__codelineno-15-7" name="__codelineno-15-7" href="#__codelineno-15-7"></a>annotation       :
</span><span id="__span-15-8"><a id="__codelineno-15-8" name="__codelineno-15-8" href="#__codelineno-15-8"></a>cause            : configuration-failed
</span><span id="__span-15-9"><a id="__codelineno-15-9" name="__codelineno-15-9" href="#__codelineno-15-9"></a>changeSet        : configQual:prefix-entry-already-in-use, configSt:failed-to-apply, debugMessage:prefix-entry-already-in-use: Prefix entry sys/ctx-[vxlan-2621440]/pfx-[112.112.112.112/32] is in use;, temporaryError:no
</span><span id="__span-15-10"><a id="__codelineno-15-10" name="__codelineno-15-10" href="#__codelineno-15-10"></a>childAction      :
</span><span id="__span-15-11"><a id="__codelineno-15-11" name="__codelineno-15-11" href="#__codelineno-15-11"></a>created          : 2021-06-22T09:02:36.630-04:00
</span><span id="__span-15-12"><a id="__codelineno-15-12" name="__codelineno-15-12" href="#__codelineno-15-12"></a>delegated        : yes
</span><span id="__span-15-13"><a id="__codelineno-15-13" name="__codelineno-15-13" href="#__codelineno-15-13"></a>descr            : Configuration failed for uni/tn-jr/out-OSPF/instP-all due to Prefix Entry Already Used in Another EPG, debug message: prefix-entry-already-in-use: Prefix entry sys/ctx-[vxlan-2621440]/pfx-[112.112.112.112/32] is in use;
</span><span id="__span-15-14"><a id="__codelineno-15-14" name="__codelineno-15-14" href="#__codelineno-15-14"></a>dn               : topology/pod-1/node-101/local/svc-policyelem-id-0/uni/epp/rtd-[uni/tn-jr/out-OSPF/instP-all]/nwissues/fault-F0467
</span><span id="__span-15-15"><a id="__codelineno-15-15" name="__codelineno-15-15" href="#__codelineno-15-15"></a>domain           : tenant
</span><span id="__span-15-16"><a id="__codelineno-15-16" name="__codelineno-15-16" href="#__codelineno-15-16"></a>extMngdBy        : undefined
</span><span id="__span-15-17"><a id="__codelineno-15-17" name="__codelineno-15-17" href="#__codelineno-15-17"></a>highestSeverity  : minor
</span><span id="__span-15-18"><a id="__codelineno-15-18" name="__codelineno-15-18" href="#__codelineno-15-18"></a>lastTransition   : 2021-06-22T09:04:51.985-04:00
</span><span id="__span-15-19"><a id="__codelineno-15-19" name="__codelineno-15-19" href="#__codelineno-15-19"></a>lc               : raised
</span><span id="__span-15-20"><a id="__codelineno-15-20" name="__codelineno-15-20" href="#__codelineno-15-20"></a>modTs            : never
</span><span id="__span-15-21"><a id="__codelineno-15-21" name="__codelineno-15-21" href="#__codelineno-15-21"></a>occur            : 1
</span><span id="__span-15-22"><a id="__codelineno-15-22" name="__codelineno-15-22" href="#__codelineno-15-22"></a>origSeverity     : minor
</span><span id="__span-15-23"><a id="__codelineno-15-23" name="__codelineno-15-23" href="#__codelineno-15-23"></a>prevSeverity     : minor
</span><span id="__span-15-24"><a id="__codelineno-15-24" name="__codelineno-15-24" href="#__codelineno-15-24"></a>rn               : fault-F0467
</span><span id="__span-15-25"><a id="__codelineno-15-25" name="__codelineno-15-25" href="#__codelineno-15-25"></a>rule             : fv-nw-issues-config-failed
</span><span id="__span-15-26"><a id="__codelineno-15-26" name="__codelineno-15-26" href="#__codelineno-15-26"></a>severity         : minor
</span><span id="__span-15-27"><a id="__codelineno-15-27" name="__codelineno-15-27" href="#__codelineno-15-27"></a>status           :
</span><span id="__span-15-28"><a id="__codelineno-15-28" name="__codelineno-15-28" href="#__codelineno-15-28"></a>subject          : management
</span><span id="__span-15-29"><a id="__codelineno-15-29" name="__codelineno-15-29" href="#__codelineno-15-29"></a>type             : config
</span><span id="__span-15-30"><a id="__codelineno-15-30" name="__codelineno-15-30" href="#__codelineno-15-30"></a>uid              :
</span></code></pre></div></p>
</div>
<h3 id="bd-subnets">BD Subnets</h3>
<p>If at any point in time an overlapping IP address or subnet is deployed within a VRF, that policy will fail and a fault will be raised at the node level. However, on upgrade, its possible that this previously failing configuration will get pushed to the leaf switch before the previously working configuration. This results in a situation where the known working state before the upgrade is broken after the upgrade and can cause connectivity issues for the previously working subnet.</p>
<p>There are two faults for this situation:</p>
<ul>
<li>
<p><strong>F0469</strong> (duplicate-subnets-within-ctx) is raised when multiple BD subnets are configured with the exact same subnet in the same VRF</p>
</li>
<li>
<p><strong>F1425</strong> (subnet-overlap) is raised when BD subnets are not the same but overlapping</p>
</li>
</ul>
<p>It is critical that you resolve these issues before the upgrade to prevent any issues. The subnet that the fault is raised on should either be corrected or deleted in order to clear the fault. You can run the moquery below on the CLI of any Cisco APIC to check if these faults exist on the system. The faults are visible within the GUI as well.</p>
<div class="admonition example">
<p class="admonition-title">Fault Example (F0469: duplicate-subnets-within-ctx)</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-16-1"><a id="__codelineno-16-1" name="__codelineno-16-1" href="#__codelineno-16-1"></a>admin@f1-apic1:~&gt; moquery -c faultInst -f &#39;fault.Inst.code==&quot;F0469&quot;&#39;
</span><span id="__span-16-2"><a id="__codelineno-16-2" name="__codelineno-16-2" href="#__codelineno-16-2"></a>Total Objects shown: 4
</span><span id="__span-16-3"><a id="__codelineno-16-3" name="__codelineno-16-3" href="#__codelineno-16-3"></a>
</span><span id="__span-16-4"><a id="__codelineno-16-4" name="__codelineno-16-4" href="#__codelineno-16-4"></a># fault.Inst
</span><span id="__span-16-5"><a id="__codelineno-16-5" name="__codelineno-16-5" href="#__codelineno-16-5"></a>code             : F0469
</span><span id="__span-16-6"><a id="__codelineno-16-6" name="__codelineno-16-6" href="#__codelineno-16-6"></a>ack              : no
</span><span id="__span-16-7"><a id="__codelineno-16-7" name="__codelineno-16-7" href="#__codelineno-16-7"></a>annotation       :
</span><span id="__span-16-8"><a id="__codelineno-16-8" name="__codelineno-16-8" href="#__codelineno-16-8"></a>cause            : configuration-failed
</span><span id="__span-16-9"><a id="__codelineno-16-9" name="__codelineno-16-9" href="#__codelineno-16-9"></a>changeSet        : configQual (New: duplicate-subnets-within-ctx), configSt (New: failed-to-apply), debugMessage (New: uni/tn-TK/BD-BD2,uni/tn-TK/BD-BD1)
</span><span id="__span-16-10"><a id="__codelineno-16-10" name="__codelineno-16-10" href="#__codelineno-16-10"></a>childAction      :
</span><span id="__span-16-11"><a id="__codelineno-16-11" name="__codelineno-16-11" href="#__codelineno-16-11"></a>created          : 2021-07-08T17:40:37.630-07:00
</span><span id="__span-16-12"><a id="__codelineno-16-12" name="__codelineno-16-12" href="#__codelineno-16-12"></a>delegated        : yes
</span><span id="__span-16-13"><a id="__codelineno-16-13" name="__codelineno-16-13" href="#__codelineno-16-13"></a>descr            : BD Configuration failed for uni/tn-TK/BD-BD2  due to duplicate-subnets-within-ctx: uni/tn-TK/BD-BD2 ,uni/tn-TK/BD-BD1
</span><span id="__span-16-14"><a id="__codelineno-16-14" name="__codelineno-16-14" href="#__codelineno-16-14"></a>dn               : topology/pod-1/node-101/local/svc-policyelem-id-0/uni/bd-[uni/tn-TK/BD-BD2]-isSvc-no/bdcfgissues/fault-F0469
</span><span id="__span-16-15"><a id="__codelineno-16-15" name="__codelineno-16-15" href="#__codelineno-16-15"></a>domain           : tenant
</span><span id="__span-16-16"><a id="__codelineno-16-16" name="__codelineno-16-16" href="#__codelineno-16-16"></a>extMngdBy        : undefined
</span><span id="__span-16-17"><a id="__codelineno-16-17" name="__codelineno-16-17" href="#__codelineno-16-17"></a>highestSeverity  : minor
</span><span id="__span-16-18"><a id="__codelineno-16-18" name="__codelineno-16-18" href="#__codelineno-16-18"></a>lastTransition   : 2021-07-08T17:40:37.630-07:00
</span><span id="__span-16-19"><a id="__codelineno-16-19" name="__codelineno-16-19" href="#__codelineno-16-19"></a>lc               : soaking
</span><span id="__span-16-20"><a id="__codelineno-16-20" name="__codelineno-16-20" href="#__codelineno-16-20"></a>modTs            : never
</span><span id="__span-16-21"><a id="__codelineno-16-21" name="__codelineno-16-21" href="#__codelineno-16-21"></a>occur            : 1
</span><span id="__span-16-22"><a id="__codelineno-16-22" name="__codelineno-16-22" href="#__codelineno-16-22"></a>origSeverity     : minor
</span><span id="__span-16-23"><a id="__codelineno-16-23" name="__codelineno-16-23" href="#__codelineno-16-23"></a>prevSeverity     : minor
</span><span id="__span-16-24"><a id="__codelineno-16-24" name="__codelineno-16-24" href="#__codelineno-16-24"></a>rn               : fault-F0469
</span><span id="__span-16-25"><a id="__codelineno-16-25" name="__codelineno-16-25" href="#__codelineno-16-25"></a>rule             : fv-bdconfig-issues-config-failed
</span><span id="__span-16-26"><a id="__codelineno-16-26" name="__codelineno-16-26" href="#__codelineno-16-26"></a>severity         : minor
</span><span id="__span-16-27"><a id="__codelineno-16-27" name="__codelineno-16-27" href="#__codelineno-16-27"></a>status           :
</span><span id="__span-16-28"><a id="__codelineno-16-28" name="__codelineno-16-28" href="#__codelineno-16-28"></a>subject          : management
</span><span id="__span-16-29"><a id="__codelineno-16-29" name="__codelineno-16-29" href="#__codelineno-16-29"></a>type             : config
</span><span id="__span-16-30"><a id="__codelineno-16-30" name="__codelineno-16-30" href="#__codelineno-16-30"></a>uid              :
</span><span id="__span-16-31"><a id="__codelineno-16-31" name="__codelineno-16-31" href="#__codelineno-16-31"></a>--- omit ---
</span></code></pre></div>
</div>
<div class="admonition example">
<p class="admonition-title">Fault Example (F1425: subnet-overlap)</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-17-1"><a id="__codelineno-17-1" name="__codelineno-17-1" href="#__codelineno-17-1"></a>admin@apic1:~&gt; moquery -c faultInst -f &#39;fault.Inst.code==&quot;F1425&quot;&#39;
</span><span id="__span-17-2"><a id="__codelineno-17-2" name="__codelineno-17-2" href="#__codelineno-17-2"></a>Total Objects shown: 1
</span><span id="__span-17-3"><a id="__codelineno-17-3" name="__codelineno-17-3" href="#__codelineno-17-3"></a>
</span><span id="__span-17-4"><a id="__codelineno-17-4" name="__codelineno-17-4" href="#__codelineno-17-4"></a># fault.Inst
</span><span id="__span-17-5"><a id="__codelineno-17-5" name="__codelineno-17-5" href="#__codelineno-17-5"></a>code             : F1425
</span><span id="__span-17-6"><a id="__codelineno-17-6" name="__codelineno-17-6" href="#__codelineno-17-6"></a>ack              : no
</span><span id="__span-17-7"><a id="__codelineno-17-7" name="__codelineno-17-7" href="#__codelineno-17-7"></a>annotation       : 
</span><span id="__span-17-8"><a id="__codelineno-17-8" name="__codelineno-17-8" href="#__codelineno-17-8"></a>cause            : ip-provisioning-failed
</span><span id="__span-17-9"><a id="__codelineno-17-9" name="__codelineno-17-9" href="#__codelineno-17-9"></a>changeSet        : ipv4CfgFailedBmp (New: ipv4:Addraddr_failed_flag,ipv4:Addrctrl_failed_flag,ipv4:AddrlcOwn_failed_flag, ipv4:AddrmodTs_failed_flag,ipv4:AddrmonPolDn_failed_flag,ipv4:Addrpref_failed_flag,ipv4:Addrtag_failed_flag, ipv4:Addrtype_failed_flag,ipv4:AddrvpcPeer_failed_flag), ipv4CfgState (New: 1), operStQual (New: subnet-overlap)
</span><span id="__span-17-10"><a id="__codelineno-17-10" name="__codelineno-17-10" href="#__codelineno-17-10"></a>childAction      : 
</span><span id="__span-17-11"><a id="__codelineno-17-11" name="__codelineno-17-11" href="#__codelineno-17-11"></a>created          : 2020-02-27T01:50:45.656+01:00
</span><span id="__span-17-12"><a id="__codelineno-17-12" name="__codelineno-17-12" href="#__codelineno-17-12"></a>delegated        : no
</span><span id="__span-17-13"><a id="__codelineno-17-13" name="__codelineno-17-13" href="#__codelineno-17-13"></a>descr            : IPv4 address(10.10.10.1/24) is operationally down, reason:Subnet overlap on node 101 fabric hostname leaf-101
</span><span id="__span-17-14"><a id="__codelineno-17-14" name="__codelineno-17-14" href="#__codelineno-17-14"></a>dn               : topology/pod-1/node-101/sys/ipv4/inst/dom-jr:v1/if-[vlan10]/addr-[10.10.10.1/24]/fault-F1425
</span><span id="__span-17-15"><a id="__codelineno-17-15" name="__codelineno-17-15" href="#__codelineno-17-15"></a>--- omit ---
</span></code></pre></div>
</div>
<h3 id="vmm-domain-controller-status">VMM Domain Controller Status</h3>
<p>If there is an issue in communication between the Cisco APIC and the VMM controller, the VMM controller status is marked as offline and the fault F0130 is raised. Ensure that the connectivity between them is restored prior to upgrades so that any resources that are currently deployed on switches based on the communication with the VMM controller will not be changed or lost due to the Cisco APICs not being able to retrieve necessary information after an upgrade.</p>
<div class="admonition example">
<p class="admonition-title">Fault Example (F0130: VMM Controller connection failure)</p>
<p>The following is an example of the Cisco APIC failing to communicate with the VMM controller <code>MyVMMControler</code> with the IP 192.168.100.100 in VMM domain <code>LAB_VMM</code>.
<div class="language-text highlight"><pre><span></span><code><span id="__span-18-1"><a id="__codelineno-18-1" name="__codelineno-18-1" href="#__codelineno-18-1"></a>apic1# moquery -c faultInst -f &#39;fault.Inst.code==&quot;F0130&quot;&#39;
</span><span id="__span-18-2"><a id="__codelineno-18-2" name="__codelineno-18-2" href="#__codelineno-18-2"></a>Total Objects shown: 1
</span><span id="__span-18-3"><a id="__codelineno-18-3" name="__codelineno-18-3" href="#__codelineno-18-3"></a>
</span><span id="__span-18-4"><a id="__codelineno-18-4" name="__codelineno-18-4" href="#__codelineno-18-4"></a># fault.Inst
</span><span id="__span-18-5"><a id="__codelineno-18-5" name="__codelineno-18-5" href="#__codelineno-18-5"></a>code             : F0130
</span><span id="__span-18-6"><a id="__codelineno-18-6" name="__codelineno-18-6" href="#__codelineno-18-6"></a>ack              : no
</span><span id="__span-18-7"><a id="__codelineno-18-7" name="__codelineno-18-7" href="#__codelineno-18-7"></a>cause            : connect-failed
</span><span id="__span-18-8"><a id="__codelineno-18-8" name="__codelineno-18-8" href="#__codelineno-18-8"></a>changeSet        : operSt (Old: unknown, New: offline)
</span><span id="__span-18-9"><a id="__codelineno-18-9" name="__codelineno-18-9" href="#__codelineno-18-9"></a>childAction      :
</span><span id="__span-18-10"><a id="__codelineno-18-10" name="__codelineno-18-10" href="#__codelineno-18-10"></a>created          : 2016-05-23T16:07:50.205-05:00
</span><span id="__span-18-11"><a id="__codelineno-18-11" name="__codelineno-18-11" href="#__codelineno-18-11"></a>delegated        : yes
</span><span id="__span-18-12"><a id="__codelineno-18-12" name="__codelineno-18-12" href="#__codelineno-18-12"></a>descr            : Connection to VMM controller: 192.168.100.100 with name MyVMMController in datacenter LAB1 in domain: LAB_VMM is failing repeatedly with error: [Failed to retrieve ServiceContent from the vCenter server 192.168.100.100]. Please verify network connectivity of VMM controller 192.168.100.100 and check VMM controller user credentials are valid.
</span><span id="__span-18-13"><a id="__codelineno-18-13" name="__codelineno-18-13" href="#__codelineno-18-13"></a>dn               : comp/prov-VMware/ctrlr-[LAB_VMM]-MyVMMController/fault-F0130
</span><span id="__span-18-14"><a id="__codelineno-18-14" name="__codelineno-18-14" href="#__codelineno-18-14"></a>domain           : external
</span><span id="__span-18-15"><a id="__codelineno-18-15" name="__codelineno-18-15" href="#__codelineno-18-15"></a>highestSeverity  : major
</span><span id="__span-18-16"><a id="__codelineno-18-16" name="__codelineno-18-16" href="#__codelineno-18-16"></a>lastTransition   : 2016-05-23T16:10:04.219-05:00
</span><span id="__span-18-17"><a id="__codelineno-18-17" name="__codelineno-18-17" href="#__codelineno-18-17"></a>lc               : raised
</span><span id="__span-18-18"><a id="__codelineno-18-18" name="__codelineno-18-18" href="#__codelineno-18-18"></a>modTs            : never
</span><span id="__span-18-19"><a id="__codelineno-18-19" name="__codelineno-18-19" href="#__codelineno-18-19"></a>occur            : 1
</span><span id="__span-18-20"><a id="__codelineno-18-20" name="__codelineno-18-20" href="#__codelineno-18-20"></a>origSeverity     : major
</span><span id="__span-18-21"><a id="__codelineno-18-21" name="__codelineno-18-21" href="#__codelineno-18-21"></a>prevSeverity     : major
</span><span id="__span-18-22"><a id="__codelineno-18-22" name="__codelineno-18-22" href="#__codelineno-18-22"></a>rn               : fault-F0130
</span><span id="__span-18-23"><a id="__codelineno-18-23" name="__codelineno-18-23" href="#__codelineno-18-23"></a>rule             : comp-ctrlr-connect-failed
</span><span id="__span-18-24"><a id="__codelineno-18-24" name="__codelineno-18-24" href="#__codelineno-18-24"></a>severity         : major
</span><span id="__span-18-25"><a id="__codelineno-18-25" name="__codelineno-18-25" href="#__codelineno-18-25"></a>status           :
</span><span id="__span-18-26"><a id="__codelineno-18-26" name="__codelineno-18-26" href="#__codelineno-18-26"></a>subject          : controller
</span><span id="__span-18-27"><a id="__codelineno-18-27" name="__codelineno-18-27" href="#__codelineno-18-27"></a>type             : communications
</span><span id="__span-18-28"><a id="__codelineno-18-28" name="__codelineno-18-28" href="#__codelineno-18-28"></a>uid              :
</span></code></pre></div></p>
</div>
<h3 id="vmm-domain-lldpcdp-adjacency-status">VMM Domain LLDP/CDP Adjacency Status</h3>
<p>With <strong>On Demand</strong> or <strong>Immediate</strong> resolution immediacy as opposed to <strong>pre-provision</strong> in the VMM domain when attaching it to an EPG, for some VMM integrations such as VMware DVS integration, the Cisco APIC checks LLDP or CDP information from leaf switches connected to the hypervisors and also from the VMM controller managing the hypervisors. This information is required from both leaf switches and hypervisors to dynamically detect the leaf interface connecting to the hypervisor, even when there is an intermediate switch in between such as Cisco UCS Fabric Interconnect. Once the interface is detected, the Cisco APIC dynamically deploys VLANs only on the necessary interface(s) of the leaf switch that the hypervisor is connected to.</p>
<p>Prior to Cisco APIC release 3.0(1), VLANs used to be removed from the leaf interfaces if the Cisco APIC loses the connectivity to the VMM controller because the Cisco APIC can no longer compare the LLDP or CDP information from the hypervisors point of view. Starting from Cisco APIC release 3.0(1), VLANs will not be removed from the leaf interfaces even if the Cisco APIC loses the connectivity to the VMM controller to prevent transient management plane issues from impacting the data plane traffic. However, it may cause some churns in the Cisco APIC process by repeatedly trying to obtain the LLDP/CDP information. When the LLDP/CDP information is missing, the fault F606391 is raised.</p>
<p>Due to these reasons, regardless of the Cisco APIC release, it is important to resolve this fault prior to the upgrade. If the faults are raised on a VMM domain configured for the Cisco Application Virtual Edge (AVE), LLDP and CDP can be disabled entirely because the control plane built to program the switches is based on the opflex protocol and not LLDP/CDP. When LLDP and CDP are disabled, the faults should clear. The configuration to change the LLDP/CDP state for a VMM domain is configured under the vSwitch Policy for the VMM Domain.</p>
<div class="admonition example">
<p class="admonition-title">Fault Example (F606391: LLDP/CDP adjacency missing for hypervisors)</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-19-1"><a id="__codelineno-19-1" name="__codelineno-19-1" href="#__codelineno-19-1"></a>apic1# moquery -c faultInst -f &#39;fault.Inst.code==&quot;F606391&quot;&#39;
</span><span id="__span-19-2"><a id="__codelineno-19-2" name="__codelineno-19-2" href="#__codelineno-19-2"></a>Total Objects shown: 5
</span><span id="__span-19-3"><a id="__codelineno-19-3" name="__codelineno-19-3" href="#__codelineno-19-3"></a>
</span><span id="__span-19-4"><a id="__codelineno-19-4" name="__codelineno-19-4" href="#__codelineno-19-4"></a># fault.Inst
</span><span id="__span-19-5"><a id="__codelineno-19-5" name="__codelineno-19-5" href="#__codelineno-19-5"></a>code                      : F606391
</span><span id="__span-19-6"><a id="__codelineno-19-6" name="__codelineno-19-6" href="#__codelineno-19-6"></a>ack                       : no
</span><span id="__span-19-7"><a id="__codelineno-19-7" name="__codelineno-19-7" href="#__codelineno-19-7"></a>annotation                : 
</span><span id="__span-19-8"><a id="__codelineno-19-8" name="__codelineno-19-8" href="#__codelineno-19-8"></a>cause                     : fsm-failed
</span><span id="__span-19-9"><a id="__codelineno-19-9" name="__codelineno-19-9" href="#__codelineno-19-9"></a>changeSet                 : 
</span><span id="__span-19-10"><a id="__codelineno-19-10" name="__codelineno-19-10" href="#__codelineno-19-10"></a>childAction               : 
</span><span id="__span-19-11"><a id="__codelineno-19-11" name="__codelineno-19-11" href="#__codelineno-19-11"></a>created                   : 2019-07-18T01:17:39.435+08:00
</span><span id="__span-19-12"><a id="__codelineno-19-12" name="__codelineno-19-12" href="#__codelineno-19-12"></a>delegated                 : yes
</span><span id="__span-19-13"><a id="__codelineno-19-13" name="__codelineno-19-13" href="#__codelineno-19-13"></a>descr                     : [FSM:FAILED]: Get LLDP/CDP adjacency information for the physical adapters on the host: hypervisor1.cisco.com(TASK:ifc:vmmmgr:CompHvGetHpNicAdj)
</span><span id="__span-19-14"><a id="__codelineno-19-14" name="__codelineno-19-14" href="#__codelineno-19-14"></a>dn                        : comp/prov-VMware/ctrlr-[LAB_VMM]-MyVMMController/hv-host-29039/fault-F606391
</span><span id="__span-19-15"><a id="__codelineno-19-15" name="__codelineno-19-15" href="#__codelineno-19-15"></a>domain                    : infra
</span><span id="__span-19-16"><a id="__codelineno-19-16" name="__codelineno-19-16" href="#__codelineno-19-16"></a>extMngdBy                 : undefined
</span><span id="__span-19-17"><a id="__codelineno-19-17" name="__codelineno-19-17" href="#__codelineno-19-17"></a>highestSeverity           : major
</span><span id="__span-19-18"><a id="__codelineno-19-18" name="__codelineno-19-18" href="#__codelineno-19-18"></a>lastTransition            : 2019-07-18T01:17:39.435+08:00
</span><span id="__span-19-19"><a id="__codelineno-19-19" name="__codelineno-19-19" href="#__codelineno-19-19"></a>lc                        : raised
</span><span id="__span-19-20"><a id="__codelineno-19-20" name="__codelineno-19-20" href="#__codelineno-19-20"></a>modTs                     : never
</span><span id="__span-19-21"><a id="__codelineno-19-21" name="__codelineno-19-21" href="#__codelineno-19-21"></a>occur                     : 1
</span><span id="__span-19-22"><a id="__codelineno-19-22" name="__codelineno-19-22" href="#__codelineno-19-22"></a>origSeverity              : major
</span><span id="__span-19-23"><a id="__codelineno-19-23" name="__codelineno-19-23" href="#__codelineno-19-23"></a>prevSeverity              : major
</span><span id="__span-19-24"><a id="__codelineno-19-24" name="__codelineno-19-24" href="#__codelineno-19-24"></a>rn                        : fault-F606391
</span><span id="__span-19-25"><a id="__codelineno-19-25" name="__codelineno-19-25" href="#__codelineno-19-25"></a>rule                      : fsm-get-hp-nic-adj-fsm-fail
</span><span id="__span-19-26"><a id="__codelineno-19-26" name="__codelineno-19-26" href="#__codelineno-19-26"></a>severity                  : major
</span><span id="__span-19-27"><a id="__codelineno-19-27" name="__codelineno-19-27" href="#__codelineno-19-27"></a>status                    : 
</span><span id="__span-19-28"><a id="__codelineno-19-28" name="__codelineno-19-28" href="#__codelineno-19-28"></a>subject                   : task-ifc-vmmmgr-comp-hv-get-hp-nic-adj
</span><span id="__span-19-29"><a id="__codelineno-19-29" name="__codelineno-19-29" href="#__codelineno-19-29"></a>type                      : config
</span><span id="__span-19-30"><a id="__codelineno-19-30" name="__codelineno-19-30" href="#__codelineno-19-30"></a>uid                       :
</span></code></pre></div>
</div>
<h3 id="different-infra-vlan-via-lldp">Different infra VLAN via LLDP</h3>
<p>If you have interfaces connected back-to-back between two different ACI fabrics, you must disable LLDP on those interfaces prior to upgrades. This is because when the switch comes back up after the upgrade, it may receive and process LLDP packets from the other fabric that may be using a different infra VLAN. If that happens, the switch incorrectly tries to be discovered through the infra VLAN of the other fabric and will not be discoverable in the correct fabric.</p>
<p>There is a fault to detect if an ACI switch is currently is receiving an LLDP packet with infra VLAN mismatch from other fabrics.</p>
<div class="admonition example">
<p class="admonition-title">Fault Example (F0454: LLDP with mismatched parameters)</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-20-1"><a id="__codelineno-20-1" name="__codelineno-20-1" href="#__codelineno-20-1"></a>apic1# moquery -c faultInst -f &#39;fault.Inst.code==&quot;F0454&quot;&#39;
</span><span id="__span-20-2"><a id="__codelineno-20-2" name="__codelineno-20-2" href="#__codelineno-20-2"></a>Total Objects shown: 2
</span><span id="__span-20-3"><a id="__codelineno-20-3" name="__codelineno-20-3" href="#__codelineno-20-3"></a>
</span><span id="__span-20-4"><a id="__codelineno-20-4" name="__codelineno-20-4" href="#__codelineno-20-4"></a># fault.Inst
</span><span id="__span-20-5"><a id="__codelineno-20-5" name="__codelineno-20-5" href="#__codelineno-20-5"></a>code             : F0454
</span><span id="__span-20-6"><a id="__codelineno-20-6" name="__codelineno-20-6" href="#__codelineno-20-6"></a>ack              : no
</span><span id="__span-20-7"><a id="__codelineno-20-7" name="__codelineno-20-7" href="#__codelineno-20-7"></a>alert            : no
</span><span id="__span-20-8"><a id="__codelineno-20-8" name="__codelineno-20-8" href="#__codelineno-20-8"></a>annotation       :
</span><span id="__span-20-9"><a id="__codelineno-20-9" name="__codelineno-20-9" href="#__codelineno-20-9"></a>cause            : wiring-check-failed
</span><span id="__span-20-10"><a id="__codelineno-20-10" name="__codelineno-20-10" href="#__codelineno-20-10"></a>changeSet        : wiringIssues (New: ctrlr-uuid-mismatch,fabric-domain-mismatch,infra-ip-mismatch,infra-vlan-mismatch)
</span><span id="__span-20-11"><a id="__codelineno-20-11" name="__codelineno-20-11" href="#__codelineno-20-11"></a>childAction      :
</span><span id="__span-20-12"><a id="__codelineno-20-12" name="__codelineno-20-12" href="#__codelineno-20-12"></a>created          : 2021-06-30T10:44:25.576-07:00
</span><span id="__span-20-13"><a id="__codelineno-20-13" name="__codelineno-20-13" href="#__codelineno-20-13"></a>delegated        : no
</span><span id="__span-20-14"><a id="__codelineno-20-14" name="__codelineno-20-14" href="#__codelineno-20-14"></a>descr            : Port eth1/48 is out of service due to Controller UUID mismatch,Fabric domain name mismatch,Infra subnet mismatch,Infra vlan mismatch
</span><span id="__span-20-15"><a id="__codelineno-20-15" name="__codelineno-20-15" href="#__codelineno-20-15"></a>dn               : topology/pod-1/node-104/sys/lldp/inst/if-[eth1/48]/fault-F0454
</span><span id="__span-20-16"><a id="__codelineno-20-16" name="__codelineno-20-16" href="#__codelineno-20-16"></a>--- omit ---
</span></code></pre></div>
</div>
<h3 id="hw-programming-failure">HW Programming Failure</h3>
<p>The fault F3544 occurs when the switch fails to activate an entry to map a prefix to pcTag due to either a hardware or software programming failure. These entries are configured for L3Out subnets with the <strong>External Subnets for the External EPG</strong> scope under an external EPG in an L3Out, and used to map L3Out subnets to L3Out EPGs. If you see this because of the LPM or host routes capacity on the switch, such a switch may activate different sets of entries after a reboot or upgrade. This may lead to services that used to work before an upgrade begins to fail after an upgrade. When this fault is present, check the <code>Operations &gt; Capacity Dashboard &gt; Leaf Capacity</code> in the Cisco APIC GUI for LPM and /32 or /128 routes usage.</p>
<p>The fault F3545 occurs when the switch fails to activate a contract rule (zoning-rule) due to either a hardware or software programming failure. If you see this, it's because the policy CAM is full and no more contracts can be deployed on the switch, and a different sets of contracts may deploy after a reboot or upgrade. This may lead to services that used to work before an upgrade begins to fail after an upgrade. Note that the same fault could occur for other reasons, such as an unsupported type of filter in the contract(s) instead of policy CAM usage. For instance, first generation ACI switches support EtherType IP but not IPv4 or IPv6 in contract filters. When this fault is present, check the <code>Operations &gt; Capacity Dashboard &gt; Leaf Capacity</code> in the Cisco APIC GUI for policy CAM usage.</p>
<div class="admonition example">
<p class="admonition-title">Fault Example (F3544: L3Out Subnet Programming Failure)</p>
<p>The following shows an example of node 101 with programming failure for 80 L3Out subnets with <strong>External Subnets for the External EPG</strong> (<code>pfxRuleFailed</code>). Although it also shows the programming failure of contracts themselves (<code>zoneRuleFailed</code>) in the <code>changeSet</code>, a separate fault F3545 is raised for that.
<div class="language-text highlight"><pre><span></span><code><span id="__span-21-1"><a id="__codelineno-21-1" name="__codelineno-21-1" href="#__codelineno-21-1"></a>apic1# moquery -c faultInst -f &#39;fault.Inst.code==&quot;F3544&quot;&#39;
</span><span id="__span-21-2"><a id="__codelineno-21-2" name="__codelineno-21-2" href="#__codelineno-21-2"></a>Total Objects shown: 1
</span><span id="__span-21-3"><a id="__codelineno-21-3" name="__codelineno-21-3" href="#__codelineno-21-3"></a>
</span><span id="__span-21-4"><a id="__codelineno-21-4" name="__codelineno-21-4" href="#__codelineno-21-4"></a># fault.Inst
</span><span id="__span-21-5"><a id="__codelineno-21-5" name="__codelineno-21-5" href="#__codelineno-21-5"></a>code             : F3544
</span><span id="__span-21-6"><a id="__codelineno-21-6" name="__codelineno-21-6" href="#__codelineno-21-6"></a>ack              : no
</span><span id="__span-21-7"><a id="__codelineno-21-7" name="__codelineno-21-7" href="#__codelineno-21-7"></a>annotation       : 
</span><span id="__span-21-8"><a id="__codelineno-21-8" name="__codelineno-21-8" href="#__codelineno-21-8"></a>cause            : actrl-resource-unavailable
</span><span id="__span-21-9"><a id="__codelineno-21-9" name="__codelineno-21-9" href="#__codelineno-21-9"></a>changeSet        : pfxRuleFailed (New: 80), zoneRuleFailed (New: 266)
</span><span id="__span-21-10"><a id="__codelineno-21-10" name="__codelineno-21-10" href="#__codelineno-21-10"></a>childAction      : 
</span><span id="__span-21-11"><a id="__codelineno-21-11" name="__codelineno-21-11" href="#__codelineno-21-11"></a>created          : 2020-02-26T01:01:49.246-05:00
</span><span id="__span-21-12"><a id="__codelineno-21-12" name="__codelineno-21-12" href="#__codelineno-21-12"></a>delegated        : no
</span><span id="__span-21-13"><a id="__codelineno-21-13" name="__codelineno-21-13" href="#__codelineno-21-13"></a>descr            : 80 number of Prefix failed on leaf1
</span><span id="__span-21-14"><a id="__codelineno-21-14" name="__codelineno-21-14" href="#__codelineno-21-14"></a>dn               : topology/pod-1/node-101/sys/actrl/dbgStatsReport/fault-F3544
</span><span id="__span-21-15"><a id="__codelineno-21-15" name="__codelineno-21-15" href="#__codelineno-21-15"></a>domain           : infra
</span><span id="__span-21-16"><a id="__codelineno-21-16" name="__codelineno-21-16" href="#__codelineno-21-16"></a>extMngdBy        : undefined
</span><span id="__span-21-17"><a id="__codelineno-21-17" name="__codelineno-21-17" href="#__codelineno-21-17"></a>highestSeverity  : major
</span><span id="__span-21-18"><a id="__codelineno-21-18" name="__codelineno-21-18" href="#__codelineno-21-18"></a>lastTransition   : 2020-02-26T01:03:59.849-05:00
</span><span id="__span-21-19"><a id="__codelineno-21-19" name="__codelineno-21-19" href="#__codelineno-21-19"></a>lc               : raised
</span><span id="__span-21-20"><a id="__codelineno-21-20" name="__codelineno-21-20" href="#__codelineno-21-20"></a>modTs            : never
</span><span id="__span-21-21"><a id="__codelineno-21-21" name="__codelineno-21-21" href="#__codelineno-21-21"></a>occur            : 1
</span><span id="__span-21-22"><a id="__codelineno-21-22" name="__codelineno-21-22" href="#__codelineno-21-22"></a>origSeverity     : major
</span><span id="__span-21-23"><a id="__codelineno-21-23" name="__codelineno-21-23" href="#__codelineno-21-23"></a>prevSeverity     : major
</span><span id="__span-21-24"><a id="__codelineno-21-24" name="__codelineno-21-24" href="#__codelineno-21-24"></a>rn               : fault-F3544
</span><span id="__span-21-25"><a id="__codelineno-21-25" name="__codelineno-21-25" href="#__codelineno-21-25"></a>rule             : actrl-stats-report-pre-fix-prog-failed
</span><span id="__span-21-26"><a id="__codelineno-21-26" name="__codelineno-21-26" href="#__codelineno-21-26"></a>severity         : major
</span><span id="__span-21-27"><a id="__codelineno-21-27" name="__codelineno-21-27" href="#__codelineno-21-27"></a>status           : 
</span><span id="__span-21-28"><a id="__codelineno-21-28" name="__codelineno-21-28" href="#__codelineno-21-28"></a>subject          : hwprog-failed
</span><span id="__span-21-29"><a id="__codelineno-21-29" name="__codelineno-21-29" href="#__codelineno-21-29"></a>type             : operational
</span><span id="__span-21-30"><a id="__codelineno-21-30" name="__codelineno-21-30" href="#__codelineno-21-30"></a>uid              :
</span></code></pre></div></p>
</div>
<div class="admonition example">
<p class="admonition-title">Fault Example (F3545: Zoning Rule Programming Failure)</p>
<p>The following shows an example of node 101 with programming failure for 266 contract rules (<code>zoneRuleFailed</code>). Although it also shows the programming failure of L3Out subnets (<code>pfxRuleFailed</code>) in the <code>changeSet</code>, a separate fault F3544 is raised for that.
<div class="language-text highlight"><pre><span></span><code><span id="__span-22-1"><a id="__codelineno-22-1" name="__codelineno-22-1" href="#__codelineno-22-1"></a>apic1# moquery -c faultInst -f &#39;fault.Inst.code==&quot;F3545&quot;&#39;
</span><span id="__span-22-2"><a id="__codelineno-22-2" name="__codelineno-22-2" href="#__codelineno-22-2"></a>Total Objects shown: 1
</span><span id="__span-22-3"><a id="__codelineno-22-3" name="__codelineno-22-3" href="#__codelineno-22-3"></a>
</span><span id="__span-22-4"><a id="__codelineno-22-4" name="__codelineno-22-4" href="#__codelineno-22-4"></a># fault.Inst
</span><span id="__span-22-5"><a id="__codelineno-22-5" name="__codelineno-22-5" href="#__codelineno-22-5"></a>code             : F3545
</span><span id="__span-22-6"><a id="__codelineno-22-6" name="__codelineno-22-6" href="#__codelineno-22-6"></a>ack              : no
</span><span id="__span-22-7"><a id="__codelineno-22-7" name="__codelineno-22-7" href="#__codelineno-22-7"></a>annotation       : 
</span><span id="__span-22-8"><a id="__codelineno-22-8" name="__codelineno-22-8" href="#__codelineno-22-8"></a>cause            : actrl-resource-unavailable
</span><span id="__span-22-9"><a id="__codelineno-22-9" name="__codelineno-22-9" href="#__codelineno-22-9"></a>changeSet        : pfxRuleFailed (New: 80), zoneRuleFailed (New: 266)
</span><span id="__span-22-10"><a id="__codelineno-22-10" name="__codelineno-22-10" href="#__codelineno-22-10"></a>childAction      : 
</span><span id="__span-22-11"><a id="__codelineno-22-11" name="__codelineno-22-11" href="#__codelineno-22-11"></a>created          : 2020-02-26T01:01:49.256-05:00
</span><span id="__span-22-12"><a id="__codelineno-22-12" name="__codelineno-22-12" href="#__codelineno-22-12"></a>delegated        : no
</span><span id="__span-22-13"><a id="__codelineno-22-13" name="__codelineno-22-13" href="#__codelineno-22-13"></a>descr            : 266 number of Rules failed on leaf1
</span><span id="__span-22-14"><a id="__codelineno-22-14" name="__codelineno-22-14" href="#__codelineno-22-14"></a>dn               : topology/pod-1/node-101/sys/actrl/dbgStatsReport/fault-F3545
</span><span id="__span-22-15"><a id="__codelineno-22-15" name="__codelineno-22-15" href="#__codelineno-22-15"></a>domain           : infra
</span><span id="__span-22-16"><a id="__codelineno-22-16" name="__codelineno-22-16" href="#__codelineno-22-16"></a>extMngdBy        : undefined
</span><span id="__span-22-17"><a id="__codelineno-22-17" name="__codelineno-22-17" href="#__codelineno-22-17"></a>highestSeverity  : major
</span><span id="__span-22-18"><a id="__codelineno-22-18" name="__codelineno-22-18" href="#__codelineno-22-18"></a>lastTransition   : 2020-02-26T01:03:59.849-05:00
</span><span id="__span-22-19"><a id="__codelineno-22-19" name="__codelineno-22-19" href="#__codelineno-22-19"></a>lc               : raised
</span><span id="__span-22-20"><a id="__codelineno-22-20" name="__codelineno-22-20" href="#__codelineno-22-20"></a>modTs            : never
</span><span id="__span-22-21"><a id="__codelineno-22-21" name="__codelineno-22-21" href="#__codelineno-22-21"></a>occur            : 1
</span><span id="__span-22-22"><a id="__codelineno-22-22" name="__codelineno-22-22" href="#__codelineno-22-22"></a>origSeverity     : major
</span><span id="__span-22-23"><a id="__codelineno-22-23" name="__codelineno-22-23" href="#__codelineno-22-23"></a>prevSeverity     : major
</span><span id="__span-22-24"><a id="__codelineno-22-24" name="__codelineno-22-24" href="#__codelineno-22-24"></a>rn               : fault-F3545
</span><span id="__span-22-25"><a id="__codelineno-22-25" name="__codelineno-22-25" href="#__codelineno-22-25"></a>rule             : actrl-stats-report-zone-rule-prog-failed
</span><span id="__span-22-26"><a id="__codelineno-22-26" name="__codelineno-22-26" href="#__codelineno-22-26"></a>severity         : major
</span><span id="__span-22-27"><a id="__codelineno-22-27" name="__codelineno-22-27" href="#__codelineno-22-27"></a>status           : 
</span><span id="__span-22-28"><a id="__codelineno-22-28" name="__codelineno-22-28" href="#__codelineno-22-28"></a>subject          : hwprog-failed
</span><span id="__span-22-29"><a id="__codelineno-22-29" name="__codelineno-22-29" href="#__codelineno-22-29"></a>type             : operational
</span><span id="__span-22-30"><a id="__codelineno-22-30" name="__codelineno-22-30" href="#__codelineno-22-30"></a>uid              :
</span></code></pre></div></p>
</div>
<h3 id="scalability-faults-related-to-capacity-dashboard">Scalability (faults related to Capacity Dashboard)</h3>
<p>The script checks faults raised under <code>eqptcapacityEntity</code>, which are TCA (Threshold Crossed Alert) faults for various objects monitored in the <strong>Capacity Dashboard</strong> from <code>Operations &gt; Capacity Dashboard &gt; Leaf Capacity</code> on the Cisco APIC GUI.</p>
<p>It is important to ensure that any capacity does not exceed its limit. When it's exceeding the limit, it may cause inconsistency on resources that are deployed before and after an upgrade just like it was warned for <a href="#vmm-domain-lldpcdp-adjacency-status">Policy CAM Programming for Contracts (F3545) and L3Out Subnets Programming for Contracts (F3544)</a>.</p>
<p>Examples of what's monitored via <code>Operations &gt; Capacity Dashboard &gt; Leaf Capacity</code> are the number of endpoints such as MAC (Learned), IPv4 (Learned), Policy CAM, LPM, host routes, VLANs and so on.</p>
<div class="admonition example">
<p class="admonition-title">Fault Example (F193568: TCA VLAN Usage)</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-23-1"><a id="__codelineno-23-1" name="__codelineno-23-1" href="#__codelineno-23-1"></a>apic1# moquery -c eqptcapacityEntity -x &#39;rsp-subtree-include=faults,no-scoped&#39;
</span><span id="__span-23-2"><a id="__codelineno-23-2" name="__codelineno-23-2" href="#__codelineno-23-2"></a>Total Objects shown: 1
</span><span id="__span-23-3"><a id="__codelineno-23-3" name="__codelineno-23-3" href="#__codelineno-23-3"></a>
</span><span id="__span-23-4"><a id="__codelineno-23-4" name="__codelineno-23-4" href="#__codelineno-23-4"></a># fault.Inst
</span><span id="__span-23-5"><a id="__codelineno-23-5" name="__codelineno-23-5" href="#__codelineno-23-5"></a>code             : F193568
</span><span id="__span-23-6"><a id="__codelineno-23-6" name="__codelineno-23-6" href="#__codelineno-23-6"></a>ack              : no
</span><span id="__span-23-7"><a id="__codelineno-23-7" name="__codelineno-23-7" href="#__codelineno-23-7"></a>annotation       : 
</span><span id="__span-23-8"><a id="__codelineno-23-8" name="__codelineno-23-8" href="#__codelineno-23-8"></a>cause            : threshold-crossed
</span><span id="__span-23-9"><a id="__codelineno-23-9" name="__codelineno-23-9" href="#__codelineno-23-9"></a>changeSet        : totalCum:4018
</span><span id="__span-23-10"><a id="__codelineno-23-10" name="__codelineno-23-10" href="#__codelineno-23-10"></a>childAction      : 
</span><span id="__span-23-11"><a id="__codelineno-23-11" name="__codelineno-23-11" href="#__codelineno-23-11"></a>created          : 2022-12-09T10:53:01.103-08:00
</span><span id="__span-23-12"><a id="__codelineno-23-12" name="__codelineno-23-12" href="#__codelineno-23-12"></a>delegated        : no
</span><span id="__span-23-13"><a id="__codelineno-23-13" name="__codelineno-23-13" href="#__codelineno-23-13"></a>descr            : TCA: Total vlan entries cumulative(eqptcapacityVlanUsage5min:totalCum) value 4018 raised above threshold 90
</span><span id="__span-23-14"><a id="__codelineno-23-14" name="__codelineno-23-14" href="#__codelineno-23-14"></a>dn               : topology/pod-1/node-101/sys/eqptcapacity/fault-F193568
</span><span id="__span-23-15"><a id="__codelineno-23-15" name="__codelineno-23-15" href="#__codelineno-23-15"></a>domain           : infra
</span><span id="__span-23-16"><a id="__codelineno-23-16" name="__codelineno-23-16" href="#__codelineno-23-16"></a>extMngdBy        : undefined
</span><span id="__span-23-17"><a id="__codelineno-23-17" name="__codelineno-23-17" href="#__codelineno-23-17"></a>highestSeverity  : critica
</span><span id="__span-23-18"><a id="__codelineno-23-18" name="__codelineno-23-18" href="#__codelineno-23-18"></a>lastTransition   : 2022-12-09T10:53:01.103-08:00
</span><span id="__span-23-19"><a id="__codelineno-23-19" name="__codelineno-23-19" href="#__codelineno-23-19"></a>lc               : raised
</span><span id="__span-23-20"><a id="__codelineno-23-20" name="__codelineno-23-20" href="#__codelineno-23-20"></a>modTs            : never
</span><span id="__span-23-21"><a id="__codelineno-23-21" name="__codelineno-23-21" href="#__codelineno-23-21"></a>occur            : 1
</span><span id="__span-23-22"><a id="__codelineno-23-22" name="__codelineno-23-22" href="#__codelineno-23-22"></a>origSeverity     : critical 
</span><span id="__span-23-23"><a id="__codelineno-23-23" name="__codelineno-23-23" href="#__codelineno-23-23"></a>prevSeverity     : critical
</span><span id="__span-23-24"><a id="__codelineno-23-24" name="__codelineno-23-24" href="#__codelineno-23-24"></a>rn               : fault-F193568
</span><span id="__span-23-25"><a id="__codelineno-23-25" name="__codelineno-23-25" href="#__codelineno-23-25"></a>rule             : tca-eqptcapacity-vlan-usage5min-total-cum
</span><span id="__span-23-26"><a id="__codelineno-23-26" name="__codelineno-23-26" href="#__codelineno-23-26"></a>severity         : critical
</span><span id="__span-23-27"><a id="__codelineno-23-27" name="__codelineno-23-27" href="#__codelineno-23-27"></a>status           : 
</span><span id="__span-23-28"><a id="__codelineno-23-28" name="__codelineno-23-28" href="#__codelineno-23-28"></a>subject          : counter
</span><span id="__span-23-29"><a id="__codelineno-23-29" name="__codelineno-23-29" href="#__codelineno-23-29"></a>type             : operational
</span><span id="__span-23-30"><a id="__codelineno-23-30" name="__codelineno-23-30" href="#__codelineno-23-30"></a>uid              :
</span></code></pre></div>
</div>
<h3 id="fabric-port-status">Fabric Port Status</h3>
<p>The script checks for fault code <code>F1394</code> with rule <code>ethpm-if-port-down-fabric</code>, which is raised against a fabric port that is admin up and used to be operaitonally up at some point in the past, but is now operationally down.</p>
<p>It is important to understand whether or not these fabric ports are expected to be down, and especially whether or not it's preventing your ACI switches from having redundant paths to other ACI switches. If unexpected, address these issues before performing the ACI Upgrade.</p>
<p>Failure to do so may lead to outages during switch upgrades due to leaf nodes not having redundant spine paths (or tier-2 leaf nodes not having redundant tier-1 leaf paths), or due to less bandwidth available through a reduced number of fabric ports.</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>When the fault is expected, in other words when the fabric port is expected to be down even though it used to be up, you can administratively disable (i.e. admin down) the port from APIC to clear the fault.</p>
<p>A common reason of when the fault is expected is <code>sfpAbsent</code> (or <code>sfp-missing</code>). This can be expected when you explicitly removed the SFP as the port is no longer used. In such a case, you should admin-down the port to clear the fault. Note that <code>sfpAbsent</code> may not be expected when the SFP on the port got loosen unexpectedly and hence not recognized correctly. In such as case, make sure to re-insert the SFP.</p>
</div>
<div class="admonition example">
<p class="admonition-title">Fault Example 1 (F1394: ethpm-if-port-down-fabric)</p>
<p>The example below is when node-104 eth1/51 is down because of <code>Link Not Connected</code> which indicates that the SFP is inserted but the link signals from the connected device haven't been received.
The script shows the reason part in the fault description - "<code>Link Not Connected(Connected), used by:Fabric</code>".</p>
<ul>
<li><code>Link Not Connected</code> - This is the operational status of the port that is down.</li>
<li><code>(Connected)</code> - This is supposed to be the error disabled reason. When the port is not error disabled, however, the output shows <code>Connected</code> which can be misleading and confusing. It does not mean it is actually connected. It simply means that the port was not error disabled.</li>
</ul>
<div class="language-text highlight"><pre><span></span><code><span id="__span-24-1"><a id="__codelineno-24-1" name="__codelineno-24-1" href="#__codelineno-24-1"></a>admin@f1-apic1:~&gt; moquery -c faultInst -f &#39;fault.Inst.code==&quot;F1394&quot;&#39;
</span><span id="__span-24-2"><a id="__codelineno-24-2" name="__codelineno-24-2" href="#__codelineno-24-2"></a>Total Objects shown: 1
</span><span id="__span-24-3"><a id="__codelineno-24-3" name="__codelineno-24-3" href="#__codelineno-24-3"></a>
</span><span id="__span-24-4"><a id="__codelineno-24-4" name="__codelineno-24-4" href="#__codelineno-24-4"></a># fault.Inst
</span><span id="__span-24-5"><a id="__codelineno-24-5" name="__codelineno-24-5" href="#__codelineno-24-5"></a>code             : F1394
</span><span id="__span-24-6"><a id="__codelineno-24-6" name="__codelineno-24-6" href="#__codelineno-24-6"></a>ack              : no
</span><span id="__span-24-7"><a id="__codelineno-24-7" name="__codelineno-24-7" href="#__codelineno-24-7"></a>alert            : no
</span><span id="__span-24-8"><a id="__codelineno-24-8" name="__codelineno-24-8" href="#__codelineno-24-8"></a>annotation       :
</span><span id="__span-24-9"><a id="__codelineno-24-9" name="__codelineno-24-9" href="#__codelineno-24-9"></a>cause            : interface-physical-down
</span><span id="__span-24-10"><a id="__codelineno-24-10" name="__codelineno-24-10" href="#__codelineno-24-10"></a>changeSet        : operBitset (New: 4,35), operStQual (New: link-not-connected)
</span><span id="__span-24-11"><a id="__codelineno-24-11" name="__codelineno-24-11" href="#__codelineno-24-11"></a>childAction      :
</span><span id="__span-24-12"><a id="__codelineno-24-12" name="__codelineno-24-12" href="#__codelineno-24-12"></a>created          : 2025-04-17T12:06:09.049-07:00
</span><span id="__span-24-13"><a id="__codelineno-24-13" name="__codelineno-24-13" href="#__codelineno-24-13"></a>delegated        : no
</span><span id="__span-24-14"><a id="__codelineno-24-14" name="__codelineno-24-14" href="#__codelineno-24-14"></a>descr            : Port is down, reason:Link Not Connected(Connected), used by:Fabric
</span><span id="__span-24-15"><a id="__codelineno-24-15" name="__codelineno-24-15" href="#__codelineno-24-15"></a>dn               : topology/pod-2/node-104/sys/phys-[eth1/51]/phys/fault-F1394
</span><span id="__span-24-16"><a id="__codelineno-24-16" name="__codelineno-24-16" href="#__codelineno-24-16"></a>domain           : access
</span><span id="__span-24-17"><a id="__codelineno-24-17" name="__codelineno-24-17" href="#__codelineno-24-17"></a>extMngdBy        : undefined
</span><span id="__span-24-18"><a id="__codelineno-24-18" name="__codelineno-24-18" href="#__codelineno-24-18"></a>highestSeverity  : minor
</span><span id="__span-24-19"><a id="__codelineno-24-19" name="__codelineno-24-19" href="#__codelineno-24-19"></a>lastTransition   : 2025-04-17T12:06:09.049-07:00
</span><span id="__span-24-20"><a id="__codelineno-24-20" name="__codelineno-24-20" href="#__codelineno-24-20"></a>lc               : raised
</span><span id="__span-24-21"><a id="__codelineno-24-21" name="__codelineno-24-21" href="#__codelineno-24-21"></a>modTs            : never
</span><span id="__span-24-22"><a id="__codelineno-24-22" name="__codelineno-24-22" href="#__codelineno-24-22"></a>occur            : 1
</span><span id="__span-24-23"><a id="__codelineno-24-23" name="__codelineno-24-23" href="#__codelineno-24-23"></a>origSeverity     : minor
</span><span id="__span-24-24"><a id="__codelineno-24-24" name="__codelineno-24-24" href="#__codelineno-24-24"></a>prevSeverity     : minor
</span><span id="__span-24-25"><a id="__codelineno-24-25" name="__codelineno-24-25" href="#__codelineno-24-25"></a>rn               : fault-F1394
</span><span id="__span-24-26"><a id="__codelineno-24-26" name="__codelineno-24-26" href="#__codelineno-24-26"></a>rule             : ethpm-if-port-down-fabric
</span><span id="__span-24-27"><a id="__codelineno-24-27" name="__codelineno-24-27" href="#__codelineno-24-27"></a>severity         : minor
</span><span id="__span-24-28"><a id="__codelineno-24-28" name="__codelineno-24-28" href="#__codelineno-24-28"></a>status           :
</span><span id="__span-24-29"><a id="__codelineno-24-29" name="__codelineno-24-29" href="#__codelineno-24-29"></a>subject          : port-down
</span><span id="__span-24-30"><a id="__codelineno-24-30" name="__codelineno-24-30" href="#__codelineno-24-30"></a>title            :
</span><span id="__span-24-31"><a id="__codelineno-24-31" name="__codelineno-24-31" href="#__codelineno-24-31"></a>type             : communications
</span><span id="__span-24-32"><a id="__codelineno-24-32" name="__codelineno-24-32" href="#__codelineno-24-32"></a>uid              :
</span><span id="__span-24-33"><a id="__codelineno-24-33" name="__codelineno-24-33" href="#__codelineno-24-33"></a>userdom          : all
</span></code></pre></div>
</div>
<div class="admonition example">
<p class="admonition-title">Fault Example 2 (F1394: ethpm-if-port-down-fabric)</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-25-1"><a id="__codelineno-25-1" name="__codelineno-25-1" href="#__codelineno-25-1"></a>admin@f1-apic1:~&gt; moquery -c faultInst -f &#39;fault.Inst.code==&quot;F1394&quot;&#39;
</span><span id="__span-25-2"><a id="__codelineno-25-2" name="__codelineno-25-2" href="#__codelineno-25-2"></a>Total Objects shown: 4
</span><span id="__span-25-3"><a id="__codelineno-25-3" name="__codelineno-25-3" href="#__codelineno-25-3"></a>
</span><span id="__span-25-4"><a id="__codelineno-25-4" name="__codelineno-25-4" href="#__codelineno-25-4"></a># fault.Inst
</span><span id="__span-25-5"><a id="__codelineno-25-5" name="__codelineno-25-5" href="#__codelineno-25-5"></a>code             : F1394
</span><span id="__span-25-6"><a id="__codelineno-25-6" name="__codelineno-25-6" href="#__codelineno-25-6"></a>ack              : no
</span><span id="__span-25-7"><a id="__codelineno-25-7" name="__codelineno-25-7" href="#__codelineno-25-7"></a>alert            : no
</span><span id="__span-25-8"><a id="__codelineno-25-8" name="__codelineno-25-8" href="#__codelineno-25-8"></a>annotation       : 
</span><span id="__span-25-9"><a id="__codelineno-25-9" name="__codelineno-25-9" href="#__codelineno-25-9"></a>cause            : interface-physical-down
</span><span id="__span-25-10"><a id="__codelineno-25-10" name="__codelineno-25-10" href="#__codelineno-25-10"></a>changeSet        : lastLinkStChg (New: 2023-10-24T03:24:57.051+00:00), operBitset (New: 4-5,11,35)
</span><span id="__span-25-11"><a id="__codelineno-25-11" name="__codelineno-25-11" href="#__codelineno-25-11"></a>childAction      : 
</span><span id="__span-25-12"><a id="__codelineno-25-12" name="__codelineno-25-12" href="#__codelineno-25-12"></a>created          : 2023-09-09T08:53:35.125+00:00
</span><span id="__span-25-13"><a id="__codelineno-25-13" name="__codelineno-25-13" href="#__codelineno-25-13"></a>delegated        : no
</span><span id="__span-25-14"><a id="__codelineno-25-14" name="__codelineno-25-14" href="#__codelineno-25-14"></a>descr            : Port is down, reason:err-disabled-link-flaps(err-disabled), used by:Fabric
</span><span id="__span-25-15"><a id="__codelineno-25-15" name="__codelineno-25-15" href="#__codelineno-25-15"></a>dn               : topology/pod-1/node-101/sys/phys-[eth1/53]/phys/fault-F1394
</span><span id="__span-25-16"><a id="__codelineno-25-16" name="__codelineno-25-16" href="#__codelineno-25-16"></a>domain           : access
</span><span id="__span-25-17"><a id="__codelineno-25-17" name="__codelineno-25-17" href="#__codelineno-25-17"></a>extMngdBy        : undefined
</span><span id="__span-25-18"><a id="__codelineno-25-18" name="__codelineno-25-18" href="#__codelineno-25-18"></a>highestSeverity  : minor
</span><span id="__span-25-19"><a id="__codelineno-25-19" name="__codelineno-25-19" href="#__codelineno-25-19"></a>lastTransition   : 2023-10-24T03:24:57.101+00:00
</span><span id="__span-25-20"><a id="__codelineno-25-20" name="__codelineno-25-20" href="#__codelineno-25-20"></a>lc               : raised
</span><span id="__span-25-21"><a id="__codelineno-25-21" name="__codelineno-25-21" href="#__codelineno-25-21"></a>modTs            : never
</span><span id="__span-25-22"><a id="__codelineno-25-22" name="__codelineno-25-22" href="#__codelineno-25-22"></a>occur            : 1
</span><span id="__span-25-23"><a id="__codelineno-25-23" name="__codelineno-25-23" href="#__codelineno-25-23"></a>origSeverity     : minor
</span><span id="__span-25-24"><a id="__codelineno-25-24" name="__codelineno-25-24" href="#__codelineno-25-24"></a>prevSeverity     : minor
</span><span id="__span-25-25"><a id="__codelineno-25-25" name="__codelineno-25-25" href="#__codelineno-25-25"></a>rn               : fault-F1394
</span><span id="__span-25-26"><a id="__codelineno-25-26" name="__codelineno-25-26" href="#__codelineno-25-26"></a>rule             : ethpm-if-port-down-fabric
</span><span id="__span-25-27"><a id="__codelineno-25-27" name="__codelineno-25-27" href="#__codelineno-25-27"></a>severity         : minor
</span><span id="__span-25-28"><a id="__codelineno-25-28" name="__codelineno-25-28" href="#__codelineno-25-28"></a>status           : 
</span><span id="__span-25-29"><a id="__codelineno-25-29" name="__codelineno-25-29" href="#__codelineno-25-29"></a>subject          : port-down
</span><span id="__span-25-30"><a id="__codelineno-25-30" name="__codelineno-25-30" href="#__codelineno-25-30"></a>title            : 
</span><span id="__span-25-31"><a id="__codelineno-25-31" name="__codelineno-25-31" href="#__codelineno-25-31"></a>type             : communications
</span><span id="__span-25-32"><a id="__codelineno-25-32" name="__codelineno-25-32" href="#__codelineno-25-32"></a>uid              : 
</span><span id="__span-25-33"><a id="__codelineno-25-33" name="__codelineno-25-33" href="#__codelineno-25-33"></a>userdom          : all
</span><span id="__span-25-34"><a id="__codelineno-25-34" name="__codelineno-25-34" href="#__codelineno-25-34"></a>--- omit ---
</span></code></pre></div>
</div>
<h3 id="equipment-disk-limits">Equipment Disk Limits</h3>
<p>This fault occurs when the disk usage of a partiton increases beyond its threshold.</p>
<p>This fault also occurs when the MTS buffer memory usage increases beyond its threshold. /proc/isan/sw/mts/mem/stats is checked when this scenario occurs.</p>
<p>Recommended Action:</p>
<ol>
<li>Check <code>df -h</code> output on affected node to see the usage of the partition.<ul>
<li>If the fault is about MTS, check <code>cat /proc/isan/sw/mts/mem/stats</code> output on affected node to see the usage of the MTS memory. </li>
<li>Focus on "mem_in_use" and "mem_free" in /proc/isan/sw/mts/mem/stats. </li>
<li>The usage is calculated by "mem_in_use / (mem_in_use + mem_free)". </li>
<li>The same output as /proc/isan/sw/mts/mem/stats can be obtained by <code>show system internal mts memory</code> command on affected switch node.</li>
</ul>
</li>
<li>Check <code>ls -l</code> output of folders under affected partition to see which file is consuming the space.<ul>
<li>If the fault is about MTS, check <code>show system internal mts buffers details</code> to see what is consuming the MTS buffer space.</li>
</ul>
</li>
</ol>
<p>To recover from this fault, try the following action</p>
<ol>
<li>Free up space from affected disk partition or MTS buffer.</li>
<li>TAC may be required to analyze and cleanup certain directories due to filesystem permissions. Cleanup of <code>/</code> is one such example.</li>
</ol>
<div class="admonition example">
<p class="admonition-title">Fault Example (F1820: High Disk usage)</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-26-1"><a id="__codelineno-26-1" name="__codelineno-26-1" href="#__codelineno-26-1"></a>apic1# moquery -c eqptcapacityEntity -x &#39;rsp-subtree-include=faults,no-scoped&#39;
</span><span id="__span-26-2"><a id="__codelineno-26-2" name="__codelineno-26-2" href="#__codelineno-26-2"></a>Total Objects shown: 1
</span><span id="__span-26-3"><a id="__codelineno-26-3" name="__codelineno-26-3" href="#__codelineno-26-3"></a>
</span><span id="__span-26-4"><a id="__codelineno-26-4" name="__codelineno-26-4" href="#__codelineno-26-4"></a># fault.Inst
</span><span id="__span-26-5"><a id="__codelineno-26-5" name="__codelineno-26-5" href="#__codelineno-26-5"></a>code             : F1820
</span><span id="__span-26-6"><a id="__codelineno-26-6" name="__codelineno-26-6" href="#__codelineno-26-6"></a>ack              : no
</span><span id="__span-26-7"><a id="__codelineno-26-7" name="__codelineno-26-7" href="#__codelineno-26-7"></a>alert            : no
</span><span id="__span-26-8"><a id="__codelineno-26-8" name="__codelineno-26-8" href="#__codelineno-26-8"></a>annotation       : 
</span><span id="__span-26-9"><a id="__codelineno-26-9" name="__codelineno-26-9" href="#__codelineno-26-9"></a>cause            : equipment-disk-limits-exceeded
</span><span id="__span-26-10"><a id="__codelineno-26-10" name="__codelineno-26-10" href="#__codelineno-26-10"></a>changeSet        : avail (New: 1971936), path (New: /mnt/ifc/cfg), used (New: 8194392)
</span><span id="__span-26-11"><a id="__codelineno-26-11" name="__codelineno-26-11" href="#__codelineno-26-11"></a>childAction      : 
</span><span id="__span-26-12"><a id="__codelineno-26-12" name="__codelineno-26-12" href="#__codelineno-26-12"></a>created          : 2025-02-17T13:55:20.263-06:00
</span><span id="__span-26-13"><a id="__codelineno-26-13" name="__codelineno-26-13" href="#__codelineno-26-13"></a>delegated        : no
</span><span id="__span-26-14"><a id="__codelineno-26-14" name="__codelineno-26-14" href="#__codelineno-26-14"></a>descr            : Disk usage for /mnt/ifc/cfg is above normal
</span><span id="__span-26-15"><a id="__codelineno-26-15" name="__codelineno-26-15" href="#__codelineno-26-15"></a>dn               : topology/pod-1/node-102/sys/eqptcapacity/fspartition-ifc:cfg/fault-F1820
</span><span id="__span-26-16"><a id="__codelineno-26-16" name="__codelineno-26-16" href="#__codelineno-26-16"></a>domain           : access
</span><span id="__span-26-17"><a id="__codelineno-26-17" name="__codelineno-26-17" href="#__codelineno-26-17"></a>extMngdBy        : undefined
</span><span id="__span-26-18"><a id="__codelineno-26-18" name="__codelineno-26-18" href="#__codelineno-26-18"></a>highestSeverity  : minor
</span><span id="__span-26-19"><a id="__codelineno-26-19" name="__codelineno-26-19" href="#__codelineno-26-19"></a>lastTransition   : 2025-02-17T13:57:25.020-06:00
</span><span id="__span-26-20"><a id="__codelineno-26-20" name="__codelineno-26-20" href="#__codelineno-26-20"></a>lc               : raised
</span><span id="__span-26-21"><a id="__codelineno-26-21" name="__codelineno-26-21" href="#__codelineno-26-21"></a>modTs            : never
</span><span id="__span-26-22"><a id="__codelineno-26-22" name="__codelineno-26-22" href="#__codelineno-26-22"></a>occur            : 1
</span><span id="__span-26-23"><a id="__codelineno-26-23" name="__codelineno-26-23" href="#__codelineno-26-23"></a>origSeverity     : minor
</span><span id="__span-26-24"><a id="__codelineno-26-24" name="__codelineno-26-24" href="#__codelineno-26-24"></a>prevSeverity     : minor
</span><span id="__span-26-25"><a id="__codelineno-26-25" name="__codelineno-26-25" href="#__codelineno-26-25"></a>rn               : fault-F1820
</span><span id="__span-26-26"><a id="__codelineno-26-26" name="__codelineno-26-26" href="#__codelineno-26-26"></a>rule             : eqptcapacity-fspartition-fs-partition-limits-exceeded-minor
</span><span id="__span-26-27"><a id="__codelineno-26-27" name="__codelineno-26-27" href="#__codelineno-26-27"></a>severity         : minor
</span><span id="__span-26-28"><a id="__codelineno-26-28" name="__codelineno-26-28" href="#__codelineno-26-28"></a>status           : 
</span><span id="__span-26-29"><a id="__codelineno-26-29" name="__codelineno-26-29" href="#__codelineno-26-29"></a>subject          : high-disk-usage
</span><span id="__span-26-30"><a id="__codelineno-26-30" name="__codelineno-26-30" href="#__codelineno-26-30"></a>title            : 
</span><span id="__span-26-31"><a id="__codelineno-26-31" name="__codelineno-26-31" href="#__codelineno-26-31"></a>type             : operational
</span><span id="__span-26-32"><a id="__codelineno-26-32" name="__codelineno-26-32" href="#__codelineno-26-32"></a>uid              : 
</span><span id="__span-26-33"><a id="__codelineno-26-33" name="__codelineno-26-33" href="#__codelineno-26-33"></a>userdom          : all
</span></code></pre></div>
</div>
<h3 id="vmm-inventory-partially-synced">VMM Inventory Partially Synced</h3>
<p>This script checks for fault code F0132 with rule comp-ctrlr-operational-issues and change set <code>partial-inv</code>. This fault is raised when APICs report a partially synchronized inventory with vCenter servers.</p>
<p>EPGs using the <code>immediate</code> or <code>on-demand</code> resolution immediacy (this is typical) rely on the VMM Inventory to determine VLAN programming. If the known inventory changes during an upgrade and the APIC is reporting its last sync to be partial, a VMM inventory resync response with inventory changes could result in VLANs being unexpectedly removed.</p>
<p>EPGs using the <code>pre-provision</code> resolution immediacy do not rely on the VMM inventory for VLAN deployment and so unexpected inventory changes will not change vlan programmings.</p>
<p>This check returns a <code>MANUAL</code> result as there are many reasons for a partial inventory sync to be reported. The goal is to ensure that the VMM inventory sync has fully completed before triggering the APIC upgrade to reduce any chance for unexpected inventory changes to occur.</p>
<h2 id="configuration-check-details">Configuration Check Details</h2>
<h3 id="vpc-paired-leaf-switches">VPC-paired Leaf switches</h3>
<p>High availability (HA) is always the key in network design. There are multiple ways to achieve this, such as with server configurations like NIC teaming, virtualization technology like VMware vMotion, or network device technology like link aggregation across different chassis. ACI provides high availability using virtual Port Channel (vPC) as the link aggregation across chassis.</p>
<p>It is important to keep the traffic flowing even during upgrades by upgrading one switch in the same HA pair at a time. In ACI, that will be a vPC pair unless you have other HA technologies on the server or virtualization side.</p>
<p>The script checks if all leaf switch nodes are in a vPC pair. The APIC built-in pre-upgrade validation performs this check when you upgrade Cisco APICs instead of switches because in ACI, Cisco APICs are upgraded first prior to switches, and configuring a new vPC pair potentially requires a network design change and that should be done prior to any upgrades. If you have other HA technologies in place, you can ignore this validation. vPC is not a requirement for the upgrade to complete, but the built-in tools to prevent leaf switches in a vPC domain from upgrading at the same time will not work if they are not in a vPC. If you are not using vPC, you must ensure the switches being upgraded will not cause an outage if done at the same time.</p>
<h3 id="overlapping-vlan-pool">Overlapping VLAN Pool</h3>
<p>Overlapping VLAN blocks across different VLAN pools may result in some forwarding issues, such as:</p>
<ul>
<li>Packet loss due to issues in endpoint learning with vPC</li>
<li>STP BPDUs, or any BUM traffic when using Flood-in-Encap, are not flooded to all ports within the same VLAN ID.</li>
</ul>
<p><strong>These issues may suddenly appear after upgrading your switches</strong> because switches fetch the policies from scratch after an upgrade and may apply the same VLAN ID from a different pool than what was used prior to the upgrade. As a result, the VLAN ID is mapped to a different VXLAN VNID than other switch nodes. This causes the two problems mentioned above.</p>
<div class="admonition tip">
<p class="admonition-title">VLAN Pools and VXLAN VNID on switches</p>
<p>In ACI, multiple VLANs and EPGs can be mapped to the same bridge domain, which serves as the Layer 2 domain. As a result, most Layer 2 forwarding, such as bridging or flooding a packet, uses the VXLAN VNID of the bridge domain. However, each VLAN within the bridge domain is also mapped to a unique VXLAN VNID, distict from that of the bridge domain. This is known as Forwarding Domain (FD) VNID or VLAN VNID, and it's used for special purposes such as:</p>
<ul>
<li>Endpoint synchronization between vPC peer switches.</li>
<li>Flooding STP BPDUs across switches.</li>
<li>Flooding BUM (Broadcast, Unknown Unicast, Multicast) traffic across switches when <code>Flood-in-Encap</code> is configured on the bridge domain or EPG.</li>
</ul>
<p>To prevent the impact for these mechanism, VLAN VNID mapping must be consistent across switches as needed.</p>
</div>
<div class="admonition tip">
<p class="admonition-title">How VLAN Pools are tied to the VLAN on switches</p>
<p>Each switch port can be associated to multiple VLAN pools that may or may not have VLAN ID ranges overlapping with each other.</p>
<pre class="mermaid"><code>graph LR
  A[Port] --&gt; B[Interface Policy Group] --&gt; C[AEP];
  C[AEP] --&gt; D(Phy Domain A):::dom --&gt; E[VLAN Pool 1];
  C[AEP] --&gt; F(Phy Domain B):::dom --&gt; G[VLAN Pool 2];
  C[AEP] --&gt; H(VMM Domain C):::dom --&gt; G[VLAN Pool 2];
  classDef dom fill:#fff</code></pre>
<p>When configuring a switch port (node-101 eth1/1) with VLAN 10 as EPG A, two things are checked:</p>
<ol>
<li>Whether node-101 eth1/1 is associated to VLAN 10 via <code>AEP -&gt; Domain -&gt; VLAN Pool</code></li>
<li>Whether EPG A is associated with the same domain</li>
</ol>
<p>If the port is associated with multiple domains/VLAN pools as shown above, and EPG A is associated only with <code>Phy Domain A</code>, then only <code>VLAN Pool 1</code> is available for the port in the context of EPG A, avoiding any overlapping VLAN pool issues. However, if VLAN 10 is not included in <code>VLAN Pool 1</code>, it cannot be deployed on the port via EPG A. The same principle applies when deploying a VLAN through AEP binding, as it serves as a shortcut to specify all ports within the AEP.</p>
<p>This concept of domains is crucial in multi-domain tenancy to ensure the tenant/EPG has the appropriate set of ports and VLANs.</p>
<p>However, if EPG A is associated with both <code>Phy Domain A</code> and <code>Phy Domain B</code>, the port can use either <code>VLAN Pool 1</code> or <code>VLAN Pool 2</code> to pull a VLAN. If VLAN 10 is configured in both pools, EPG A and its VLAN 10 are susceptible to an overlapping VLAN pool issue.</p>
</div>
<div class="admonition example">
<p class="admonition-title">Bad Example 1</p>
<p><pre class="mermaid"><code>graph LR
  port["`node-101
  eth1/1`"];
  vpool1["`VLAN Pool 1
  (VLAN 1-20)`"];
  vpool2["`VLAN Pool 2
  (VLAN 10-20)`"];
  X["`EPG A
  node-101 eth1/1
  VLAN 10`"]

  subgraph one [Access Policies]
  port --&gt; B[AEP];
  B[AEP] --&gt; C(Domain A):::dom --&gt; vpool1;
  B[AEP] --&gt; E(Domain B):::dom --&gt; vpool2;
  end
  X --&gt; C(Domain A):::dom;
  X --&gt; E(Domain B):::dom;
  classDef dom fill:#fff</code></pre>
In this scenario, VLAN 10 can be pulled from either <code>VLAN Pool 1</code> or <code>VLAN Pool2</code> because the port (<code>node-101 eth 1/1</code>) and the EPG are associated to both pools. And VLAN ID 10 is also configured on both pools.</p>
<p>As a result, VNID mapping for VLAN 10 on node-101 may become inconsistent after an upgrade or when the switch initializes and downloads configurations from the APICs.</p>
<p>This can be resolved by associating EPG A to only one of the domains, associating the AEP to only one of the domains, or associating the domains to the same VLAN Pool as shown below.</p>
<p><strong>Resolution 1:</strong>
<pre class="mermaid"><code>graph LR
  port["`node-101
  eth1/1`"];
  vpool1["`VLAN Pool 1
  (VLAN 1-20)`"];
  vpool2["`VLAN Pool 2
  (VLAN 10-20)`"];
  X["`EPG A
  node-101 eth1/1
  VLAN 10`"]

  subgraph one [Access Policies]
  port --&gt; B[AEP];
  B[AEP] --&gt; C(Domain A):::dom --&gt; vpool1;
  B[AEP] --&gt; E(Domain B):::dom --&gt; vpool2;
  end
  X --&gt; E(Domain B):::dom;
  classDef dom fill:#fff</code></pre></p>
<p><strong>Resolution 2:</strong>
<pre class="mermaid"><code>graph LR
  port["`node-101
  eth1/1`"];
  vpool1["`VLAN Pool 1
  (VLAN 1-20)`"];
  vpool2["`VLAN Pool 2
  (VLAN 10-20)`"];
  X["`EPG A
  node-101 eth1/1
  VLAN 10`"]

  subgraph one [Access Policies]
  port --&gt; B[AEP];
  B[AEP] --&gt; C(Domain A):::dom --&gt; vpool1;
  E(Domain B):::dom --&gt; vpool2;
  end
  X --&gt; C(Domain A):::dom;
  X --&gt; E(Domain B):::dom;
  classDef dom fill:#fff</code></pre></p>
<p><strong>Resolution 3:</strong>
<pre class="mermaid"><code>graph LR
  port["`node-101
  eth1/1`"];
  vpool1["`VLAN Pool 1
  (VLAN 1-20)`"];
  X["`EPG A
  node-101 eth1/1
  VLAN 10`"]

  subgraph one [Access Policies]
  port --&gt; B[AEP];
  B[AEP] --&gt; C(Domain A):::dom --&gt; vpool1;
  B[AEP] --&gt; E(Domain B):::dom --&gt; vpool1;
  end
  X --&gt; C(Domain A):::dom;
  X --&gt; E(Domain B):::dom;
  classDef dom fill:#fff</code></pre></p>
</div>
<div class="admonition example">
<p class="admonition-title">Bad Example 2</p>
<p><pre class="mermaid"><code>graph LR
  port1["`node-101
  eth1/1`"];
  port2["`node-101
  eth1/2`"];
  vpool1["`VLAN Pool 1
  (VLAN 1-20)`"];
  vpool2["`VLAN Pool 2
  (VLAN 10-20)`"];
  X["`EPG A
  node-101 eth1/1-2
  VLAN 10`"]

  subgraph one [Access Policies]
  port1 --&gt; aep2[AEP 2] --&gt; C(Domain A):::dom --&gt; vpool1;
  port2 --&gt; aep1[AEP 1] --&gt; E(Domain B):::dom --&gt; vpool2;
  end
  X --&gt; C(Domain A):::dom;
  X --&gt; E(Domain B):::dom;
  classDef dom fill:#fff</code></pre>
In this scenario, VLAN 10 can be pulled from either <code>VLAN Pool 1</code> or <code>VLAN Pool2</code> from the EPG's perspective. However, each port is associated to only one VLAN pool respectively.</p>
<p>This is a problem because both ports are on the same switch. Essentially, this VLAN Pool design attempts to map a different VNID for VLAN 10 on eth1/1 and eth1/2 on the same switch, which isn't allowed - there can be only one VLAN 10 per switch except for when using VLAN scope <code>local</code>.</p>
<p>As a result, VNID mapping for VLAN 10 on node-101 may become inconsistent after an upgrade or when the switch initializes and downloads configurations from the APICs.</p>
<p>This can be resolved by associating AEPs to the same domain or associating the domains to the same VLAN Pool as shown below.</p>
<p><strong>Resolution 1</strong>
<pre class="mermaid"><code>graph LR
  port1["`node-101
  eth1/1`"];
  port2["`node-101
  eth1/2`"];
  vpool1["`VLAN Pool 1
  (VLAN 1-20)`"];
  vpool2["`VLAN Pool 2
  (VLAN 10-20)`"];
  X["`EPG A
  node-101 eth1/1-2
  VLAN 10`"]

  subgraph one [Access Policies]
  port1 --&gt; aep2[AEP 2] --&gt; C(Domain A):::dom --&gt; vpool1;
  port2 --&gt; aep1[AEP 1] --&gt; C(Domain A):::dom
  E(Domain B):::dom --&gt; vpool2;
  end
  X --&gt; C(Domain A):::dom;
  X --&gt; E(Domain B):::dom;
  classDef dom fill:#fff</code></pre></p>
<p><strong>Resolution 2</strong>
<pre class="mermaid"><code>graph LR
  port1["`node-101
  eth1/1`"];
  port2["`node-101
  eth1/2`"];
  vpool1["`VLAN Pool 1
  (VLAN 1-20)`"];
  X["`EPG A
  node-101 eth1/1-2
  VLAN 10`"]

  subgraph one [Access Policies]
  port1 --&gt; aep2[AEP 2] --&gt; C(Domain A):::dom --&gt; vpool1;
  port2 --&gt; aep1[AEP 1] --&gt; E(Domain B):::dom --&gt; vpool1;
  end
  X --&gt; C(Domain A):::dom;
  X --&gt; E(Domain B):::dom;
  classDef dom fill:#fff</code></pre></p>
</div>
<div class="admonition example">
<p class="admonition-title">Example: good only for a specific use case</p>
<p><pre class="mermaid"><code>graph LR
  port1["`node-101
  eth1/1`"];
  port2["`node-102
  eth1/1`"]:::red;
  vpool1["`VLAN Pool 1
  (VLAN 1-20)`"];
  vpool2["`VLAN Pool 2
  (VLAN 10-20)`"];
  X["`EPG A
  node-101 eth1/1
  node-102 eth1/1
  VLAN 10`"]

  subgraph one [Access Policies]
  port1 --&gt; aep2[AEP 2] --&gt; C(Domain A):::dom --&gt; vpool1;
  port2 --&gt; aep1[AEP 1] --&gt; E(Domain B):::dom --&gt; vpool2;
  end
  X --&gt; C(Domain A):::dom;
  X --&gt; E(Domain B):::dom;
  classDef dom fill:#fff
  classDef red stroke:#f00</code></pre>
In this scenario, each port is tied to a different VLAN pool for VLAN 10, but each port is on a different node. This ensures that the VLAN VNID mapping remains consistent within each node even after an upgrade, with no ambiguity about which VLAN pool is used. However, VLAN 10 on each node will map to a different VLAN VNID, which may or may not be your intent.</p>
<p>Without the Flood-in-Encap feature, VLAN VNIDs act as flooding domains for spanning tree BPDUs. Even if VLAN 10 on node 101 and 102 map to different VLAN VNIDs, regular traffic is forwarded without issues via bridge domain VNID or VRF VNID.</p>
<p>This VLAN pool design is ideal for keeping the spanning tree domains small, such as in a multi-pod fabric with one STP domain per pod where each pod is physically separate with no L2 connecitivity between them except for the IPN. It helps contain spanning tree issues within a single pod. For instance, if Pod 1 continuously receives STP TCNs due to a malfuncationing device in the external network in Pod 1, the impact of flushing endpoints and causing connectivity issues due to TCNs is contained within that pod, keeping other pods unaffected.</p>
<p>However, this design is not suitable if you prefer a simpler configuration, if the nodes belong to the same vPC switch pair, or if the VLAN uses the Flood-in-Encap feature.</p>
</div>
<p>It is critical to ensure that there are no overlapping VLAN pools in your fabric unless it is on purpose with the appropriate understanding of VLAN ID and VXLAN ID mapping behind the scene. If you are not sure, consider <strong>Enforce EPG VLAN Validation</strong> under <code>System &gt; System Settings &gt; Fabric Wide Setting</code> in the Cisco APIC GUI [available starting with release 3.2(6)], which prevents the most common problematic configuration (two domains containing overlapping VLAN pools being associated to the same EPG).</p>
<p>Refer to the following documents to understand how overlapping VLAN pools become an issue and when this scenario might occur:</p>
<ul>
<li><a href="https://community.cisco.com/t5/data-center-documents/overlap-vlan-pool-lead-intermittent-packet-drop-to-vpc-endpoints/ta-p/3211107">Overlap VLAN pool Lead Intermittent Packet Drop to VPC Endpoints and Spanning-tree Loop</a></li>
<li><a href="https://community.cisco.com/t5/data-center-documents/aci-common-migration-issue-overlapping-vlan-pools/ta-p/3362376">ACI: Common migration issue / Overlapping VLAN pools</a></li>
<li><a href="https://www.cisco.com/c/en/us/td/docs/switches/datacenter/aci/apic/sw/4-x/L2-configuration/Cisco-APIC-Layer2-Configuration-Guide-42x/Cisco-APIC-Layer2-Configuration-Guide-421_chapter_0110.html#id_109428">Validating Overlapping VLANs in the Cisco APIC Layer 2 Networking Configuration Guide, Release 4.2(x)</a></li>
<li><a href="https://www.cisco.com/c/en/us/td/docs/dcn/whitepapers/cisco-aci-best-practices-quick-summary.html#_Toc114493697">VLAN Pool - ACI Best Practice Quick Summary</a></li>
</ul>
<h3 id="vnid-mismatch"><del>VNID Mismatch</del></h3>
<div class="admonition danger">
<p class="admonition-title">Deprecated</p>
<p>This check was deprecated and removed as it had not only become redundant after the updates in the <a href="#overlapping-vlan-pool">Overlapping VLAN Pool</a> check but also contained a risk of raising a false alarm. See <a href="https://github.com/datacenter/ACI-Pre-Upgrade-Validation-Script/pull/182">PR #182</a> for details.</p>
</div>
<p><span style="color:lightgray">
A VNID mismatch can arise due to an <a href="#overlapping-vlan-pool">Overlapping VLAN Pool</a> situation. This verification is closely tied to the <a href="#overlapping-vlan-pool">Overlapping VLAN Pool</a> scenario, which often leads to problems post-upgrade. Nonetheless, if your fabric is currently experiencing any VNID mismatches, you might encounter the challenges outlined in <a href="#overlapping-vlan-pool">Overlapping VLAN Pool</a> even without undergoing an upgrade. This situation also implies the presence of an overlapping VLAN pool configuration, potentially resulting in a VNID mismatch at a distinct EPG following an upgrade, causing different impact to your traffic. 
</span></p>
<h3 id="l3out-mtu">L3Out MTU</h3>
<p>It is critical to ensure that MTU values on ACI L3Out interfaces and the routers that connect to them match. Otherwise, when the ACI switch boots up after an upgrade, it may cause problem during the routing protocol neighborship establishment or exchanging the route information between peers.</p>
<p>See below for example details on each protocol.</p>
<ul>
<li>
<p><strong>BGP</strong> is a protocol which would establish session without MTU consideration. BGP "Open and Establish" messages are small, but the messages to exchange routes can be huge.</p>
</li>
<li>
<p><strong>OSPF</strong> will fail to form neighborship if the MTU from both end of the link does not match. However, although it is strongly not recommended, if the side with larger MTU is configured to ignore MTU to bring up OSPF neighborship, then OSPF neighborship will be formed.</p>
</li>
</ul>
<p>For both protocols, during a border leaf switch upgrade, routing sessions can be teared off due to a mismatched MTU. When a border leaf switch comes online with a new version, it will bring up routing peers. After this, when it starts to exchange information about routing prefixes, frames may need to carry a huge payload containing lots of prefixes. Based on the size of the table, the update may need a larger frame size which might not reach the other side. The size of this payload will depend upon local MTU. If the MTU on the other side does not match (if it's smaller than the local MTU size), then these exchanges will fail, resulting in routing issues.</p>
<p>You can check and configure the MTU on L3Out interfaces through <code>Tenant &gt; Networking &gt; L3Out &gt; Logical Node Profile &gt; Logical Interface Profile &gt; Select interface type</code>.</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>You can run the <code>moquery</code> below on the CLI of any Cisco APIC to check the configured MTU of all L3Out interfaces. Use <code>grep</code> for concise output if necessary, such as this example: <code>egrep "dn|encap|mtu"</code></p>
<p>In this example, an L3Out interface with VLAN 2054 is configured with MTU 9000 in tenant <code>TK</code>, L3Out <code>OSPF</code>, Logical Node Profile <code>OSPF_nodeProfile</code>, and Logical Interface Profile <code>OSPF_interfaceProfile</code>.
<div class="language-text highlight"><pre><span></span><code><span id="__span-27-1"><a id="__codelineno-27-1" name="__codelineno-27-1" href="#__codelineno-27-1"></a>apic1# moquery -c l3extRsPathL3OutAtt
</span><span id="__span-27-2"><a id="__codelineno-27-2" name="__codelineno-27-2" href="#__codelineno-27-2"></a>Total Objects shown: 1
</span><span id="__span-27-3"><a id="__codelineno-27-3" name="__codelineno-27-3" href="#__codelineno-27-3"></a>
</span><span id="__span-27-4"><a id="__codelineno-27-4" name="__codelineno-27-4" href="#__codelineno-27-4"></a># l3ext.RsPathL3OutAtt
</span><span id="__span-27-5"><a id="__codelineno-27-5" name="__codelineno-27-5" href="#__codelineno-27-5"></a>addr      : 20.54.0.1/24
</span><span id="__span-27-6"><a id="__codelineno-27-6" name="__codelineno-27-6" href="#__codelineno-27-6"></a>--- omit ---
</span><span id="__span-27-7"><a id="__codelineno-27-7" name="__codelineno-27-7" href="#__codelineno-27-7"></a>dn        : uni/tn-TK/out-OSPF/lnodep-OSPF_nodeProfile/lifp-OSPF_interfaceProfile/
</span><span id="__span-27-8"><a id="__codelineno-27-8" name="__codelineno-27-8" href="#__codelineno-27-8"></a>rspathL3OutAtt-[topology/pod-1/paths-101/pathep-[eth1/12]]
</span><span id="__span-27-9"><a id="__codelineno-27-9" name="__codelineno-27-9" href="#__codelineno-27-9"></a>encap     : vlan-2054
</span><span id="__span-27-10"><a id="__codelineno-27-10" name="__codelineno-27-10" href="#__codelineno-27-10"></a>--- omit ---
</span><span id="__span-27-11"><a id="__codelineno-27-11" name="__codelineno-27-11" href="#__codelineno-27-11"></a>mtu       : 9000
</span><span id="__span-27-12"><a id="__codelineno-27-12" name="__codelineno-27-12" href="#__codelineno-27-12"></a>--- omit ---
</span></code></pre></div></p>
<p>Alternatively, you can run <code>fabric &lt;node_id&gt; show interface</code> with your border leaf switch's node ID as well.</p>
<p>If the MTU shows <code>inherit</code>, the value is inherited from <code>Fabric &gt; Fabric Policies &gt; Policies &gt; Global &gt; Fabric L2 MTU &gt; default</code>.</p>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>The script checks the MTU of all L3Out interfaces for you. However, you have to run the script on Cisco APIC, and the Cisco APIC does not have visibility on the MTU value configured on the connected devices. Therefore, you should manually check the MTU on the connected devices.</p>
</div>
<h3 id="bgp-peer-profile-at-node-level-without-loopback">BGP Peer Profile at node level without Loopback</h3>
<p>Prior to upgrading to release 4.1(2) or later, you must ensure that one of the following two requirements are met:</p>
<ul>
<li>A node profile with a <strong>BGP Peer Connectivity Profile</strong> has a loopback configured for all switches in the profile, or</li>
<li><strong>BGP Peer Connectivity Profiles</strong> are configured per interface.</li>
</ul>
<p>You can configure the <strong>BGP Peer Connectivity Profile</strong> per node profile or per interface. The former is to source the BGP session from a loopback while the latter is to source the BGP session from each interface.</p>
<p>Prior to release 4.1(2), when a <strong>BGP Peer Connectivity Profile</strong> is configured at a node profile without configuring a loopback, Cisco APIC uses another available IP address on the same border leaf switch in the same VRF as the BGP source, such as a loopback IP address from another L3Out or an IP address configured for each interface. This has a risk of the BGP source IP address being changed unintentionally across reboots or upgrades. This behavior has been changed based on CSCvm28482 and ACI no longer establishes a BGP session through a <strong>BGP Peer Connectivity Profile</strong> at a node profile when a loopback is not configured in the node profile. Instead, a fault F3488 is raised in these situations. This fault cannot be used as a pre-upgrade check because it is raised only after an upgrade.</p>
<p>Due to this change, when upgrading from an older version to release 4.1(2) or later, a BGP session is no longer established if the session was generated via a <strong>BGP Peer Connectivity Profile</strong> under a node profile and a loopback is not configured in the node profile.</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>When multiple interfaces in the same node profile need to establish a BGP peer with the same peer IP, you might attempt to configure a <strong>BGP Peer Connectivity Profile</strong> at a node profile without a loopback so that the same BGP Peer configuration is applied, as a fallback due to the missing loopback, to each interface in the same node profile. This is because a <strong>BGP Peer Connectivity Profile</strong> with the same peer IP address could not be configured at multiple interface profiles within the same node profile. This limitation was loosened based on CSCvw88636 on 4.2(7f). Until then, for this specific requirement, you need to configure a node interface per interface profile and configure the <strong>BGP Peer Connectivity Profile</strong> at each interface profile in a different node profile.</p>
</div>
<h3 id="l3out-route-map-importexport-direction">L3Out Route Map import/export direction</h3>
<p>Prior to upgrading to release 4.1(1) or later, you must ensure that the route map (route profile) configuration is correct.</p>
<p>Due to the defect CSCvm75395, the following configuration might have worked prior to release 4.1(1) despite the wrong configuration (a mismatch in the direction):</p>
<ul>
<li>A route map with <code>export</code> direction attached to an L3Out subnet with <strong>Import Route Control Subnet</strong></li>
<li>A route map with <code>import</code> direction attached to an L3Out subnet with <strong>Export Route Control Subnet</strong></li>
</ul>
<p>Where the L3Out subnet means the subnet configured under an External EPG in an L3Out.</p>
<p>However, these wrong configurations will no longer work, which is the expected behavior, after you upgrade the fabric to release 4.1(1) or later.</p>
<p>Although this method is not the most common or recommended one among many ways to control the routes being advertised or learned by ACI L3Outs, the correct configuration with this method should be as follows:</p>
<ul>
<li>A route map with <code>export</code> direction attached to an L3Out subnet with <strong>Export Route Control Subnet</strong></li>
<li>A route map with <code>import</code> direction attached to an L3Out subnet with <strong>Import Route Control Subnet</strong></li>
</ul>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>Or alternatively, you can follow the recommended configurations below to control the route exchange in L3Outs instead:</p>
<ul>
<li><code>default-export</code> route map with IP prefix-lists</li>
<li><code>default-import</code> route map with IP prefix-lists</li>
</ul>
<p>With this configuration, you dont need <strong>Export Route Control Subnet</strong> or <strong>Import Route Control Subnet</strong> in the external EPGs, and you can have external EPGs that are dedicated for contracts or route leaking while you have the full control of routing protocol through route maps just like a normal router.</p>
<p>Also note that any import direction route maps only take effect when <strong>Route Control Enforcement</strong> is enabled for import under <code>Tenant &gt; Networking &gt; L3Out &gt; Main profile</code>. Otherwise, everything is imported (learned) by default.</p>
</div>
<h3 id="l3out-route-map-match-rule-with-missing-target">L3Out Route Map Match Rule with missing-target</h3>
<p>Prior to upgrading to release 5.2(8), 6.0(2) or later, you must ensure that the route map (route profile) with type <strong>Match Prefix AND Routing Policy</strong> (type <code>combinable</code> in the object <code>rtctrlProfile</code>) does not contain a match rule with the <code>missing-target</code> state.</p>
<p>Each context in an L3Out route-map with type <strong>Match Prefix AND Routing Policy</strong> creates a route-map sequence by combining multiple match conditions shown below:</p>
<ul>
<li>Match rules referenced by the route-map context</li>
<li>L3Out subnets to which the route-map is associated directly or through an L3Out EPG.</li>
<li>BD subnets in a BD to which the route-map is associated</li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Match rule references in a route-map context is located at the following path in the APIC GUI:</p>
<ul>
<li><code>Tenants &gt; Networking &gt; L3Outs &gt; (your L3Out) &gt; Route map for import and export route control &gt; Contexts &gt; Match Rules</code></li>
</ul>
<p>Whereas the match rule itself is located at the following path in the APIC GUI:</p>
<ul>
<li><code>Tanants &gt; Policies &gt; Protocol &gt; Match Rules</code></li>
</ul>
</div>
<p>However, prior to the fix of CSCwc11570, when the state of the match rule reference in the route map was <code>missing-target</code>, that is when the target match rule didn't exist due to a mis-configuration, no route-map sequence was created even when there were other match conditions such as L3Out subnets or BD subnets.</p>
<p>After the fix of CSCwc11570, a route-map sequence is created correctly based on other available match conditions (i.e. L3Out/BD subnets) even when the state of the match rule reference is <code>missing-target</code>.</p>
<p>Because of this, if users have route maps with type <strong>Match Prefix AND Routing Policy</strong> and a match rule reference that resulted in <code>missing-target</code> prior to an upgrade, route-map sequences that weren't deployed prior to the upgrade may be deployed after the upgrade. This may change how the routes are exported(advertised) or imported(learned) through an L3Out after the upgrade.</p>
<p>To avoid an unexpected behavior change after an upgrade, if the route map context has a match rule reference with <code>missing-target</code>, you should either remove the match rule reference or update it such that it points to an existing match rule.</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>When a match rule reference with <code>missing-target</code> is present for a route map with type <strong>Match Prefix AND Routing Policy</strong> prior to the upgrade and prior to the fix of CSCwx11570, the corresponding route-map context is not functioning. However, the fact that it has not been functioning without any operational impact indicates that the route map context may not be needed in the first place. If you remove the match rule reference with <code>missing-target</code>, a new route-map sequence will be deployed based on other match conditions which may or may not be needed. Thus, it is important for you to check the original intent of the route-map context and decide how to resolve it. If the route-map context is not needed in the first place, you would need to remove the entire route-map context instead of just removing the match rule reference with <code>missing-target</code>.</p>
</div>
<h3 id="l3out-loopback-ip-overlap-with-l3out-interfaces">L3Out Loopback IP Overlap with L3Out Interfaces</h3>
<p>When a loopback IP address in an L3Out is overlapping with a subnet of L3Out interfaces on the same leaf in the same VRF, only one of them (loopback or L3Out interface) is deployed even though the configuration is allowed without any faults. As a result, after an upgrade, what's deployed out of the two may change, and traffic may suddenly stop working after an upgrade because the interface that used to be deployed prior to the upgrade may be replaced with the other one.</p>
<p>In an L3Out, there are two ways to configure a loopback IP:</p>
<ol>
<li>Use Router ID as Loopback IP Address.</li>
<li>Configure an explicit loopback iP address that may be different from the router ID.</li>
</ol>
<p>Both options are configured under <code>Tenant &gt; L3Out &gt; Logical Node Profile &gt; (node ID)</code> in the APIC GUI.</p>
<p>This script checks both options to see if any of them is overlapping with the subnet configured as the L3Out interfaces under <code>Tenant &gt; L3Out &gt; Logical Node Profile &gt; Logical Interface Profile</code> in the APIC GUI.</p>
<p>Note that the overlap may happen across different L3Outs. For example, the loopback IP address is configured on <code>L3Out 1</code> on <code>node-101</code> in <code>VRF A</code> while the L3Out interface with the overlapping subnet is configrued on <code>L3Out 2</code> on the same node and the same VRF.</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>There are other overlapping configurations like overlaps between an L3Out loopback IP address and a BD subnet. Those are, however, covered by a fault (F1425), which is validated by another check - <a href="#bd-subnets">BD Subnets (F1425 subnet-overlap)</a>.</p>
</div>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>The enhancement (CSCwa48038) was made on APIC to prevent users from doing this conflicting configuration in the first place. However, if the user already had this conflicting configuration, and proceeded with an upgrade from an older version to the version with the enhancement, the conflicting configuration remains there with the remaining risk of uncertainty where we don't know which interface will be deployed after the next upgrade.</p>
</div>
<div class="admonition example">
<p class="admonition-title">Example</p>
<p>Alternative to the APIC GUI, you can also check these objects for the loopback IP addresses or L3Out Interface subnets via API.</p>
<p><strong>Use Router ID as Loopback Address</strong> in the APIC GUI corresponds to the object <code>l3extRsNodeL3OutAtt</code> with <code>rtrIdLoopBack</code> set to <code>yes</code>.
In this example, <code>node-103</code> is configured with a loopback IP <code>10.0.0.3</code> via L3Out <code>BGP</code> in tenant <code>TK</code>.</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-28-1"><a id="__codelineno-28-1" name="__codelineno-28-1" href="#__codelineno-28-1"></a>admin@f1-apic1:~&gt; moquery -c l3extRsNodeL3OutAtt | egrep &#39;dn|rtr&#39;
</span><span id="__span-28-2"><a id="__codelineno-28-2" name="__codelineno-28-2" href="#__codelineno-28-2"></a>dn             : uni/tn-TK/out-OSPF/lnodep-IPv4/rsnodeL3OutAtt-[topology/pod-1/node-103]
</span><span id="__span-28-3"><a id="__codelineno-28-3" name="__codelineno-28-3" href="#__codelineno-28-3"></a>rtrId          : 10.0.0.3
</span><span id="__span-28-4"><a id="__codelineno-28-4" name="__codelineno-28-4" href="#__codelineno-28-4"></a>rtrIdLoopBack  : no
</span><span id="__span-28-5"><a id="__codelineno-28-5" name="__codelineno-28-5" href="#__codelineno-28-5"></a>dn             : uni/tn-TK/out-BGP/lnodep-IPv4/rsnodeL3OutAtt-[topology/pod-1/node-103]
</span><span id="__span-28-6"><a id="__codelineno-28-6" name="__codelineno-28-6" href="#__codelineno-28-6"></a>rtrId          : 10.0.0.3
</span><span id="__span-28-7"><a id="__codelineno-28-7" name="__codelineno-28-7" href="#__codelineno-28-7"></a>rtrIdLoopBack  : yes
</span></code></pre></div>
<p>Configuring an explicit loopback IP address is done via the object <code>l3extLoopBackIfP</code> which is optionally configured under <code>l3extRsNodeL3OutAtt</code> when <code>l3extRsNodeL3OutAtt.rtrIdLoopBack</code> is set to <code>no</code>.</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-29-1"><a id="__codelineno-29-1" name="__codelineno-29-1" href="#__codelineno-29-1"></a>admin@f1-apic1:~&gt; moquery -c l3extLoopBackIfP | egrep &#39;dn|addr&#39;
</span><span id="__span-29-2"><a id="__codelineno-29-2" name="__codelineno-29-2" href="#__codelineno-29-2"></a>addr         : 10.0.0.103
</span><span id="__span-29-3"><a id="__codelineno-29-3" name="__codelineno-29-3" href="#__codelineno-29-3"></a>dn           : uni/tn-TK/out-BGP2/lnodep-IPv4/rsnodeL3OutAtt-[topology/pod-1/node-103]/lbp-[10.0.0.103]
</span></code></pre></div>
<p>Note that you need to get the corresponding VRF from the parent L3Out to see which VRF these loopbacks are deployed.</p>
</div>
<h3 id="isis-redistribution-metric-for-mpodmsite">ISIS Redistribution Metric for MPod/Msite</h3>
<p>ISIS Redistribution Metric is used when a spine redistributes routes from another pod or site into local underlay network (ISIS). If this metric is not set to less than 63, traffic disruption may occur with an upgrade of spine swithces.</p>
<p>See the <a href="https://www.cisco.com/c/en/us/td/docs/dcn/whitepapers/cisco-aci-best-practices-quick-summary.html#_Toc114493698">ACI Best Practice Quick Summary</a> for details.</p>
<p>This script checks the ISIS Redistribution Metric via <code>redistribMetric</code> of an object <code>isisDomPol</code> (DN: <code>uni/fabric/isisDomP-default</code>).</p>
<div class="admonition example">
<p class="admonition-title">Example</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-30-1"><a id="__codelineno-30-1" name="__codelineno-30-1" href="#__codelineno-30-1"></a>admin@f2-apic1:~&gt; moquery -d uni/fabric/isisDomP-default | grep redistribMetric
</span><span id="__span-30-2"><a id="__codelineno-30-2" name="__codelineno-30-2" href="#__codelineno-30-2"></a>redistribMetric  : 32
</span></code></pre></div>
</div>
<h3 id="bgp-route-target-type-for-golf-over-l2evpn">BGP Route-target Type for GOLF over L2EVPN</h3>
<p>Prior to upgrading to release 4.2 or later, if you are using the ACI GOLF feature with <strong>Explicit Route Targets</strong>, you must ensure that all <strong>Explicit Route Targets</strong> point to a route-target policy explicitly configured with a <code>route-target</code> community type instead of <code>extended</code> (CSCvm23100).</p>
<p>You can verify this configuration under <code>Tenant &gt; VRF &gt; BGP Route Target Profile X &gt; Route Targets</code>.</p>
<p>Prior to release 4.2 there was an unexpected behavior where a <strong>BGP Route Target Profile</strong> containing an <code>extended</code> community type is treated as a <code>route-target</code> community type. This results in the unexpected configuration and deployment of EVPN route targets for GOLF VRFs:</p>
<div class="language-text highlight"><span class="filename">Used to work unexpectedly prior to 4.2</span><pre><span></span><code><span id="__span-31-1"><a id="__codelineno-31-1" name="__codelineno-31-1" href="#__codelineno-31-1"></a>extended:as4-nn2:1234:1300
</span><span id="__span-31-2"><a id="__codelineno-31-2" name="__codelineno-31-2" href="#__codelineno-31-2"></a>extended:as4-nns:1.2.3.4:20
</span></code></pre></div>
<p>After release 4.2, with the addition of the Stretched L3out feature, <code>route-target</code> community type enforcement was corrected.
Due to this change, when upgrading from an older version to release 4.2 or later, EVPN Route Target configuration pushed due to an <code>extended</code> community type will no longer occur, which can lead to an unexpected outage.
If found, BGP Route Target Configuration must be corrected during a window to the <code>route-target</code> type prior to upgrade:</p>
<div class="language-text highlight"><span class="filename">Correct configuration after 4.2</span><pre><span></span><code><span id="__span-32-1"><a id="__codelineno-32-1" name="__codelineno-32-1" href="#__codelineno-32-1"></a>route-target:as4-nn2:1234:1300
</span><span id="__span-32-2"><a id="__codelineno-32-2" name="__codelineno-32-2" href="#__codelineno-32-2"></a>route-target:as4-nns:1.2.3.4:20
</span></code></pre></div>
<h3 id="apic-container-bridge-ip-overlap-with-apic-tep">APIC Container Bridge IP Overlap with APIC TEP</h3>
<p>By default, the APIC Container Bridge IP (docker0 interface) for AppCenter uses 172.17.0.1/16. If this overlaps with the APIC TEP IP range, APICs may not be able to communicate with each other. Depending on the version, the bridge IP may fallback to 172.18.0.1/16 to avoid the conflict. However, after an upgrade, the bridge IP may start using 172.17.0.1/16 again, which can result in an upgrade failure with an unhealthy APIC cluster.</p>
<p>To avoid this, the APIC Container Bridge IP must be explicitly configured to be a different range than the APIC TEP IP range. The APIC Container Bridge IP can be changed from <code>Apps &gt; Settings</code> in the APIC GUI.</p>
<p>The script checks if the APIC Container Bridge IP is overlapping withe the APIC TEP IP range via <code>containerBip</code> of an object <code>apContainerPol</code> (DN: <code>pluginPolContr/ContainerPol</code>).</p>
<div class="admonition example">
<p class="admonition-title">Example</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-33-1"><a id="__codelineno-33-1" name="__codelineno-33-1" href="#__codelineno-33-1"></a>admin@f2-apic1:~&gt; moquery -d pluginPolContr/ContainerPol | grep containerBip
</span><span id="__span-33-2"><a id="__codelineno-33-2" name="__codelineno-33-2" href="#__codelineno-33-2"></a>containerBip : 172.17.0.1/16
</span></code></pre></div>
</div>
<h3 id="fabric-uplink-scale-cannot-exceed-56-uplinks-per-leaf">Fabric Uplink Scale cannot exceed 56 uplinks per leaf</h3>
<p>Prior to release 6.0, the per-leaf fabric uplink count was not enforced. However, surpassing 56 could lead to programming issues on the leaf.</p>
<p>After release 6.0, per-leaf fabric uplink count is enforced via enhancement CSCwb80058. If a leaf switch has surpassed 56 uplinks and is upgraded, 56 uplinks will come up and the rest will not.</p>
<p>To avoid this, explicitly modify the port profile uplink scale to be 56 or less per leaf.</p>
<p>The script counts the amount of port-profile provisioned uplinks per leaf, and fails if any leaf is found to surpass 56.</p>
<h3 id="oob-mgmt-security">OoB Mgmt Security</h3>
<p>In the configuration of APIC Out-of-Band Management EPG, users can limit the protocols and source IP addresses that can access APIC nodes.</p>
<p>To prevent accidental blocking of necessary access to APIC, essential access (ICMP, SSH, HTTP, and HTTPS) to APICs from the same subnet as the APIC OoB IP address is always permitted, regardless of the contracts and subnets configuration of the OoB Management EPG.</p>
<p>Starting from releases 4.2(7) and 5.2(1), this safeguard implementation was extended to allow ICMP, SSH, and HTTPS from any source. However, CSCvz96117 reverted this change in release 5.2(3) due to use cases where ICMP, SSH, and HTTPS should only be allowed from a known secure source  the same subnet as the APIC OoB IP address and other user-configured IP addresses.</p>
<p>This implies that for users running releases 4.2(7), 5.2(1), or 5.2(2), and when the OoB Management EPG is configured with contracts to restrict ICMP, SSH and HTTPS access to a specific subnet, OoB security is not honored, and those can still be allowed from any subnet. After upgrading to release 5.2(3) or a newer version, OoB Management access to APICs will only be permitted from the configured subnet or ICMP, SSH, HTTP and HTTPS from the same subnet as the APIC OoB IP addresses as it were before 4.2(7). This change might catch users by surprise if they were previously accessing APICs via ICMP, SSH, or HTTPS from a subnet other than the configured one.</p>
<p>The script checks whether you should be aware of this change in behavior prior to your ACI upgrade so that appropriate subnets can be added to the configuration or you can prepare a workstation that is within the configured subnet, which will continue to be accessible to APICs even after the upgrade.</p>
<h3 id="eecdh-ssl-cipher">EECDH SSL Cipher</h3>
<p>Under <code>Fabric &gt; Fabric Policies &gt; Policies &gt; Pod &gt; Management Access &gt; default</code>, there are multiple SSL ciphers which can be enabled or disabled by the user. Cipher states should only be modified if a configured cipher is declared insecure or weak by the IETF. When modifying any cipher it is important to validate that the configuration is valid otherwise NGINX may fail to validate and the GUI will become unusable due to no cipher match. For more information reference the <a href="https://www.cisco.com/c/en/us/td/docs/dcn/aci/apic/5x/security-configuration/cisco-apic-security-configuration-guide-release-52x/https-access-52x.html">APIC Security Configuration Guide</a>.</p>
<p>EECDH is a key algorithm that many cipher suites use for HTTPS communication. If the key algorithm is disabled any cipher suite using this key algorithm will also be implicitly disabled. Cisco does not recommend disabling EECDH.</p>
<p>When disabled, the nginx.conf configuration file may fail to validate and NGINX will continue to use the last known good configuration. On upgrade, nginx.conf will also fail to validate but there is no known good configuration so the APIC GUI will be down until EECDH is re-enabled.</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>If the GUI is inaccessible due to the EECDH cipher being disabled, it can be re-enabled from the CLI using icurl.
<div class="language-text highlight"><pre><span></span><code><span id="__span-34-1"><a id="__codelineno-34-1" name="__codelineno-34-1" href="#__codelineno-34-1"></a>apic1# bash
</span><span id="__span-34-2"><a id="__codelineno-34-2" name="__codelineno-34-2" href="#__codelineno-34-2"></a>admin@apic1:~&gt; icurl -X POST &#39;http://localhost:7777/api/mo/uni/fabric/comm-default/https/cph-EECDH.json&#39; -d &#39;{&quot;commCipher&quot;:{&quot;attributes&quot;:{&quot;state&quot;:&quot;enabled&quot;}}}&#39;
</span><span id="__span-34-3"><a id="__codelineno-34-3" name="__codelineno-34-3" href="#__codelineno-34-3"></a>{&quot;totalCount&quot;:&quot;0&quot;,&quot;imdata&quot;:[]}
</span><span id="__span-34-4"><a id="__codelineno-34-4" name="__codelineno-34-4" href="#__codelineno-34-4"></a>admin@apic1:~&gt;
</span></code></pre></div></p>
</div>
<h3 id="bd-and-epg-subnet-scope-consistency">BD and EPG Subnet Scope Consistency</h3>
<p>Bridge Domains and EPGs can both have subnets defined. Depending on the features in use, there are 3 scope options that can be applied on these BD and EPG subnets to enable specific functionality:</p>
<ul>
<li><strong>Private</strong>  The subnet applies only within its tenant. This is the default scope option.</li>
<li><strong>Public</strong>   The subnet can be exported to a routed connection. This scope option is used with matching L3Out definitions to export the subnet outside of the ACI Fabric.</li>
<li><strong>Shared</strong>   The subnet can be shared with and exported to multiple VRFs in the same tenant or across
tenants as part of a "Shared Service" configuration within the ACI Fabric. An example of a shared service is a routed connection from one VRF having access to an EPG in a different VRF. The 'shared' scope option is required to enable traffic to pass in both directions across VRFs.</li>
</ul>
<p>Before the fix implemented in <a href="https://bst.cloudapps.cisco.com/bugsearch/bug/CSCvv30303">CSCvv30303</a>, it was possible for a BD and an associated EPG to have the same subnet defined, but with mismatching scopes. The non-deterministic nature of ACI meant that policy re-programmings, such as via Upgrade or Clean Reloads, could change which subnet scope option definition would take affect first, the BD or the EPG, and could result in a loss of expected traffic flows.</p>
<p><a href="https://bst.cloudapps.cisco.com/bugsearch/bug/CSCvv30303">CSCvv30303</a> introduced policy validations to prevent this configuration and enforce that matching subnets defined in both the BD and related EPG have the same scope. It is imperative that identified mismatching subnet scopes are corrected within an ACI fabric to prevent unexpected traffic pattern issues in the future.</p>
<h3 id="unsupported-fec-configuration-for-n9k-c93180yc-ex">Unsupported FEC Configuration for N9K-C93180YC-EX</h3>
<p>Nexus C93180YC-EX switches <a href="https://www.cisco.com/c/en/us/td/docs/switches/datacenter/aci/apic/sw/kb/b_Cisco_ACI_and_Forward_Error_Correction.html#Cisco_Reference.dita_5cef69b3-b7fa-4bde-ba60-38129c9e7d82">do not support CONS16-RS-FEC or IEEE-RS-FEC</a> mode. In older versions a FEC mode misconfiguration does not cause the interface to be down. However after upgrading to 5.0(1) or later the port will become hardware disabled until the misconfiguration is removed. </p>
<p>It is important to remove any unsupported configuration prior to ugprade to avoid any unexpected downtime.</p>
<div class="admonition example">
<p class="admonition-title">Example</p>
<p>On each N9K-C93180YC-EX switch, you can check the FEC mode for each interface with the following query:
<div class="language-text highlight"><pre><span></span><code><span id="__span-35-1"><a id="__codelineno-35-1" name="__codelineno-35-1" href="#__codelineno-35-1"></a>leaf101# moquery -c l1PhysIf -x query-target-filter=or\(eq\(l1PhysIf.fecMode,\&quot;ieee-rs-fec\&quot;\),eq\(l1PhysIf.fecMode,\&quot;cons16-rs-fec\&quot;\)\)
</span><span id="__span-35-2"><a id="__codelineno-35-2" name="__codelineno-35-2" href="#__codelineno-35-2"></a>Total Objects shown: 1
</span><span id="__span-35-3"><a id="__codelineno-35-3" name="__codelineno-35-3" href="#__codelineno-35-3"></a>
</span><span id="__span-35-4"><a id="__codelineno-35-4" name="__codelineno-35-4" href="#__codelineno-35-4"></a># l1.PhysIf
</span><span id="__span-35-5"><a id="__codelineno-35-5" name="__codelineno-35-5" href="#__codelineno-35-5"></a>id                             : eth1/1
</span><span id="__span-35-6"><a id="__codelineno-35-6" name="__codelineno-35-6" href="#__codelineno-35-6"></a>adminSt                        : up
</span><span id="__span-35-7"><a id="__codelineno-35-7" name="__codelineno-35-7" href="#__codelineno-35-7"></a>autoNeg                        : on
</span><span id="__span-35-8"><a id="__codelineno-35-8" name="__codelineno-35-8" href="#__codelineno-35-8"></a>breakT                         : nonbroken
</span><span id="__span-35-9"><a id="__codelineno-35-9" name="__codelineno-35-9" href="#__codelineno-35-9"></a>bw                             : 0
</span><span id="__span-35-10"><a id="__codelineno-35-10" name="__codelineno-35-10" href="#__codelineno-35-10"></a>childAction                    :
</span><span id="__span-35-11"><a id="__codelineno-35-11" name="__codelineno-35-11" href="#__codelineno-35-11"></a>delay                          : 1
</span><span id="__span-35-12"><a id="__codelineno-35-12" name="__codelineno-35-12" href="#__codelineno-35-12"></a>descr                          :
</span><span id="__span-35-13"><a id="__codelineno-35-13" name="__codelineno-35-13" href="#__codelineno-35-13"></a>dfeDelayMs                     : 0
</span><span id="__span-35-14"><a id="__codelineno-35-14" name="__codelineno-35-14" href="#__codelineno-35-14"></a>dn                             : sys/phys-[eth1/1]
</span><span id="__span-35-15"><a id="__codelineno-35-15" name="__codelineno-35-15" href="#__codelineno-35-15"></a>dot1qEtherType                 : 0x8100
</span><span id="__span-35-16"><a id="__codelineno-35-16" name="__codelineno-35-16" href="#__codelineno-35-16"></a>emiRetrain                     : disable
</span><span id="__span-35-17"><a id="__codelineno-35-17" name="__codelineno-35-17" href="#__codelineno-35-17"></a>enablePoap                     : no
</span><span id="__span-35-18"><a id="__codelineno-35-18" name="__codelineno-35-18" href="#__codelineno-35-18"></a>ethpmCfgFailedBmp              : 
</span><span id="__span-35-19"><a id="__codelineno-35-19" name="__codelineno-35-19" href="#__codelineno-35-19"></a>ethpmCfgFailedTs               : 00:00:00:00.000
</span><span id="__span-35-20"><a id="__codelineno-35-20" name="__codelineno-35-20" href="#__codelineno-35-20"></a>ethpmCfgState                  : 2
</span><span id="__span-35-21"><a id="__codelineno-35-21" name="__codelineno-35-21" href="#__codelineno-35-21"></a>fcotChannelNumber              : Channel32
</span><span id="__span-35-22"><a id="__codelineno-35-22" name="__codelineno-35-22" href="#__codelineno-35-22"></a>fecMode                        : ieee-rs-fec   &lt;&lt;&lt;
</span></code></pre></div></p>
</div>
<h3 id="cloudsec-encryption-deprecated">CloudSec Encryption Deprecated</h3>
<p>Starting in Cisco ACI 6.0(6) the CloudSec Encryption feature is deprecated. This is documented within the <a href="https://www.cisco.com/c/en/us/td/docs/dcn/aci/apic/6x/release-notes/cisco-apic-release-notes-606.html">Cisco Application Policy Infrastructure Controller Release Notes, Release 6.0(6)</a></p>
<p>This check will look for configured Pre-shared keys (PSK) within your APIC cluster. Note the following behaviors on these objects:</p>
<ol>
<li>Due to <a href="https://bst.cloudapps.cisco.com/bugsearch/bug/CSCwe67926">CSCwe67926</a>, if even a single PSK was configured for CloudSec Encryption at any point, even if never used, the object will remain and this check will alert you to this finding.</li>
<li>The only way to truly validate whether or not CloudSec Encryption is in use on your ACI fabric is to validate if CloudSec Encryption is enabled from within the <a href="https://www.cisco.com/c/en/us/td/docs/dcn/ndo/3x/configuration/cisco-nexus-dashboard-orchestrator-configuration-guide-aci-371/ndo-configuration-aci-infra-cloudsec-37x.html#id_76319">Nexus Dashboard Orchstrator Configuration</a></li>
</ol>
<h3 id="out-of-service-ports">Out-of-Service Ports</h3>
<p>Any Port that has been disabled via policy creates a <code>fabricRsOosPath</code> object and marks the ports usage as <code>blacklist</code>, or <code>blacklist,epg</code> if policy was applied to it. <code>fabricRsOosPath</code> objects can be found within the UI at the "Fabric" &gt; "Disabled Interfaces and Decommissioned Switches" view.</p>
<p>While generally not recommended, there are policy bypass methods to bring up ports which are out-of-service via policy. The problem arises from the ports active state deviating from ports configured policy, and this fact generally remains undetected as policy was bypassed. If an event occurs which causes Switch Nodes to receive and reprogram policy from the APICs, the configured out-of-service policy will bring the out-of-service ports down, as expected.</p>
<p>A Switch upgrade is one such event which results in Switch Nodes receiving policy from APICs. This will push the <code>fabricRsOosPath</code> policy to the switch again, resulting in all affected ports being rought down until the matching out-of-service policy is properly removed.</p>
<h3 id="tep-to-tep-atomic-counters-scalability">TEP-to-TEP atomic counters Scalability</h3>
<p>As documented in the <a href="https://www.cisco.com/c/en/us/td/docs/dcn/aci/apic/6x/verified-scalability/cisco-aci-verified-scalability-guide-612.html">Verified Scalability Guide for Cisco APIC</a>, ACI supports a maximum of 1600 instances of TEP-to-TEP Atomic counter policy <code>dbgAcPath</code>.
Exceeding any scalability number documented in this guide can cause unexpected issues. In this specific scenario, exceeding the atomic counter limit has been seen to create issues with collecting techsupports and configuration exports.</p>
<p>The script validates the count of <code>dbgAcPath</code> is less than the documented supported number. </p>
<h3 id="https-request-throttle-rate">HTTPS Request Throttle Rate</h3>
<p>ACI supports <strong>HTTPS Request Throttle</strong> via NGINX rate limit to prevent external API clients from consuming too much resources on APICs. This feature, which is disabled by default, is located at <code>Fabric &gt; Fabric Policies &gt; Pod &gt; Management Access &gt; default (or name you configured)</code> in the APIC GUI.</p>
<p>Starting from ACI version 6.1(2), the supported maximum rate for this feature was reduced to 40 requests per second (r/s) or 2400 requests per minute (r/m) from 10,000 r/m. Configuration with a value larger than these gets rejected starting from 6.1(2). If an invalid value is configured when an upgrade to 6.1(2)+ is triggered, the upgrade will explicitly fail. If targeting a version  below 6.1(2)+ but above the defined thresholds, this check will still wanr you to the upcoming limitations to allow you to prepare for an eventual upgrade to 6.1(2)+.
This change is to ensure that users using this feature configure a meaningful rate. If the rate is larger than the new maximum, APIC may not be able to keep up with incoming requests despite the throttling in place, and the APIC GUI can get sluggish or unresponsive which defeats the purpose of the feature.</p>
<p>This script checks the configuration in all Management Access Policies to alert users when HTTPS Request Throttling is enabled and its rate is larger than 40 r/s or 2400 r/m.</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>Regardless of the APIC version, the best practice is to enable <strong>HTTPS Request Throttle</strong> with 30 requests per second. See <a href="https://www.cisco.com/c/en/us/td/docs/dcn/whitepapers/cisco-aci-best-practices-quick-summary.html#HTTPSRequestThrottle">ACI Best Practices Quick Summary</a> for reference and details about the feature.</p>
<p>Also note that <strong>HTTPS Request Throttle</strong> in this check is referring to the global throttling as opposed to the new feature <strong>Custom Throttle Group</strong> that was introduced in 6.1(2).</p>
</div>
<h3 id="global-aes-encryption">Global AES Encryption</h3>
<p><strong>Global AES Encryption</strong> enables Cisco APICs to encrypt passwords and include them in the configuration export (backup). See <a href="https://www.cisco.com/c/en/us/td/docs/dcn/whitepapers/cisco-aci-best-practices-quick-summary.html#GlobalAESEncryption">ACI Best Practices Quick Summary</a> for details about the feature itself.</p>
<p>In terms of upgrade, taking a configuration backup with <strong>Global AES Encryption</strong> enabled before your upgrade is highly recommended so that you or Cisco TAC can restore your fabric even if something unexpected may occur during your upgrade.</p>
<p>Although enabling <strong>Global AES Encryption</strong> has been a best practice, it has become mandatory to upgrade to ACI version 6.1(2) or later. If you proceed with your APIC upgrade to 6.1(2) or newer version while <strong>Global AES Encryption</strong> is disabled, the upgrade will immediately fail.</p>
<p>When <strong>Global AES Encryption</strong> is not enabled, this script alerts users in two different ways depending on the target version.</p>
<ul>
<li>When it is not enabled and the target version is 6.1(2) or later, this check is flagged as <code>UPGRADE FAILURE</code>.</li>
<li>When it is not enabled and the target version is older than 6.1(2), this check is flagged as <code>MANUAL CHECK REQUIRED</code> to encourage users to follow the best practice to enable it (and take a configuration back again before the upgrade).</li>
</ul>
<h3 id="service-graph-bd-forceful-routing">Service Graph BD Forceful Routing</h3>
<p>Starting from ACI 6.0(2), a bridge domain containing an L4-L7 service graph device (a.k.a service BD) starts to forward packets based on their IP headers even for bridging traffic which used to be forwarded based on their MAC addresses in their ethernet headers and ignored their IP headers. This "forceful routing" is to support IP-based selectors in ESG or microsegement EPG (uSeg EPG) when service graph is configured between those ESGs/uSeg EPGs and they are in the same bridge domain as the service graph device.</p>
<p>See the <a href="https://www.cisco.com/c/en/us/td/docs/dcn/aci/apic/all/cisco-aci-releases-changes-in-behavior.html#ACIrelease602">changes in behavior doc</a> and "Optional Configurations &gt; Service BD configuration option" in <a href="https://www.cisco.com/c/en/us/solutions/collateral/data-center-virtualization/application-centric-infrastructure/white-paper-c11-739971.html">ACI PBR Service Graph Whitepaper</a> for details of this change.</p>
<p>Because of this change, bridging traffic within such bridge domains that used to work prior to the upgrade may stop working after upgrading to 6.0(2) or later.</p>
<p>This script alerts users if at least one service bridge domain was found so that users can check if those bridge domains and connected devices have traffic that may get impacted by this change.</p>
<p>See below for the workaround and examples of traffic that will stop working after the upgrade.</p>
<div class="admonition note">
<p class="admonition-title">Workaround</p>
<p>If your target version is 6.0(4) or later, there is an option to disable the forceful routing so that the service BD behaves in the same way as prior to 6.0(2). This option was introduced via CSCwh71581 and available only via API.</p>
<p>After you upgrade to 6.0(4) or later, change <code>serviceBdRoutingDisable</code> to <code>yes</code> as shown below to disable the forceful routing on your service BD if needed. If, after upgrading to 6.0(4)+, you exhibit broken bridging traffic in any identified BD, you MUST change this parameter to have your BD perform in the same manner as before the upgrade.</p>
<p>If you are targeting 6.0(2) or 6.0(3) and suspect you will be affected by this due to having bridged traffic like the examples shown below, it is strongly recommended to INSTEAD target 6.0(4)+ to have the knob required to revert the BD behavior.</p>
<div class="language-json highlight"><pre><span></span><code><span id="__span-36-1"><a id="__codelineno-36-1" name="__codelineno-36-1" href="#__codelineno-36-1"></a><span class="p">{</span>
</span><span id="__span-36-2"><a id="__codelineno-36-2" name="__codelineno-36-2" href="#__codelineno-36-2"></a><span class="w">  </span><span class="nt">&quot;fvBD&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-36-3"><a id="__codelineno-36-3" name="__codelineno-36-3" href="#__codelineno-36-3"></a><span class="w">    </span><span class="nt">&quot;attributes&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-36-4"><a id="__codelineno-36-4" name="__codelineno-36-4" href="#__codelineno-36-4"></a><span class="w">      </span><span class="nt">&quot;serviceBdRoutingDisable&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;yes&quot;</span>
</span><span id="__span-36-5"><a id="__codelineno-36-5" name="__codelineno-36-5" href="#__codelineno-36-5"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-36-6"><a id="__codelineno-36-6" name="__codelineno-36-6" href="#__codelineno-36-6"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-36-7"><a id="__codelineno-36-7" name="__codelineno-36-7" href="#__codelineno-36-7"></a><span class="p">}</span>
</span></code></pre></div>
</div>
<div class="admonition example">
<p class="admonition-title">Example 1: clustering/HA heartbeat between service devices</p>
<p>If the following two conditions are met, the probes will stop working after upgrading to 6.0(2) or later.</p>
<ul>
<li>There are heartbeat probes that are bridged between your service graph devices through the same bridige domain as the data traffic (i.e. the BD pointed by the service graph)</li>
<li>The destination IP addresses of the probes are unicast and don't belong to the subnet(s) of the said BD</li>
</ul>
<p>Although this should not be common as it is typically a best practice to use a different path for those probes than the data traffic, if your design meets these condtions you can change the design to move the probe traffic to another bridge domain prior to the upgrade. Or you can change the setting of the service bridge domain to disable the forceful routing after your upgrade as shown above.</p>
<p>This example is also explained in the "Optional Configurations &gt; Service BD configuration option" in <a href="https://www.cisco.com/c/en/us/solutions/collateral/data-center-virtualization/application-centric-infrastructure/white-paper-c11-739971.html">ACI PBR Service Graph Whitepaper</a>.</p>
</div>
<div class="admonition example">
<p class="admonition-title">Example 2: ACI CNI with SNAT</p>
<p>ACI CNI with SNAT utilizes a virtual IP shared across multiple kubernetes nodes. ACI switches forward the traffic towards the virtual IP (i.e. one of the kubernetes nodes) via Service Graph PBR. However, there is a chance where the traffic sent to the kubernetes node that doesn't have the destination pod. This happens because the virtual IP is shared not just between multiple nodes but also between pods and it's mapped to each pod based on the L4 port. When the kubernetes node receives a packet to its virtual IP but its L4 port is not of its pod, the node will bounce the traffic to the other node by rewriting the MAC addresses in the ethernet header while the IP headers remain the same, which means it's a bridging traffic.</p>
<p>This will stop working after upgrading to 6.0(2) or later because the service bridge domain ignores the MAC addresses and forcefully use the IP address, which is the same virtual IP again, to forward the packet. As a result, the packet will not be able to reach the correct kubenetes node.</p>
<p>In this case, you need to prepare to change the setting of the service bridge domain to disable the forceful routing after your upgrade as shown above.</p>
<p>See <a href="https://www.cisco.com/c/en/us/td/docs/switches/datacenter/aci/apic/sw/kb/cisco-aci-plug-in-snat-on-egress.html">SNAT Traffic for Kubernetes with Cisco ACI CNI</a> for details about ACI CNI with SNAT.</p>
</div>
<h3 id="ave-end-of-life">AVE End-of-life</h3>
<p>As outlined in the <a href="https://www.cisco.com/c/en/us/products/collateral/cloud-systems-management/application-policy-infrastructure-controller-apic/eol-apic-virtual-edge-pod-pb.html">End-of-Sale and End-of-Life Announcement for Cisco Application Centric Infrastructure Virtual Edge and Virtual Pod</a>, the Cisco ACI Virtual Edge (AVE) Domain is end-of-life and end-of-support for ACI releases 6.0 and above.</p>
<p>If planning an upgrade to 6.0+, review the <a href="https://www.cisco.com/c/en/us/td/docs/dcn/whitepapers/cisco-aci-virtual-edge-migration.html">Cisco ACI Virtual Edge Migration Guide</a> and complete a domain migration prior to performing the upgrade.</p>
<h3 id="shared-service-with-vzany-consumer">Shared Service with vzAny Consumer</h3>
<p>A shared service (VRF Route Leaking) contract with vzAny as a consumer may use more policy TCAM space after an upgrade depending on the release version and provider type due to a behavior change called "Rule Expansion":</p>
<ul>
<li>In the case of EPG/External EPG providers, 5.3(2d) and later or 6.0(3) and later releases may use more policy TCAM space than releases older than 5.3(2d) or 6.0(3).</li>
<li>In the case of ESG providers, 6.1(2) and later releases may use more policy TCAM space than releases older than 6.1(2).</li>
</ul>
<p>When Rule Expansion takes place after an upgrade, the increase in the TCAM space may result in TCAM overflow which can lead to traffic disruption because contracts that used to work may stop working.</p>
<p>See <a href="https://www.cisco.com/c/en/us/solutions/collateral/data-center-virtualization/application-centric-infrastructure/white-paper-c11-743951.html#Inter">Inter-VRF contract with vzAny as the consumer</a> in Cisco ACI Contract Guide for details about Rule Expansion and calculate the potential TCAM space usage when the Rule Expansion takes place. If there is a risk of TCAM overflow, consider enabling the policy compression directive on contract filters to mitigate the increase of TCAM usage. However, note that enabling the policy compression directive will result in loss of the statistics capability for those rules. Also, note that policy compression for contracts with PBR is supported only from 6.1(4).</p>
<p>See <a href="https://www.cisco.com/c/en/us/solutions/collateral/data-center-virtualization/application-centric-infrastructure/white-paper-c11-743951.html#EnablePolicyCompression">Enable Policy Compression in Cisco ACI Contract Guide</a> for details about Policy Compression.</p>
<h2 id="defect-check-details">Defect Check Details</h2>
<h3 id="ep-announce-compatibility">EP Announce Compatibility</h3>
<p>If your current ACI switch version is pre-12.2(4p) or 12.3(1) and you are upgrading to release 13.2(2) or later, you are susceptible to a defect CSCvi76161, where a version mismatch between Cisco ACI leaf switches may cause an unexpected EP announce message to be received by the EPM process on the leaf switch, resulting in an EPM crash and the reload of the switch.</p>
<p>To avoid this issue, it is critical that you upgrade to a fixed version of CSCvi76161 prior to upgrading to release 13.2(2) or later.</p>
<ul>
<li>For fabrics running a pre-12.2(4p) ACI switch release, upgrade to release 12.2(4r) first, then upgrade to the desired destination release.</li>
<li>For fabrics running a 12.3(1) ACI switch release, upgrade to release 13.1(2v) first, then upgrade to the desired destination release.</li>
</ul>
<h3 id="eventmgr-db-size-defect-susceptibility">Eventmgr DB size defect susceptibility</h3>
<p>Due to defects CSCvn20175 or CSCvt07565, the upgrade of APICs may get stuck or take an unusually long time to complete. Either eventmanager defect results in a database shard with a replica 0 that grew exceptionally large. This, in turn, increases the time it takes for dataconvergence to complete.</p>
<p>Root access is required to check the current size of APIC database shards. A Cisco TAC SR is required for root access.</p>
<p>This script checks if the current version is susceptible to either CSCvn20175 or CSCvt07565.</p>
<h3 id="contract-port-22-defect">Contract Port 22 Defect</h3>
<p>Due to the defect CSCvz65560, a contract using TCP port 22 is either disabled or programmed with a wrong value during while upgrading the fabric to 5.0 or a newer version. The issue was fixed and not observed when upgrading to 5.2(2g) or newer.</p>
<p>The script checks whether the your upgrade is susceptible to the defect from the version point of view.</p>
<h3 id="telemetrystatsserverp-object">telemetryStatsServerP Object</h3>
<p>Beginning with the Cisco APIC 5.2(3) release, the <code>telemetryStatsServerP</code> managed object with <code>collectorLocation</code> of type <code>apic</code> is no longer supported and removed post Cisco APIC upgrade.</p>
<p>Due to the defect <a href="https://bst.cloudapps.cisco.com/bugsearch/bug/CSCvt47850">CSCvt47850</a>, if the switches are still on an older version than the 4.2(4) release the managed object is deleted before the switches are upgraded and this may cause the switches to become inactive or crash.</p>
<p>To avoid this issue, change the <code>collectorLocation</code> type to <code>none</code> through the API to prevent the object from being automatically deleted post upgrade.</p>
<ol>
<li>
<p>If <code>telemetryStatsServerP</code> exists with <code>collectorLocation="apic"</code>, use the API to change the <code>collectorLocation</code> type to <code>none</code>.</p>
<div class="admonition example">
<p class="admonition-title">Example</p>
<p><code>collectorLocation</code> is set to <code>apic</code> so this fabric is susceptible to CSCvt47850. Use icurl to change <code>collectorLocation</code> to <code>none</code>.
<div class="language-text highlight"><pre><span></span><code><span id="__span-37-1"><a id="__codelineno-37-1" name="__codelineno-37-1" href="#__codelineno-37-1"></a>apic# moquery -c telemetryStatsServerP
</span><span id="__span-37-2"><a id="__codelineno-37-2" name="__codelineno-37-2" href="#__codelineno-37-2"></a># telemetry.StatsServerP
</span><span id="__span-37-3"><a id="__codelineno-37-3" name="__codelineno-37-3" href="#__codelineno-37-3"></a>collectorLocation  : apic &lt;&lt;&lt;
</span><span id="__span-37-4"><a id="__codelineno-37-4" name="__codelineno-37-4" href="#__codelineno-37-4"></a>apic# bash
</span><span id="__span-37-5"><a id="__codelineno-37-5" name="__codelineno-37-5" href="#__codelineno-37-5"></a>apic:~&gt; icurl -kX POST &quot;http://localhost:7777/api/mo/uni/fabric/servers/stserverp-default.xml&quot; -d &#39;&lt;telemetryStatsServerP status=&quot;modified&quot; collectorLocation=&quot;none&quot;/&gt;&#39;
</span><span id="__span-37-6"><a id="__codelineno-37-6" name="__codelineno-37-6" href="#__codelineno-37-6"></a>apic:~&gt; exit
</span><span id="__span-37-7"><a id="__codelineno-37-7" name="__codelineno-37-7" href="#__codelineno-37-7"></a>apic# moquery -c telemetryStatsServerP
</span><span id="__span-37-8"><a id="__codelineno-37-8" name="__codelineno-37-8" href="#__codelineno-37-8"></a># telemetry.StatsServerP
</span><span id="__span-37-9"><a id="__codelineno-37-9" name="__codelineno-37-9" href="#__codelineno-37-9"></a>collectorLocation  : none &lt;&lt;&lt;
</span></code></pre></div></p>
</div>
<ol>
<li>Upgrade both Cisco APICs and switches to the target version.</li>
</ol>
</li>
<li>
<p>After validating that all switches have been upgraded successfully, delete the <code>telemetryStatsSeverP</code> managed object.</p>
<div class="admonition example">
<p class="admonition-title">Example</p>
<p>Object can safely be removed from the fabric.
<div class="language-text highlight"><pre><span></span><code><span id="__span-38-1"><a id="__codelineno-38-1" name="__codelineno-38-1" href="#__codelineno-38-1"></a>apic# bash
</span><span id="__span-38-2"><a id="__codelineno-38-2" name="__codelineno-38-2" href="#__codelineno-38-2"></a>apic:~&gt; icurl -kX POST &quot;http://localhost:7777/api/mo/uni/fabric/servers/stserverp-default.xml&quot; -d &#39;&lt;telemetryStatsServerP status=&quot;deleted&quot;/&gt;&#39;
</span></code></pre></div></p>
</div>
</li>
</ol>
<h3 id="link-level-flow-control">Link Level Flow Control</h3>
<p>Due to the defect CSCvo27498, after upgrade of first ACI leaf switch in a VPC pair to newer 15.x version from older 13.x version, downstream VPC might be down due to <code>vpc port channel mis-config due to vpc links in the 2 switches connected to different partners</code> even though they are connected to same device. </p>
<p>By default Link level Flow control is off in ACI but in older code, the ACI software was incorrectly signalling far end device to enable transmit flow control. if far end device transmit(send) flow control  in auto or desirable mode, it will enable transmit flow control.</p>
<p>After the first switch in VPC pair is upgraded to newer 15.x code, the  incorrect flow control signalling is fixed. But due to mismatched software versions in ACI during upgrade, the far end device port-channel member interfaces will end up with mismatched send flow control. When this happens. they could send a different LACP operational key causing the ACI leaf to interpret that it is connected to different partners. </p>
<p>The script checks if the version is susceptible to the default along with the specific 1G SFPs that are affected by the defect.</p>
<h3 id="internal-vlan-pool">Internal VLAN Pool</h3>
<p>Prior to upgrading to Cisco APIC release 4.2(6) or later, you must ensure that any VLAN encap blocks that are explicitly used for front-panel ports are set to type <strong>external (on the wire)</strong>. The encap block type <strong>internal</strong> is reserved only for AVE deployment. Due to the defect CSCvw33061, this configuration might have worked prior to release 4.2(6) despite being misconfigured. If you fail to correct the misconfiguration before you upgrade Cisco APIC, it will result in the affected VLANs being removed from the front-panel port that can result in a data plane outage.</p>
<h3 id="apic-ca-cert-validation">APIC CA Cert Validation</h3>
<p>Due to the defect CSCvy35257, APIC may have a corrupted CA certificate after importing a backup config without AES encryption. If an upgrade is performed while the CA certificate is corrupted, spine switches will repeatedly reboot (CSCwc74242).</p>
<p>The script checks if the APIC CA certificate is corrupted or not.</p>
<h3 id="fabricdomain-name">FabricDomain Name</h3>
<p>Due to the defect CSCwf80352, ACI switches cannot join the fabric after an upgrade to 6.0(2) release when the name of the ACI fabric (<code>fabricDomain</code> in an object <code>topSystem</code>) containis "#" or ";".</p>
<p>The script checks if the target version is 6.0(2) and if the fabric name contains "#" or ";".</p>
<h3 id="spine-sup-hw-revision">Spine SUP HW Revision</h3>
<p>Field Notice <a href="https://www.cisco.com/c/en/us/support/docs/field-notices/740/fn74050.html">FN74050</a> outlines 2 issue scenarios that can be hit for a subset of Spine Sup-A+ and SUP-B+ Part Numbers.</p>
<p>There is a VRM Issue outlined by <a href="https://bst.cloudapps.cisco.com/bugsearch/bug/CSCwd65255">CSCwd65255</a> which can occur for affected SUP parts after performing an EPLD upgrade, forcing the user to perform an additional power cycle before they will boot up. If 'VRM Concern' is flagged, review the FN details which includes a link to a script which can be run by TAC to proactively address this specific issue.</p>
<p>There is also an FPGA Downgrade Issue which is due to a combination of <a href="https://bst.cloudapps.cisco.com/bugsearch/bug/CSCwb86706">CSCwb86706</a> and <a href="https://bst.cloudapps.cisco.com/bugsearch/bug/CSCwf44222">CSCwf44222</a>. This specific scenario is more severe in that ACI modular spine switches will not be able to boot after an upgrade if hit and a replacement is required. However, the FPGA Downgrade Issue can be avoided entirely by targeting a fixed version of <a href="https://bst.cloudapps.cisco.com/bugsearch/bug/CSCwf44222">CSCwf44222</a>.</p>
<p>The script checks if the version and the SUP Part Numbers are susceptible to either FN issue scenario.</p>
<h3 id="cos-3-with-dynamic-packet-prioritization">CoS 3 with Dynamic Packet Prioritization</h3>
<p>Due to the defect CSCwf05073, ACI unexpectedly assigning a COS3 value to traffic egressing front ports. </p>
<p>In certain cases, such as when frames goes through FCoE supported devices, these get classified into the no drop FCoE class. In FCoE devices, this can cause drop of packets when the packet length is higher than the allowed 2184 bytes.</p>
<p>For example, on the UCS Fabric Interconnect COS3 value is hardcoded for fiber channel (FC) or fiber channel over ethernet (FCoE) traffic. FC/FCoE traffic is highly sensitive and is treated as non-droppable, and cannot exceed MTU of 2184 bytes long.</p>
<p>This script checks if the target version is susceptible to CSCwf05073 and dynamic packet prioritization feature is set to "on".</p>
<h3 id="sup-aa-high-memory-usage">SUP-A/A+ High Memory Usage</h3>
<p>Due to the increased memory utilization from 6.0(3), N9K-SUP-A or N9K-SUP-A+ will likely experience constant high memory utilization.</p>
<p>It is highly recommended not to upgrade your ACI fabric to 6.0(3), 6.0(4) or 6.0(5) if your fabric contains N9K-SUP-A and/or N9K-SUP-A+. Instead, wait for the memory optimization in a near-future Cisco ACI 6.0 maintenance release that will allow the N9K-SUP-A and N9K-SUP-A+ supervisors to operate in a normal memory condition.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This is also called out in release notes of each version - <a href="https://www.cisco.com/c/en/us/td/docs/dcn/aci/apic/6x/release-notes/cisco-apic-release-notes-603.html">6.0(3)</a>, <a href="https://www.cisco.com/c/en/us/td/docs/dcn/aci/apic/6x/release-notes/cisco-apic-release-notes-604.html">6.0(4)</a>, <a href="https://www.cisco.com/c/en/us/td/docs/dcn/aci/apic/6x/release-notes/cisco-apic-release-notes-605.html">6.0(5)</a>:</p>
</div>
<h3 id="vmm-uplink-container-with-empty-actives">VMM Uplink Container with empty Actives</h3>
<p>Due to the defect CSCvr96408, affected versions with VMM domains having VMM parameters changed via the UI could have resulted in <code>fvUplinkOrderCont</code> objects created with the parameter <code>"active": ""</code> ('active' set to blank). This <code>active</code> parameter defines which uplinks should be set to active on the Vmware created EPG portgroup, and if blank, results in no active uplinks. In most cases, traffic issues due to this config were worked-around by manually modifying the active uplink configuration directly within VMware vCenter.</p>
<p>The issue arises when an upgrade or VMM parameter change occurs. Either change causes a re-validation of the <code>fvUplinkOrderCont</code> VMM policy as defined in ACI. The result is that any <code>fvUplinkOrderCont</code> still having <code>active: ""</code> will push a config change into VMware vCenter to map back to APIC policy, resulting in the removal of active uplinks and a corresponding outage.</p>
<p>This script checks for <code>fvUplinkOrderCont</code> with <code>active: ""</code> and alerts the user to their existence. The <code>active</code> parameter must match your current active configuration to avoid an outage on subsequent upgrade of VMM Parameter change.</p>
<p>The example shows a correctly defined <code>fvUplinkOrderCont</code>, with uplinks under the <code>active</code> field.</p>
<div class="admonition example">
<p class="admonition-title">Example</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-39-1"><a id="__codelineno-39-1" name="__codelineno-39-1" href="#__codelineno-39-1"></a>apic1# moquery -c fvUplinkOrderCont
</span><span id="__span-39-2"><a id="__codelineno-39-2" name="__codelineno-39-2" href="#__codelineno-39-2"></a>Total Objects shown: 1
</span><span id="__span-39-3"><a id="__codelineno-39-3" name="__codelineno-39-3" href="#__codelineno-39-3"></a>
</span><span id="__span-39-4"><a id="__codelineno-39-4" name="__codelineno-39-4" href="#__codelineno-39-4"></a># fv.UplinkOrderCont
</span><span id="__span-39-5"><a id="__codelineno-39-5" name="__codelineno-39-5" href="#__codelineno-39-5"></a>active       : 1,2,3,4,5,6,7,8
</span><span id="__span-39-6"><a id="__codelineno-39-6" name="__codelineno-39-6" href="#__codelineno-39-6"></a>annotation   : 
</span><span id="__span-39-7"><a id="__codelineno-39-7" name="__codelineno-39-7" href="#__codelineno-39-7"></a>childAction  : 
</span><span id="__span-39-8"><a id="__codelineno-39-8" name="__codelineno-39-8" href="#__codelineno-39-8"></a>descr        : 
</span><span id="__span-39-9"><a id="__codelineno-39-9" name="__codelineno-39-9" href="#__codelineno-39-9"></a>dn           : uni/tn-test1/ap-ap3/epg-epg3/rsdomAtt-[uni/vmmp-VMware/dom-test-dvs]/uplinkorder
</span><span id="__span-39-10"><a id="__codelineno-39-10" name="__codelineno-39-10" href="#__codelineno-39-10"></a>extMngdBy    : 
</span><span id="__span-39-11"><a id="__codelineno-39-11" name="__codelineno-39-11" href="#__codelineno-39-11"></a>lcOwn        : local
</span><span id="__span-39-12"><a id="__codelineno-39-12" name="__codelineno-39-12" href="#__codelineno-39-12"></a>modTs        : 2024-04-30T16:15:06.815+00:00
</span><span id="__span-39-13"><a id="__codelineno-39-13" name="__codelineno-39-13" href="#__codelineno-39-13"></a>name         : 
</span><span id="__span-39-14"><a id="__codelineno-39-14" name="__codelineno-39-14" href="#__codelineno-39-14"></a>nameAlias    : 
</span><span id="__span-39-15"><a id="__codelineno-39-15" name="__codelineno-39-15" href="#__codelineno-39-15"></a>ownerKey     : 
</span><span id="__span-39-16"><a id="__codelineno-39-16" name="__codelineno-39-16" href="#__codelineno-39-16"></a>ownerTag     : 
</span><span id="__span-39-17"><a id="__codelineno-39-17" name="__codelineno-39-17" href="#__codelineno-39-17"></a>rn           : uplinkorder
</span><span id="__span-39-18"><a id="__codelineno-39-18" name="__codelineno-39-18" href="#__codelineno-39-18"></a>standby      : 
</span><span id="__span-39-19"><a id="__codelineno-39-19" name="__codelineno-39-19" href="#__codelineno-39-19"></a>status       : 
</span><span id="__span-39-20"><a id="__codelineno-39-20" name="__codelineno-39-20" href="#__codelineno-39-20"></a>uid          : 15374
</span><span id="__span-39-21"><a id="__codelineno-39-21" name="__codelineno-39-21" href="#__codelineno-39-21"></a>userdom      : :all:common:
</span></code></pre></div>
</div>
<h3 id="n9k-c93108tc-fx3pfx3h-interface-down">N9K-C93108TC-FX3P/FX3H Interface Down</h3>
<p>Due to the defect CSCwh81430, some RJ45 interfaces on Cisco Nexus N9K-C93108TC-FX3P and N9K-C93108TC-FX3H Switches might not come up, even when connected.</p>
<p>This issue can be triggered by a switch reload that occurs for any reason, including a software upgrade, software reset, system crash, or the power being turned up or down.</p>
<p>The problem is related only to the front-panel interfaces Ethernet 1/1- 1/48. Optical ports Ethernet 1/49 - 54 and MGMT0 port are not affected.</p>
<p>Because of this, the target version of your upgrade must be a version with a fix of CSCwh81430 when your fabric includes those switches mentioned above. See the Field Notice <a href="https://www.cisco.com/c/en/us/support/docs/field-notices/740/fn74085.html">FN74085</a> for details.</p>
<h3 id="invalid-fabricpathep-targets">Invalid fabricPathEp Targets</h3>
<p>Prior to <a href="https://bst.cloudapps.cisco.com/bugsearch/bug/CSCwh68103">CSCwh68103</a>, <code>fabricPathEp</code> objects could be created using DN formats that do not match a valid schema and are technically invalid. The issue arises after upgrading to a version with validations included; any fixed version of <a href="https://bst.cloudapps.cisco.com/bugsearch/bug/CSCwh68103">CSCwh68103</a>. While on a fixed version, if changes are made to objects that target <code>fabricPathEp</code> objects with invalid DNs, such as <code>infraRsHPathAtt</code> or <code>fabricRsOosPath</code>, an error resembling <code>Failed to decode IfIndex, id: 0x.......</code> will be seen and the desired configuration change will be prevented until the invalid DN syntax objects are cleaned up.</p>
<p>The details documented within <a href="https://bst.cloudapps.cisco.com/bugsearch/bug/CSCwh68103">CSCwh68103</a> describe the various validations that were added to <code>fabricPathEp</code> DNs. </p>
<p>If invalid DNs are found, and depending on the scale of invalid DNs, work with TAC to plan a deletion of identified objects. </p>
<p>This check queries <code>infraRsHPathAtt</code> and <code>fabricRsOosPath</code> objects and then scans all the <code>tDn</code> parameters for known invalid <code>fabricPathEp</code> references.</p>
<h3 id="lldp-custom-interface-description">LLDP Custom Interface Description</h3>
<p>Due to the defect <a href="https://bst.cloudapps.cisco.com/bugsearch/bug/CSCwf00416">CSCwf00416</a>, custom interface descriptions may override the port topology DN. In ACI LLDP should always advertise the topology DN as the port description irrespective of whether an interface description is configured or not.</p>
<p>In cases where there is a custom interface description and a VMM-integrated deployment with deploy immediacy set to on-demand, connectivity may break on upgrade. If both of these features are enabled it is not recommended to upgrade to 6.0(1) or 6.0(2).</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>To check for any custom interface descriptions, you can use the following moquery command.
<div class="language-text highlight"><pre><span></span><code><span id="__span-40-1"><a id="__codelineno-40-1" name="__codelineno-40-1" href="#__codelineno-40-1"></a>apic1# moquery -c infraPortBlk -x query-target-filter=ne\(infraPortBlk.descr,&quot;&quot;\)
</span><span id="__span-40-2"><a id="__codelineno-40-2" name="__codelineno-40-2" href="#__codelineno-40-2"></a>Total Objects shown: 11
</span><span id="__span-40-3"><a id="__codelineno-40-3" name="__codelineno-40-3" href="#__codelineno-40-3"></a>
</span><span id="__span-40-4"><a id="__codelineno-40-4" name="__codelineno-40-4" href="#__codelineno-40-4"></a># infra.PortBlk
</span><span id="__span-40-5"><a id="__codelineno-40-5" name="__codelineno-40-5" href="#__codelineno-40-5"></a>name         : portblock1
</span><span id="__span-40-6"><a id="__codelineno-40-6" name="__codelineno-40-6" href="#__codelineno-40-6"></a>annotation   :
</span><span id="__span-40-7"><a id="__codelineno-40-7" name="__codelineno-40-7" href="#__codelineno-40-7"></a>childAction  :
</span><span id="__span-40-8"><a id="__codelineno-40-8" name="__codelineno-40-8" href="#__codelineno-40-8"></a>descr        : port 30 on Leaf 101 and 103 to FI-B      &lt;&lt;&lt; Description is set
</span><span id="__span-40-9"><a id="__codelineno-40-9" name="__codelineno-40-9" href="#__codelineno-40-9"></a>dn           : uni/infra/accportprof-system-port-profile-node-103/hports-system-port-selector-accbundle-VPC_FIB-typ-range/portblk-portblock1
</span><span id="__span-40-10"><a id="__codelineno-40-10" name="__codelineno-40-10" href="#__codelineno-40-10"></a>--- omit ---
</span></code></pre></div></p>
<p>To check for any VMM Domains using on-demand deploy immediacy, you can use the following moquery command.
<div class="language-text highlight"><pre><span></span><code><span id="__span-41-1"><a id="__codelineno-41-1" name="__codelineno-41-1" href="#__codelineno-41-1"></a>apic1# moquery -c fvRsDomAtt -x query-target-filter=and\(eq\(fvRsDomAtt.tCl,\&quot;vmmDomP\&quot;\),eq\(fvRsDomAtt.instrImedcy,\&quot;lazy\&quot;\)\)
</span><span id="__span-41-2"><a id="__codelineno-41-2" name="__codelineno-41-2" href="#__codelineno-41-2"></a>Total Objects shown: 90
</span><span id="__span-41-3"><a id="__codelineno-41-3" name="__codelineno-41-3" href="#__codelineno-41-3"></a>
</span><span id="__span-41-4"><a id="__codelineno-41-4" name="__codelineno-41-4" href="#__codelineno-41-4"></a># fv.RsDomAtt
</span><span id="__span-41-5"><a id="__codelineno-41-5" name="__codelineno-41-5" href="#__codelineno-41-5"></a>tDn                  : uni/vmmp-VMware/dom-shared-dvs
</span><span id="__span-41-6"><a id="__codelineno-41-6" name="__codelineno-41-6" href="#__codelineno-41-6"></a>dn                   : uni/tn-prod/ap-inet/epg-epg1/rsdomAtt-[uni/vmmp-VMware/dom-shared-dvs]
</span><span id="__span-41-7"><a id="__codelineno-41-7" name="__codelineno-41-7" href="#__codelineno-41-7"></a>instrImedcy          : lazy                            &lt;&lt;&lt; deploy immediacy is on-demand
</span><span id="__span-41-8"><a id="__codelineno-41-8" name="__codelineno-41-8" href="#__codelineno-41-8"></a>tCl                  : vmmDomP
</span><span id="__span-41-9"><a id="__codelineno-41-9" name="__codelineno-41-9" href="#__codelineno-41-9"></a>--- omit ---
</span></code></pre></div></p>
</div>
<h3 id="route-map-community-match">Route-map Community Match</h3>
<p>Due to the defect <a href="https://bst.cloudapps.cisco.com/bugsearch/bug/CSCwb08081">CSCwb08081</a>, if you have a route-map with a community match statement but there is no prefix list match the set clause may not be applied.</p>
<p>It is recommended if you are upgrading to an affected release to add a prefix list match statement prior to upgrade.</p>
<div class="admonition example">
<p class="admonition-title">Example</p>
<p>In this example, the Route-map match rule <code>rtctrlSubjP</code> has a community match <code>rtctrlMatchCommFactor</code> but no prefix list match <code>rtctrlMatchRtDest</code>. This match rule would be affected by the defect.
<div class="language-text highlight"><pre><span></span><code><span id="__span-42-1"><a id="__codelineno-42-1" name="__codelineno-42-1" href="#__codelineno-42-1"></a>apic1# moquery -c rtctrlSubjP -x rsp-subtree=full -x rsp-subtree-class=rtctrlMatchCommFactor,rtctrlMatchRtDest | egrep &quot;^#|dn &quot;
</span><span id="__span-42-2"><a id="__codelineno-42-2" name="__codelineno-42-2" href="#__codelineno-42-2"></a># rtctrl.SubjP
</span><span id="__span-42-3"><a id="__codelineno-42-3" name="__codelineno-42-3" href="#__codelineno-42-3"></a>dn           : uni/tn-Cisco/subj-match-comm
</span><span id="__span-42-4"><a id="__codelineno-42-4" name="__codelineno-42-4" href="#__codelineno-42-4"></a># rtctrl.MatchCommTerm
</span><span id="__span-42-5"><a id="__codelineno-42-5" name="__codelineno-42-5" href="#__codelineno-42-5"></a>dn           : uni/tn-Cisco/subj-match-comm/commtrm-test
</span><span id="__span-42-6"><a id="__codelineno-42-6" name="__codelineno-42-6" href="#__codelineno-42-6"></a># rtctrl.MatchCommFactor
</span><span id="__span-42-7"><a id="__codelineno-42-7" name="__codelineno-42-7" href="#__codelineno-42-7"></a>    dn           : uni/tn-Cisco/subj-match-comm/commtrm-test/commfct-regular:as2-nn2:4:15
</span></code></pre></div>
In order to fix this, navigate to <code>Tenants &gt; "Cisco" &gt; Policies &gt; Protocol &gt; Match Rules &gt; "match-comm"</code> and add a prefix-list.
<div class="language-text highlight"><pre><span></span><code><span id="__span-43-1"><a id="__codelineno-43-1" name="__codelineno-43-1" href="#__codelineno-43-1"></a>apic1# moquery -c rtctrlSubjP -x rsp-subtree=full -x rsp-subtree-class=rtctrlMatchCommFactor,rtctrlMatchRtDest | egrep &quot;^#|dn &quot;
</span><span id="__span-43-2"><a id="__codelineno-43-2" name="__codelineno-43-2" href="#__codelineno-43-2"></a># rtctrl.SubjP
</span><span id="__span-43-3"><a id="__codelineno-43-3" name="__codelineno-43-3" href="#__codelineno-43-3"></a>dn           : uni/tn-Cisco/subj-match-comm
</span><span id="__span-43-4"><a id="__codelineno-43-4" name="__codelineno-43-4" href="#__codelineno-43-4"></a># rtctrl.MatchCommTerm
</span><span id="__span-43-5"><a id="__codelineno-43-5" name="__codelineno-43-5" href="#__codelineno-43-5"></a>dn           : uni/tn-Cisco/subj-match-comm/commtrm-test
</span><span id="__span-43-6"><a id="__codelineno-43-6" name="__codelineno-43-6" href="#__codelineno-43-6"></a># rtctrl.MatchCommFactor
</span><span id="__span-43-7"><a id="__codelineno-43-7" name="__codelineno-43-7" href="#__codelineno-43-7"></a>    dn           : uni/tn-Cisco/subj-match-comm/commtrm-test/commfct-regular:as2-nn2:4:15
</span><span id="__span-43-8"><a id="__codelineno-43-8" name="__codelineno-43-8" href="#__codelineno-43-8"></a># rtctrl.MatchRtDest
</span><span id="__span-43-9"><a id="__codelineno-43-9" name="__codelineno-43-9" href="#__codelineno-43-9"></a>dn           : uni/tn-Cisco/subj-match-comm/dest-[0.0.0.0/0]
</span></code></pre></div></p>
</div>
<h3 id="l3out-32-overlap-with-bd-subnet">L3out /32 overlap with BD Subnet</h3>
<p>Due to defect <a href="https://bst.cloudapps.cisco.com/bugsearch/bug/CSCwb91766">CSCwb91766</a>, L3out /32 Static Routes that overlap with BD Subnets within the same VRF will be programmed into RIB but not FIB of the relevant switches in the forwarding path. This will cause traffic loss as packets will not be able to take the /32 route, resulting in unexpecteded forwarding issues.</p>
<p>If found, the target version of your upgrade should be a version with a fix for CSCwb91766. Otherwise, the other option is to change the routing design of the affected fabric.</p>
<h3 id="vzany-to-vzany-service-graph-when-crossing-50-release">vzAny-to-vzAny Service Graph when crossing 5.0 release</h3>
<p>When your APIC upgrade is crossing 5.0 release, for instance upgrading from 4.2(7w) to 5.2(8i), traffic hitting a vzAny-to-vzAny contract with Service Graph may experience disruption for a short amount of time.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>A vzAny-to-vzAny contract refers to a contract that is provided and consumed by the same VRF (vzAny) so that the contract is applied to all traffic in the said VRF.</p>
<p>The potential transient traffic disruption occurs during an APIC upgrade instead of a switch upgrade.</p>
</div>
<p>The script checks the two points:</p>
<ol>
<li>The combination of your source and target version is susceptible</li>
<li>You have any vzAny-to-vzAny contract with Service Graph</li>
</ol>
<p>When both conditions are met, the script results in <code>FAIL - OUTAGE WARNING!!</code> to inform you of potential disruption to your traffic going through such Service Graph. In such a case, make sure to upgrade your APICs during a maintenance window that can tolerate some traffic impact.</p>
<p>This transient disruption is because the pcTag of the service EPG for a vzAny-vzAny Service Graph is updated from APIC and re-programmed on switches due to an internal architecture update in <a href="https://www.cisco.com/c/en/us/td/docs/dcn/aci/apic/all/cisco-aci-releases-changes-in-behavior.html#ACIrelease501">APIC Release 5.0</a> (See also <a href="https://bst.cloudapps.cisco.com/bugsearch/bug/CSCwh75475">CSCwh75475</a>).
Depending on the timing and how fast the re-programming finishes, you may not see any traffic disruption. Unfortunately, it is difficult to estimate the amount of time the re-programming takes but it generally depends on the number of VRFs, service graphs, contract rules etc.</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>With L4-L7 Service Graph, ACI deploys an internal/hidden EPG representing the service node to be inserted via the Service Graph. Such a hidden EPG is called Service EPG. When a Service Graph is applied to a contract, internally a service EPG is inserted between the provider and consumer EPGs so that the traffic flow will be consumer EPG to service EPG (i.e. service node such as firewall), coming back from the service node, then service EPG to provider EPG. Because of this, if the pcTag of service EPG is updated, such traffic flow gets impacted while it's being re-programmed in the switch hardware.</p>
<p>Due to the update in <a href="https://www.cisco.com/c/en/us/td/docs/dcn/aci/apic/all/cisco-aci-releases-changes-in-behavior.html#ACIrelease501">APIC Release 5.0</a>, the pcTag of the service EPG for a vzAny-vzAny Service Graph will be updated to a Global pcTag from a Local pcTag. Global pcTags are in the range of 1 - 16384 while local pcTags are 16385 - 65535. You can check the pcTag of your service EPG from <code>Tenant &gt; Services &gt; L4-L7 &gt; Deployed Graph Instances &gt; Function Node &gt; Policy &gt; Function Connectors &gt; Class ID</code> in the APIC GUI.</p>
</div>
<h3 id="fcfcoe-support-for-ex-switches">FC/FCOE support for -EX switches</h3>
<p>Due to defect <a href="https://bst.cloudapps.cisco.com/bugsearch/bug/CSCwm92166">CSCwm92166</a>, ACI switches with models ending in '-EX' will not support FC/FCOE configurations if upgraded to an affected release. If upgraded, the FC/FCOE interface will remain down and fault F4511 will be raised.</p>
<p>Refer to the <a href="https://www.cisco.com/c/en/us/td/docs/dcn/aci/apic/6x/l2-configuration/cisco-apic-layer-2-networking-configuration-guide-61x/fcoe-connections-61x.html">Cisco APIC Layer 2 Networking Configuration Guide, Release 6.1(x)</a> for a complete list of for FC/FCOE supported hardware.</p>
<p>The script checks if your upgrade is susceptible to this defect from both version and configuration perspectives.</p>
<h3 id="nexus-950x-fm-or-lc-might-fail-to-boot-after-reload">Nexus 950X FM or LC Might Fail to boot after reload</h3>
<p>A clock signal component manufactured by one supplier, and included in some Cisco products, has been seen to degrade over time in some units.
Although the Cisco products with these components are currently performing normally, we expect product failures to increase over the years, beginning after the unit has been in operation for approximately 18 months. Additional details are document in <a href="https://www.cisco.com/c/en/us/support/docs/field-notices/642/fn64251.html">FN64251</a></p>
<p>The matching defect is <a href="https://bst.cloudapps.cisco.com/bugsearch/bug/CSCvg26013">CSCvg26013</a>.</p>
<p>This check alerts you to potentially affected modules:</p>
<p>Fabric Modules</p>
<ul>
<li>N9K-C9504-FM-E</li>
<li>N9K-C9508-FM-E</li>
</ul>
<p>Line Card</p>
<ul>
<li>N9K-X9732C-EX</li>
</ul>
<p>If alerted, check if identified Serial Numbers are affected using the <a href="https://snvui.cisco.com/snv/FN64251">Serial Number Validation Tool</a>.</p>
<h3 id="stale-decommissioned-spine">Stale Decommissioned Spine</h3>
<p>Due to defect <a href="https://bst.cloudapps.cisco.com/bugsearch/bug/CSCwf58763">CSCwf58763</a>, upgrading to non-fixed versions with <code>fabricRsDecommissionNode</code> objects pointing to Spine Node IDs, regardless of pod location defined in the <code>fabricRsDecommissionNode</code> object, will result in those Spine Nodes being removed from Leaf Node COOP Adjacency lists. This results in Leaf Nodes no longer publishing endpoint updates to affected Spine Nodes, resulting in packet drops for any spine proxy traffic hashed to an affected Spine Node.</p>
<h3 id="n9k-c9408-platform-model">N9K-C9408 Platform Model</h3>
<p><a href="https://bst.cloudapps.cisco.com/bugsearch/bug/CSCwk77800">CSCwk77800</a> fixed a behavior where <code>N9K-C9408</code> are reporting their chassis as the SUP PID <code>N9K-C9400-SW-GX2A</code>.</p>
<p>When an identified switch node is upgraded to a fixed 6.1(3)+ version, the <code>N9K-C9400-SW-GX2A</code> fabric membership entry will show up as inactive and must be decomissioned and the new <code>N9K-C9408</code> fabric membership entry must be registered. The result is that the node IDs in question will not completely join the fabric post-upgrade until these additional steps are performed on each identified <code>N9K-C9408</code> node.</p>
<h3 id="pbr-high-scale">PBR High Scale</h3>
<p>Due to <a href="https://bst.cloudapps.cisco.com/bugsearch/bug/CSCwi66348">CSCwi66348</a>, Leaf Switches with high scale PBR config (classes <code>vnsAdjacencyDefCont</code>, <code>vnsSvcRedirEcmpBucketCons</code> and <code>fvAdjDefCons</code> specifically) can take an unexpectedly long time to complete bootstrap after an upgrade.</p>
<p>This check will count the number of relevant PBR policies across the entire ACI fabric from an APIC perspective (classes <code>vnsAdjacencyDefCont</code>, <code>vnsSvcRedirEcmpBucketCons</code>) and alert if targeting an affected version with relevant PBR config objects greater than 100k. If alerted, the recommended action is to target a version that has the fix for <a href="https://bst.cloudapps.cisco.com/bugsearch/bug/CSCwi66348">CSCwi66348</a>.</p>
<h3 id="standby-sup-image-sync">Standby Sup Image Sync</h3>
<p>Due to <a href="https://bst.cloudapps.cisco.com/bugsearch/bug/CSCwa44220">CSCwa44220</a>, the Standy Supervisor Modules within Modular Chassis will be unable to successfully install switch images greater than 2 Gigs.</p>
<p>If this alert is flagged then plan for an interim upgrade hop to a fixed version that is less than 2 Gigs, for example to 5.2(8i).</p>
<h3 id="observer-database-size">Observer Database Size</h3>
<p>Due to <a href="https://bst.cloudapps.cisco.com/bugsearch/bug/CSCvw45531">CSCvw45531</a>, the Observer DME database files can grow very large over time. Exceptionally large DB files can cause the APIC Upgrade process to take an unexpectedly long time to complete dataconversion, and in some cases can lead to APIC upgrade failure.</p>
<p>The Observer DME is responsible for keeping certain stats, counters, logs entries and more. Within the APIC, a non-root user can get a read-only view of the Observer DB counts and sizes by viewing the <code>/data2/dbstats/</code> directory.</p>
<p>This check logs in to each APIC, checks the contents of the <code>/data2/dbstats/</code> directory, and alerts on any DB file which has surpassed 1GB in size.</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>Certain high churn logging configurations have been found to grow this DB exceptionally large while on a non-fixed version. 'Contract Permit Logging' is one such configuration.</p>
</div>
<h3 id="stale-pconsra-object"><del>Stale pconsRA Object</del></h3>
<div class="admonition danger">
<p class="admonition-title">Deprecated</p>
<p>This check was deprecated in script version v3.3.0 via <a href="https://github.com/datacenter/ACI-Pre-Upgrade-Validation-Script/pull/287">PR #287</a> as it was raising false positives.</p>
</div>
<p><span style="color:lightgray">
Due to <a href="https://bst.cloudapps.cisco.com/bugsearch/bug/CSCwp22212">CSCwp22212</a>, the existence of stale pconsRA objects within an ACI fabric can cause the APIC Policymanager process to crash after an upgrade to 6.0(3d) and above. This script looks for instances of stale pconsRA objects and flags them for cleanup when found.
TAC must be engaged to cleanup these objects, as they require root access.
</span></p>
<h3 id="isis-dteps-byte-size">ISIS DTEPs Byte Size</h3>
<p>Due to <a href="https://bst.cloudapps.cisco.com/bugsearch/bug/CSCwp15375">CSCwp15375</a>, running a <code>show</code> command that dumps out the ISIS Link State Database under certain conditions, such as <code>show isis database detail vrf all</code>, will result in a switch crash.</p>
<p>As Switch Tech Support generation includes ISIS show command output, Tech Support generation will also result in a switch crash under the same conditions.</p>
<p>The specific conditions leading to the crash are:</p>
<ol>
<li>The ACI software version is 6.1(1f), 6.1(2f), 6.1(2g), or 6.1(3f)</li>
<li>For any spine; The <code>isisDTEp</code> address + <code>PROXY-ACAST-MAC</code> address + <code>PROXY-ACAST-V4</code> address + <code>PROXY-ACAST-V6</code> address equals 58 bytes or more</li>
</ol>
<p>Do not upgrade to any affected ACI software release if this check fails.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Nexus Dashboard Insights (NDI) integration can cause ACI tech support generation to happen automatically as part of the bug scan feature.</p>
</div>
<h3 id="policydist-configpushshardcont-crash">Policydist configpushShardCont crash</h3>
<p>In ACI, there are internal objects which track the underlying transactions which occur as policies are handled by the Policydist process. One such object is <code>configpushShardCont</code> which populates the <code>headTx</code> and <code>tailTx</code> parameters to mark any potentially stuck transactions.</p>
<p>Due to <a href="https://bst.cloudapps.cisco.com/bugsearch/bug/CSCwp95515">CSCwp95515</a>, upgrading to an affected version while having any <code>configpushShardCont</code> objects with a non-zero <code>headTx</code> and <code>tailTx: 0</code> can result in the Policydist process crashing if config is pushed to a PM shard matching the <code>dn</code> of the identified <code>configpushShardCont</code>.</p>
<p>If any instances of <code>configpushShardCont</code> are flagged by this script, Cisco TAC must be contacted to identify and resolve the underlying issue before performing the upgrade.</p>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      
      <script id="__config" type="application/json">{"annotate": null, "base": "..", "features": ["content.code.copy"], "search": "../assets/javascripts/workers/search.2c215733.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../assets/javascripts/bundle.79ae519e.min.js"></script>
      
    
  </body>
</html>